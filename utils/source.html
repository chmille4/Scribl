<a href="https://github.com/chmille4/Scribl"><img alt="Fork me on GitHub" id="ribbon" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a><html>
	<head>
		<title>Scribl</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		<style>body {
    margin: 0;
    padding: 0;
    font: 14px/1.5 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
    color: #252519;
}
a {
    color: #252519;
}
a:hover {
    text-decoration: underline;
    color: #19469D;
}
p {
    margin: 12px 0;
}
h1, h2, h3 {
    margin: 0;
    padding: 0;
}
table#source {
    width: 100%;
    border-collapse: collapse;
}
table#source td:first-child {
    padding: 30px 40px 30px 40px;
    vertical-align: top;
}
table#source td:first-child,
table#source td:first-child pre {
    width: 450px;
}
table#source td:last-child {
    padding: 30px 0 30px 40px;
    border-left: 1px solid #E5E5EE;
    background: #F5F5FF;
}
table#source tr {
    border-bottom: 1px solid #E5E5EE;
}
table#source tr.filename {
    padding-top: 40px;
    border-top: 1px solid #E5E5EE;
}
table#source tr.filename td:first-child {
    text-transform: capitalize;
}
table#source tr.filename td:last-child {
    font-size: 12px;
}
table#source tr.filename h2 {
    margin: 0;
    padding: 0;
    cursor: pointer;
}
table#source tr.code h1,
table#source tr.code h2,
table#source tr.code h3 {
    margin-top: 30px;
    font-family: "Lucida Grande", "Helvetica Nueue", Arial, sans-serif;
    font-size: 18px;
}
table#source tr.code h2 {
    font-size: 16px;
}
table#source tr.code h3 {
    font-size: 14px;
}
table#source tr.code ul {
    margin: 15px 0 15px 35px;
    padding: 0;
}
table#source tr.code ul li {
    margin: 0;
    padding: 1px 0;
}
table#source tr.code ul li p {
    margin: 0;
    padding: 0;
}
table#source tr.code td:first-child pre {
    padding: 20px;
}
#ribbon {
    position: fixed;
    top: 0;
    right: 0;
}
code .string { color: #219161; }
code .regexp { color: #219161; }
code .keyword { color: #954121; }
code .number { color: #19469D; }
code .comment { color: #bbb; }
code .this { color: #19469D; }</style>
		<script>
			$(function(){
				$('tr.code').hide();
				$('tr.filename').toggle(function(){
					$(this).nextUntil('.filename').fadeIn();
				}, function(){
					$(this).nextUntil('.filename').fadeOut();
				});
				// test
			});
		</script>
	</head>
	<body>
<table id="source"><tbody><tr><td><h1>Scribl</h1><p>HTML5 Canvas Genomics Graphics Library</p></td><td></td></tr><tr class="filename"><td><h2 id="Scribl.js"><a href="#">Scribl</a></h2></td><td>Scribl.js</td></tr><tr class="code">
<td class="docs">
<p><strong>Scribl Class</strong></p>

<p><em>sets defaults, defines how to add features
to chart/view and some methods to help
coordinate drawing</em></p>

<p>Chase Miller 2011
 </p>
</td>
<td class="code">
<pre><code><span class="comment">// globals</span>
<span class="comment">// if (SCRIBL == undefined) {</span>
    <span class="keyword">var</span> <span class="class">SCRIBL</span> = {};
    <span class="class">SCRIBL</span>.<span class="variable">chars</span> = {};                                    
    <span class="class">SCRIBL</span>.<span class="variable">chars</span>.<span class="variable">nt_color</span> = <span class="string">'white'</span>;
    <span class="class">SCRIBL</span>.<span class="variable">chars</span>.<span class="variable">nt_A_bg</span> = <span class="string">'red'</span>;
    <span class="class">SCRIBL</span>.<span class="variable">chars</span>.<span class="variable">nt_G_bg</span> = <span class="string">'blue'</span>;
    <span class="class">SCRIBL</span>.<span class="variable">chars</span>.<span class="variable">nt_C_bg</span> = <span class="string">'green'</span>;
    <span class="class">SCRIBL</span>.<span class="variable">chars</span>.<span class="variable">nt_T_bg</span> = <span class="string">'black'</span>;
    <span class="class">SCRIBL</span>.<span class="variable">chars</span>.<span class="variable">nt_N_bg</span> = <span class="string">'purple'</span>;
    <span class="class">SCRIBL</span>.<span class="variable">chars</span>.<span class="variable">nt_dash_bg</span> = <span class="string">'rgb(120,120,120)'</span>;
    <span class="class">SCRIBL</span>.<span class="variable">chars</span>.<span class="variable">heights</span> = [];
    <span class="class">SCRIBL</span>.<span class="variable">chars</span>.<span class="variable">canvasHolder</span> = <span class="variable">document</span>.<span class="variable">createElement</span>(<span class="string">'canvas'</span>);      
 <span class="comment">//}</span>
 
 
<span class="keyword">var</span> <span class="class">Scribl</span> = <span class="class">Class</span>.<span class="variable">extend</span>({</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>init</strong></p>

<p><em> Constructor, call this with <code>new Scribl()</code></em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  canvasHTML object</p></li><li><p><strong>param</strong>: <em>Int</em>  width of chart in pixels</p></li><li><p><strong>return</strong>: <em>Object</em>  Scribl object</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">init</span>: <span class="keyword">function</span>(<span class="variable">canvas</span>, <span class="variable">width</span>) {
      <span class="this">this</span>.<span class="variable">scrolled</span> = <span class="variable">false</span>;
      <span class="comment">// create canvas contexts		</span>
      <span class="keyword">var</span> <span class="variable">ctx</span>;
      <span class="keyword">if</span> (<span class="variable">canvas</span>)
         <span class="variable">ctx</span> = <span class="variable">canvas</span>.<span class="variable">getContext</span>(<span class="string">'2d'</span>);
      <span class="keyword">var</span> <span class="variable">chart</span> = <span class="this">this</span>;      

      <span class="comment">// chart defaults</span>
      <span class="this">this</span>.<span class="variable">width</span> = <span class="variable">width</span>;
      <span class="this">this</span>.<span class="variable">uid</span> = <span class="variable">_uniqueId</span>(<span class="string">'chart'</span>);
      <span class="this">this</span>.<span class="variable">laneSizes</span> = <span class="number integer">50</span>;	
      <span class="this">this</span>.<span class="variable">laneBuffer</span> = <span class="number integer">5</span>;
      <span class="this">this</span>.<span class="variable">trackBuffer</span> = <span class="number integer">25</span>;
      <span class="this">this</span>.<span class="variable">offset</span> = <span class="variable">undefined</span>;
      <span class="this">this</span>.<span class="variable">canvas</span> = <span class="variable">canvas</span>;
      <span class="this">this</span>.<span class="variable">ctx</span> = <span class="variable">ctx</span>;
	
      <span class="comment">// scale defaults</span>
      <span class="this">this</span>.<span class="variable">scale</span> = {};
      <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">pretty</span> = <span class="variable">true</span>;
      <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">max</span> = <span class="variable">undefined</span>;
      <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span> = <span class="variable">undefined</span>;
      <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">auto</span> = <span class="variable">true</span>;
      <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">userControlled</span> = <span class="variable">false</span>;
      <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">positions</span> = [<span class="number integer">0</span>]; <span class="comment">// by default scale goes on top</span>
      <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">off</span> = <span class="variable">false</span>;
      <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">size</span> = <span class="number integer">15</span>; <span class="comment">// in pixels</span>
      <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span> = {};
      <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span>.<span class="variable">size</span> = <span class="number integer">15</span>; <span class="comment">// in pixels</span>
      <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span>.<span class="variable">color</span> = <span class="string">'black'</span>;
      <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span>.<span class="variable">buffer</span> = <span class="number integer">10</span>; <span class="comment">// in pixels - buffer between two scale numbers</span>
                                   <span class="comment">// (e.g. 1k and 2k)</span>
      
      <span class="comment">// glyph defaults</span>
      <span class="this">this</span>.<span class="variable">glyph</span> = {};
      <span class="this">this</span>.<span class="variable">glyph</span>.<span class="variable">roundness</span> = <span class="number integer">6</span>;
      <span class="this">this</span>.<span class="variable">glyph</span>.<span class="variable">borderWidth</span> = <span class="number integer">1</span>; <span class="comment">// in pixels</span>
      <span class="this">this</span>.<span class="variable">glyph</span>.<span class="variable">color</span> = [<span class="string">'#99CCFF'</span>, <span class="string">'rgb(63, 128, 205)'</span>];
      <span class="this">this</span>.<span class="variable">glyph</span>.<span class="variable">text</span> = {};
      <span class="this">this</span>.<span class="variable">glyph</span>.<span class="variable">text</span>.<span class="variable">color</span> = <span class="string">'black'</span>;
      <span class="this">this</span>.<span class="variable">glyph</span>.<span class="variable">text</span>.<span class="variable">size</span> = <span class="string">'13'</span>; <span class="comment">// in pixels</span>
      <span class="this">this</span>.<span class="variable">glyph</span>.<span class="variable">text</span>.<span class="variable">font</span> = <span class="string">'arial'</span>;
      <span class="this">this</span>.<span class="variable">glyph</span>.<span class="variable">text</span>.<span class="variable">align</span> = <span class="string">'center'</span>;
      
      
      <span class="comment">// initialize common types</span>
      <span class="this">this</span>.<span class="variable">gene</span> = {};
      <span class="this">this</span>.<span class="variable">gene</span>.<span class="variable">text</span> = {};
      <span class="this">this</span>.<span class="variable">protein</span> = {};
      <span class="this">this</span>.<span class="variable">protein</span>.<span class="variable">text</span> = {};
      
      <span class="comment">// event defaults</span>
      <span class="this">this</span>.<span class="variable">events</span> = {};
      <span class="this">this</span>.<span class="variable">events</span>.<span class="variable">hasClick</span> = <span class="variable">false</span>;
      <span class="this">this</span>.<span class="variable">events</span>.<span class="variable">hasMouseover</span> = <span class="variable">false</span>;
      <span class="this">this</span>.<span class="variable">events</span>.<span class="variable">clicks</span> = <span class="keyword">new</span> <span class="class">Array</span>;
      <span class="this">this</span>.<span class="variable">events</span>.<span class="variable">mouseovers</span> = <span class="keyword">new</span> <span class="class">Array</span>;
      <span class="this">this</span>.<span class="variable">events</span>.<span class="variable">added</span> = <span class="variable">false</span>;
      <span class="this">this</span>.<span class="variable">mouseHandler</span> = <span class="keyword">function</span>(<span class="variable">e</span>) { 
         <span class="variable">chart</span>.<span class="variable">handleMouseEvent</span>(<span class="variable">e</span>, <span class="string">'mouseover'</span>) 
         };
      <span class="this">this</span>.<span class="variable">clickHandler</span> = <span class="keyword">function</span>(<span class="variable">e</span>) { <span class="variable">chart</span>.<span class="variable">handleMouseEvent</span>(<span class="variable">e</span>, <span class="string">'click'</span>) };
      
      <span class="comment">// tick defaults</span>
      <span class="this">this</span>.<span class="variable">tick</span> = {};
      <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">auto</span> = <span class="variable">true</span>;
      <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span> = {};
      <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span>.<span class="variable">size</span> = <span class="number integer">10</span>; <span class="comment">// width between major ticks in nucleotides</span>
      <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span>.<span class="variable">color</span> = <span class="string">'black'</span>;
      <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">minor</span> = {};
      <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">minor</span>.<span class="variable">size</span> = <span class="number integer">1</span>; <span class="comment">// width between minor ticks in nucleotides</span>
      <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">minor</span>.<span class="variable">color</span> = <span class="string">'rgb(55,55,55)'</span>;
      <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">halfColor</span> = <span class="string">'rgb(10,10,10)'</span>;
      
      <span class="comment">// tooltip defaults</span>
      <span class="this">this</span>.<span class="variable">tooltips</span> = {};
      <span class="this">this</span>.<span class="variable">tooltips</span>.<span class="variable">text</span> = {}
      <span class="this">this</span>.<span class="variable">tooltips</span>.<span class="variable">text</span>.<span class="variable">font</span> = <span class="string">'arial'</span>;
      <span class="this">this</span>.<span class="variable">tooltips</span>.<span class="variable">text</span>.<span class="variable">size</span> = <span class="number integer">12</span>; <span class="comment">// in pixels</span>
      <span class="this">this</span>.<span class="variable">tooltips</span>.<span class="variable">borderWidth</span> = <span class="number integer">1</span>; <span class="comment">// in pixels</span>
      <span class="this">this</span>.<span class="variable">tooltips</span>.<span class="variable">roundness</span> = <span class="number integer">5</span>;  <span class="comment">// in pixels</span>
      <span class="this">this</span>.<span class="variable">tooltips</span>.<span class="variable">fade</span> = <span class="variable">false</span>;
      <span class="this">this</span>.<span class="variable">tooltips</span>.<span class="variable">style</span> = <span class="string">'light'</span>;  <span class="comment">// also a 'dark' option</span>
      <span class="this">this</span>.<span class="variable">lastToolTips</span> = [];
      
      <span class="comment">// scroll defaults</span>
      <span class="this">this</span>.<span class="variable">scrollable</span> = <span class="variable">false</span>;
      <span class="this">this</span>.<span class="variable">scrollValues</span> = [<span class="number integer">0</span>, <span class="variable">undefined</span>]; <span class="comment">// values in nts where scroll</span>
       
      <span class="this">this</span>.<span class="variable">chars</span> = {}; 
      <span class="this">this</span>.<span class="variable">chars</span>.<span class="variable">drawOnBuild</span> = [];
      
      <span class="comment">// draw defaults</span>
      <span class="this">this</span>.<span class="variable">drawStyle</span> = <span class="string">'expand'</span>;  
      
      <span class="comment">// draw hooks</span>
      <span class="this">this</span>.<span class="variable">glyphHooks</span> = [];
      <span class="this">this</span>.<span class="variable">trackHooks</span> = [];
      
      <span class="comment">// private variables</span>
      <span class="this">this</span>.<span class="variable">myMouseEventHandler</span> = <span class="keyword">new</span> <span class="class">MouseEventHandler</span>(<span class="this">this</span>);
      <span class="this">this</span>.<span class="variable">tracks</span> = [];
      <span class="keyword">var</span> <span class="variable">scaleSize</span> = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">size</span>;
      <span class="keyword">var</span> <span class="variable">scaleFontSize</span> = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span>.<span class="variable">size</span>
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getScaleHeight</strong></p>

<p><em>Get the height of the scale/ruler</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Int</em>  height in pixels</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getScaleHeight</span>: <span class="keyword">function</span>() {
      <span class="keyword">return</span> (<span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span>.<span class="variable">size</span> + <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">size</span>);
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getHeight</strong></p>

<p><em>Get the height of the entire Scribl chart/view</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Int</em>  height in pixels</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getHeight</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">wholeHeight</span> = <span class="number integer">0</span>;
		
      <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">off</span>) <span class="variable">wholeHeight</span> += <span class="this">this</span>.<span class="variable">getScaleHeight</span>();
      <span class="keyword">var</span> <span class="variable">numTracks</span> = <span class="this">this</span>.<span class="variable">tracks</span>.<span class="variable">length</span>
		
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">numTracks</span>; <span class="variable">i</span>++) {
         <span class="variable">wholeHeight</span> += <span class="this">this</span>.<span class="variable">trackBuffer</span>;
         <span class="variable">wholeHeight</span> += <span class="this">this</span>.<span class="variable">tracks</span>[<span class="variable">i</span>].<span class="variable">getHeight</span>();
      }

      <span class="keyword">return</span> <span class="variable">wholeHeight</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getFeatures</strong></p>

<p><em>Returns an array of features (e.g. gene)</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Array</em>  of features</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getFeatures</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">features</span> = [];
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="this">this</span>.<span class="variable">tracks</span>.<span class="variable">length</span>; <span class="variable">i</span>++){
         <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">k</span>=<span class="number integer">0</span>; <span class="variable">k</span> &lt; <span class="this">this</span>.<span class="variable">tracks</span>[<span class="variable">i</span>].<span class="variable">lanes</span>.<span class="variable">length</span>; <span class="variable">k</span>++) {
            <span class="variable">features</span> = <span class="variable">features</span>.<span class="variable">concat</span>(<span class="this">this</span>.<span class="variable">tracks</span>[<span class="variable">i</span>].<span class="variable">lanes</span>[<span class="variable">k</span>].<span class="variable">features</span>);
         }
      }
      <span class="keyword">return</span> <span class="variable">features</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>setCanvas</strong></p>

<p><em>Changes the canvas that Scribl draws to</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Html Canvas Element</em>  the canvas to draw to</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">setCanvas</span>: <span class="keyword">function</span>(<span class="variable">canvas</span>){
      <span class="this">this</span>.<span class="variable">canvas</span> = <span class="variable">canvas</span>;
      <span class="this">this</span>.<span class="variable">ctx</span> = <span class="variable">canvas</span>.<span class="variable">getContext</span>(<span class="string">'2d'</span>);
     <span class="comment">// this.registerEventListeners();</span>
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addScale</strong></p>

<p><em>Inserts a scale at the end of the last track currently added to the chart</em></p>

<ul><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addScale</span>: <span class="keyword">function</span>() {
      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">userControlled</span>)
         <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">positions</span>.<span class="variable">push</span>( <span class="this">this</span>.<span class="variable">tracks</span>.<span class="variable">length</span> );
      <span class="keyword">else</span> {
         <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">positions</span> = [ <span class="this">this</span>.<span class="variable">tracks</span>.<span class="variable">length</span> ];
         <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">userControlled</span> = <span class="variable">true</span>;
      }
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addTrack</strong></p>

<p><em>Creates a new track and adds it to the Scribl chart/view</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Object</em>  the new track</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addTrack</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">track</span> = <span class="keyword">new</span> <span class="class">Track</span>(<span class="this">this</span>);
      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">tracks</span>.<span class="variable">length</span> == <span class="number integer">1</span> &amp;&amp; <span class="this">this</span>.<span class="variable">tracks</span>[<span class="number integer">0</span>] == <span class="variable">undefined</span>)
         <span class="this">this</span>.<span class="variable">tracks</span> = [];
      <span class="this">this</span>.<span class="variable">tracks</span>.<span class="variable">push</span>(<span class="variable">track</span>);
      <span class="keyword">return</span> <span class="variable">track</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>removeTrack</strong></p>

<p><em>removes a track</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  the track to be removed</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">removeTrack</span>: <span class="keyword">function</span>(<span class="variable">track</span>) {
	   <span class="keyword">var</span> <span class="variable">chart</span> = <span class="this">this</span>;
	   
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">chart</span>.<span class="variable">tracks</span>.<span class="variable">length</span>; <span class="variable">i</span>++){
         <span class="keyword">if</span> (<span class="variable">track</span>.<span class="variable">uid</span> == <span class="variable">chart</span>.<span class="variable">tracks</span>[<span class="variable">i</span>].<span class="variable">uid</span>)
            <span class="variable">chart</span>.<span class="variable">tracks</span>.<span class="variable">splice</span>(<span class="variable">i</span>,<span class="number integer">1</span>);
      }      
      <span class="keyword">delete</span> <span class="variable">track</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>loadGenbank</strong></p>

<p><em>parses a genbank file and adds the features to the Scribl chart/view</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  genbank file as a string</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">loadGenbank</span>: <span class="keyword">function</span>(<span class="variable">file</span>) {
      <span class="variable">genbank</span>(<span class="variable">file</span>, <span class="this">this</span>);
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>loadBed</strong></p>

<p><em>parses a bed file and adds the features to the Scribl chart/view</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  bed file as a string</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">loadBed</span>: <span class="keyword">function</span>(<span class="variable">file</span>) {
      <span class="variable">bed</span>(<span class="variable">file</span>, <span class="this">this</span>);
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>loadBam</strong></p>

<p><em>parses a bam file and adds the features to the Scribl chart/view</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>File</em>  bam file as a javascript file object</p></li><li><p><strong>param</strong>: <em>File</em>  bai (bam index) file as a javascript file object</p></li><li><p><strong>param</strong>: <em>Int</em>  start</p></li><li><p><strong>param</strong>: <em>Int</em>  end</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">loadBam</span>: <span class="keyword">function</span>(<span class="variable">bamFile</span>, <span class="variable">baiFile</span>, <span class="variable">chr</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">callback</span>) {
	   <span class="keyword">var</span> <span class="variable">scribl</span> = <span class="this">this</span>;
      <span class="comment">// scribl.scale.min = start;</span>
      <span class="comment">// scribl.scale.max = end;</span>
	   <span class="keyword">var</span> <span class="variable">track</span> = <span class="variable">scribl</span>.<span class="variable">addTrack</span>();
	   <span class="variable">track</span>.<span class="variable">status</span> = <span class="string">'waiting'</span>;
      <span class="variable">makeBam</span>(<span class="keyword">new</span> <span class="class">BlobFetchable</span>(<span class="variable">bamFile</span>), 
              <span class="keyword">new</span> <span class="class">BlobFetchable</span>(<span class="variable">baiFile</span>),
              <span class="keyword">function</span>(<span class="variable">bam</span>, <span class="variable">reader</span>) {
                 <span class="variable">scribl</span>.<span class="variable">file</span> = <span class="variable">bam</span>;
                 <span class="variable">bam</span>.<span class="variable">fetch</span>(<span class="variable">chr</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="keyword">function</span>(<span class="variable">r</span>, <span class="variable">e</span>) {
                                     <span class="keyword">if</span> (<span class="variable">r</span>) {
                                         <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">r</span>.<span class="variable">length</span>; <span class="variable">i</span> += <span class="number integer">1</span>) {
                                            <span class="variable">track</span>.<span class="variable">addFeature</span>( <span class="keyword">new</span> <span class="class">BlockArrow</span>(<span class="string">'bam'</span>, <span class="variable">r</span>[<span class="variable">i</span>].<span class="variable">pos</span>, <span class="variable">r</span>[<span class="variable">i</span>].<span class="variable">lengthOnRef</span>, <span class="string">'+'</span>, {<span class="string">'seq'</span>:<span class="variable">r</span>[<span class="variable">i</span>].<span class="variable">seq</span>}))
                                         }
                                         <span class="variable">track</span>.<span class="variable">status</span> = &quot;<span class="variable">received</span>&quot;;
                                         <span class="keyword">if</span> (<span class="variable">track</span>.<span class="variable">drawOnResponse</span>)
                                             <span class="variable">scribl</span>.<span class="variable">redraw</span>();
                                        <span class="comment">//callback();</span>
                                     }
                                     <span class="keyword">if</span> (<span class="variable">e</span>) {
                                         <span class="variable">alert</span>(<span class="string">'error: '</span> + <span class="variable">e</span>);
                                     }                 
                                  });
      });
      <span class="keyword">return</span> <span class="variable">track</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>loadFeatures</strong></p>

<p><em>adds the features to the Scribl chart/view</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array</em>  features - array of features, which can be any of the derived Glyph classes (e.g. Rect, Arrow, etc..)</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">loadFeatures</span>: <span class="keyword">function</span>(<span class="variable">features</span>) {
      <span class="keyword">for</span> ( <span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">features</span>.<span class="variable">length</span>; <span class="variable">i</span>++ )
         <span class="this">this</span>.<span class="variable">addFeature</span>( <span class="variable">features</span>[<span class="variable">i</span>] );
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addGene</strong></p>

<p><em>syntactic sugar function to add a feature with the gene type</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  position - start position of the feature</p></li><li><p><strong>param</strong>: <em>Int</em>  length - length of the feature</p></li><li><p><strong>param</strong>: <em>String</em>  strand - &#39;+&#39; or &#39;-&#39; strand</p></li><li><p><strong>param</strong>: <em>Hash</em>  [opts] - optional hash of options that can be applied to feature </p></li><li><p><strong>return</strong>: <em>Object</em>  feature - a feature with the &#39;feature&#39; type</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addGene</span>: <span class="keyword">function</span> (<span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) {
      <span class="keyword">return</span> (<span class="this">this</span>.<span class="variable">addFeature</span>(
         <span class="keyword">new</span> <span class="class">BlockArrow</span>(<span class="string">'gene'</span>, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>)
      ));
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addProtein</strong></p>

<p><em>syntactic sugar function to add a feature with the protein type</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  position - start position of the protein</p></li><li><p><strong>param</strong>: <em>Int</em>  length - length of the protein</p></li><li><p><strong>param</strong>: <em>String</em>  strand - &#39;+&#39; or &#39;-&#39; strand</p></li><li><p><strong>param</strong>: <em>Hash</em>  [opts] - optional hash of options that can be applied to protein  </p></li><li><p><strong>return</strong>: <em>Object</em>  protein - a feature with the &#39;protein&#39; type</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addProtein</span>: <span class="keyword">function</span>(<span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) {
      <span class="keyword">return</span> (<span class="this">this</span>.<span class="variable">addFeature</span>( 
         <span class="keyword">new</span> <span class="class">BlockArrow</span>(<span class="string">'protein'</span>, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) 
      ));
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addFeature</strong></p>

<p><em>addFeature to Scribl chart/view and let Scribl manage track and lane placement to avoid overlaps</em></p>

<p>example:
<code>chart.addFeature( new Rect(&#39;complex&#39;,3500, 2000) );</code></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  feature - any of the derived Glyph classes (e.g. Rect, Arrow, etc..)</p></li><li><p><strong>return</strong>: <em>Object</em>  feature     </p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addFeature</span>: <span class="keyword">function</span>( <span class="variable">feature</span> ) {	
      <span class="keyword">var</span> <span class="variable">track</span> = <span class="this">this</span>.<span class="variable">tracks</span>[<span class="number integer">0</span>] || <span class="this">this</span>.<span class="variable">addTrack</span>();
      <span class="variable">track</span>.<span class="variable">addFeature</span>(<span class="variable">feature</span>);
      <span class="keyword">return</span> <span class="variable">feature</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>slice</strong></p>

<p><em>slices the Scribl chart/view at given places and returns a smaller chart/view</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  from - nucleotide position to slice from</p></li><li><p><strong>param</strong>: <em>Int</em>  to - nucleotide position to slice to     </p></li><li><p><strong>param</strong>: <em>String</em>  type - <em>inclusive</em> (defaulte) includes any feature that has any part in region, <em>exclusive</em>, includes only features that are entirely in the region, <em>strict</em> if feature is partly in region, it&#39;ll cut that feature at the boundary and include the cut portion</p></li><li><p><strong>return</strong>: <em>Object</em>  Scribl   </p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">slice</span>: <span class="keyword">function</span>(<span class="variable">from</span>, <span class="variable">to</span>, <span class="variable">type</span>) {
      <span class="variable">type</span> = <span class="variable">type</span> || <span class="string">'inclusive'</span>;
      <span class="keyword">var</span> <span class="variable">chart</span> = <span class="this">this</span>;
      <span class="keyword">var</span> <span class="variable">sliced_features</span> = [];
		
      <span class="comment">// iterate through tracks</span>
      <span class="keyword">var</span> <span class="variable">numTracks</span> = <span class="this">this</span>.<span class="variable">tracks</span>.<span class="variable">length</span>;
      <span class="keyword">var</span> <span class="variable">newChart</span> = <span class="keyword">new</span> <span class="class">Scribl</span>(<span class="this">this</span>.<span class="variable">canvas</span>, <span class="this">this</span>.<span class="variable">width</span>);
      
      <span class="comment">// TODO: make this more robust</span>
      <span class="variable">newChart</span>.<span class="variable">scale</span>.<span class="variable">min</span>    = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span>;      
      <span class="variable">newChart</span>.<span class="variable">scale</span>.<span class="variable">max</span>    = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">max</span>;
      <span class="variable">newChart</span>.<span class="variable">offset</span>       = <span class="this">this</span>.<span class="variable">offset</span>;
      <span class="variable">newChart</span>.<span class="variable">scale</span>.<span class="variable">off</span>    = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">off</span>;
      <span class="variable">newChart</span>.<span class="variable">scale</span>.<span class="variable">pretty</span> = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">pretty</span>;      
      <span class="variable">newChart</span>.<span class="variable">laneSizes</span>    = <span class="this">this</span>.<span class="variable">laneSizes</span>;
      <span class="variable">newChart</span>.<span class="variable">drawStyle</span>    = <span class="this">this</span>.<span class="variable">drawStyle</span>;
      <span class="variable">newChart</span>.<span class="variable">glyph</span>        = <span class="this">this</span>.<span class="variable">glyph</span>;
      <span class="variable">newChart</span>.<span class="variable">glyphHooks</span>   = <span class="this">this</span>.<span class="variable">glyphHooks</span>;
      <span class="variable">newChart</span>.<span class="variable">trackHooks</span>   = <span class="this">this</span>.<span class="variable">trackHooks</span>;
<span class="comment">//      newChart.mouseHandler = this.mouseHandler;</span>
<span class="comment">//      newChart.clickHandler = this.clickHandler;</span>
      <span class="variable">newChart</span>.<span class="variable">previousDrawStyle</span> = <span class="this">this</span>.<span class="variable">previousDrawStyle</span>;
      
      <span class="comment">// for ( var i in object.getOwnPropertyNames(this) ) {</span>
      <span class="comment">//    newChart[i] = this[i];</span>
      <span class="comment">// }</span>
      
      <span class="comment">// Aliases for the rather verbose methods on ES5</span>
      <span class="comment">// var descriptor  = Object.getOwnPropertyDescriptor</span>
      <span class="comment">//   , properties  = Object.getOwnPropertyNames</span>
      <span class="comment">//   , define_prop = Object.defineProperty</span>

      <span class="comment">// (target:Object, source:Object) â†’ Object</span>
      <span class="comment">// Copies properties from `source' to `target'</span>

          <span class="comment">// properties(chart).forEach(function(key) {</span>
          <span class="comment">//     define_prop(newChart, key, descriptor(chart, key)) })</span>

		
      <span class="keyword">for</span> ( <span class="keyword">var</span> <span class="variable">j</span>=<span class="number integer">0</span>; <span class="variable">j</span> &lt; <span class="variable">numTracks</span>; <span class="variable">j</span>++) {
         <span class="keyword">var</span> <span class="variable">track</span> = <span class="this">this</span>.<span class="variable">tracks</span>[<span class="variable">j</span>];
         <span class="keyword">var</span> <span class="variable">newTrack</span> = <span class="variable">newChart</span>.<span class="variable">addTrack</span>();
         <span class="variable">newTrack</span>.<span class="variable">drawStyle</span> = <span class="variable">track</span>.<span class="variable">drawStyle</span>;
         <span class="keyword">var</span> <span class="variable">numLanes</span> = <span class="variable">track</span>.<span class="variable">lanes</span>.<span class="variable">length</span>;
         <span class="keyword">for</span> ( <span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">numLanes</span>; <span class="variable">i</span>++ ) {
            <span class="keyword">var</span> <span class="variable">newLane</span> = <span class="variable">newTrack</span>.<span class="variable">addLane</span>();
            <span class="keyword">var</span> <span class="variable">s_features</span> = <span class="variable">track</span>.<span class="variable">lanes</span>[<span class="variable">i</span>].<span class="variable">features</span>;
            <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">k</span>=<span class="number integer">0</span>; <span class="variable">k</span> &lt; <span class="variable">s_features</span>.<span class="variable">length</span>; <span class="variable">k</span>++ ) {
               <span class="keyword">var</span> <span class="variable">end</span> = <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">position</span> + <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">length</span>;
               <span class="keyword">var</span> <span class="variable">start</span> = <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">position</span>;               
               <span class="comment">// determine if feature is in slice/region</span>
               <span class="keyword">if</span>(<span class="variable">type</span> == <span class="string">'inclusive'</span>) {
                  <span class="keyword">if</span> ( <span class="variable">start</span> &gt;= <span class="variable">from</span> &amp;&amp; <span class="variable">start</span> &lt;= <span class="variable">to</span> )
                     <span class="variable">newLane</span>.<span class="variable">addFeature</span>( <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">clone</span>() )
                  <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">end</span> &gt; <span class="variable">from</span> &amp;&amp; <span class="variable">end</span> &lt; <span class="variable">to</span> )
                     <span class="variable">newLane</span>.<span class="variable">addFeature</span>( <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">clone</span>() )				
                  <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">start</span> &lt; <span class="variable">from</span> &amp;&amp; <span class="variable">end</span> &gt; <span class="variable">to</span> )
                     <span class="variable">newLane</span>.<span class="variable">addFeature</span>( <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">clone</span>() )				
                  <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">start</span> &gt; <span class="variable">from</span> &amp;&amp; <span class="variable">end</span> &lt; <span class="variable">to</span>)
                     <span class="variable">newLane</span>.<span class="variable">addFeature</span>( <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">clone</span>() )				
               } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">type</span> == <span class="string">'strict'</span>) {
                  <span class="keyword">if</span> ( <span class="variable">start</span> &gt;= <span class="variable">from</span> &amp;&amp; <span class="variable">start</span> &lt;= <span class="variable">to</span>){
                     <span class="keyword">if</span> (<span class="variable">end</span> &gt; <span class="variable">from</span> &amp;&amp; <span class="variable">end</span> &lt; <span class="variable">to</span>)
                        <span class="variable">newLane</span>.<span class="variable">addFeature</span>( <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">clone</span>() )
                     <span class="keyword">else</span> {
                        <span class="comment">// turn first half into rect to stop having two block arrows features    </span>
                        <span class="keyword">if</span> (<span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">glyphType</span> == &quot;<span class="class">BlockArrow</span>&quot; &amp;&amp; <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">strand</span> == &quot;+&quot;)                                               
                           <span class="keyword">var</span> <span class="variable">f</span> = <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">clone</span>(&quot;<span class="class">Rect</span>&quot;);
                        <span class="keyword">else</span>
                           <span class="keyword">var</span> <span class="variable">f</span> = <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">clone</span>();
                           
                        <span class="variable">f</span>.<span class="variable">length</span> = <span class="class">Math</span>.<span class="variable">abs</span>(<span class="variable">to</span> - <span class="variable">start</span>);
                        <span class="variable">newLane</span>.<span class="variable">addFeature</span>( <span class="variable">f</span> );
                     }
                  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">end</span> &gt; <span class="variable">from</span> &amp;&amp; <span class="variable">end</span> &lt; <span class="variable">to</span>) {
                     <span class="comment">// turn first half into rect to stop having two block arrows features    </span>
                     <span class="keyword">if</span> (<span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">glyphType</span> == &quot;<span class="class">BlockArrow</span>&quot; &amp;&amp; <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">strand</span> == &quot;-&quot;)                                               
                        <span class="keyword">var</span> <span class="variable">f</span> = <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">clone</span>(&quot;<span class="class">Rect</span>&quot;);
                     <span class="keyword">else</span>
                        <span class="keyword">var</span> <span class="variable">f</span> = <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">clone</span>();
                     
                     <span class="variable">f</span>.<span class="variable">position</span> = <span class="variable">from</span>;
                     <span class="variable">f</span>.<span class="variable">length</span> = <span class="class">Math</span>.<span class="variable">abs</span>(<span class="variable">end</span> - <span class="variable">from</span>);
                     <span class="variable">newLane</span>.<span class="variable">addFeature</span>( <span class="variable">f</span> );
                  }
                  <span class="keyword">else</span> <span class="keyword">if</span>( <span class="variable">start</span> &lt; <span class="variable">from</span> &amp;&amp; <span class="variable">end</span> &gt; <span class="variable">to</span>){
                     <span class="comment">// turn first half into rect to stop having two block arrows features    </span>
                     <span class="keyword">if</span> (<span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">glyphType</span> == &quot;<span class="class">BlockArrow</span>&quot;)                                               
                        <span class="keyword">var</span> <span class="variable">f</span> = <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">clone</span>(&quot;<span class="class">Rect</span>&quot;);
                     <span class="keyword">else</span>
                        <span class="keyword">var</span> <span class="variable">f</span> = <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">clone</span>();
                     <span class="variable">f</span>.<span class="variable">position</span> = <span class="variable">from</span>;
                     <span class="variable">f</span>.<span class="variable">length</span> = <span class="class">Math</span>.<span class="variable">abs</span>(<span class="variable">to</span> - <span class="variable">from</span>);
                     <span class="variable">newLane</span>.<span class="variable">addFeature</span>( <span class="variable">f</span> );
                  }
               } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">type</span> == <span class="string">'exclusive'</span>) {
                  <span class="keyword">if</span> ( <span class="variable">start</span> &gt;= <span class="variable">from</span> &amp;&amp; <span class="variable">start</span> &lt;= <span class="variable">to</span> &amp;&amp; <span class="variable">end</span> &gt; <span class="variable">from</span> &amp;&amp; <span class="variable">end</span> &lt; <span class="variable">to</span>)
                     <span class="variable">newLane</span>.<span class="variable">addFeature</span>( <span class="variable">s_features</span>[<span class="variable">k</span>].<span class="variable">clone</span>() )
               }
        			
            }				
			
         }
      }

      
      <span class="comment">// for (var attr in this) {</span>
      <span class="comment">//    if (this.hasOwnProperty(attr)) copy[attr] = this[attr];</span>
      <span class="comment">// }</span>

      <span class="keyword">return</span> <span class="variable">newChart</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>draw</strong></p>

<p><em>draws everything</em></p>

<ul><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">draw</span>: <span class="keyword">function</span>() {
      <span class="comment">// initalize variables</span>
      <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="this">this</span>.<span class="variable">ctx</span>;
      <span class="keyword">var</span> <span class="variable">tracks</span> = <span class="this">this</span>.<span class="variable">tracks</span>;
      
      <span class="comment">// check if scrollable</span>
      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">scrollable</span> == <span class="variable">true</span>) {		    
         <span class="this">this</span>.<span class="variable">initScrollable</span>();
      }
		
      <span class="variable">ctx</span>.<span class="variable">save</span>();
      <span class="comment">// make scale pretty by starting and ending the scale</span>
      <span class="comment">// at major ticks and choosing best tick distances</span>
      <span class="this">this</span>.<span class="variable">initScale</span>();
					
      <span class="comment">// fix offsets so scale will not be cut off on left side</span>
      <span class="comment">// check if offset is turned off and then set it to static '0'</span>
      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">offset</span> == <span class="variable">undefined</span>) 
         <span class="this">this</span>.<span class="variable">offset</span> = <span class="class">Math</span>.<span class="variable">ceil</span>( <span class="variable">ctx</span>.<span class="variable">measureText</span>(<span class="string">'0'</span>).<span class="variable">width</span>/<span class="number integer">2</span> + <span class="number integer">10</span> );			

<span class="comment">//      ctx.save();				</span>

      <span class="variable">ctx</span>.<span class="variable">save</span>();

      <span class="comment">// draw tracks</span>
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span>&lt;<span class="variable">tracks</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
         <span class="comment">// draw scale</span>
         <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">off</span> &amp;&amp; <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">positions</span>.<span class="variable">indexOf</span>(<span class="variable">i</span>) != -<span class="number integer">1</span>)
            <span class="this">this</span>.<span class="variable">drawScale</span>();            
         <span class="variable">tracks</span>[<span class="variable">i</span>].<span class="variable">draw</span>();
      }
      
      <span class="comment">// test if scale is drawn last</span>
      <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">off</span> &amp;&amp; <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">positions</span>.<span class="variable">indexOf</span>(<span class="variable">tracks</span>.<span class="variable">length</span>) != -<span class="number integer">1</span>)
         <span class="this">this</span>.<span class="variable">drawScale</span>();                  
		
<span class="comment">//      ctx.restore();	</span>
      <span class="variable">ctx</span>.<span class="variable">restore</span>();	
      <span class="variable">ctx</span>.<span class="variable">restore</span>();	
		
      <span class="comment">// add events if haven't done so already</span>
      <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">events</span>.<span class="variable">added</span>)
         <span class="this">this</span>.<span class="variable">registerEventListeners</span>();
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>redraw</strong></p>

<p><em>clears chart/view and draws it</em></p>

<ul><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">redraw</span>: <span class="keyword">function</span>(){
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">clearRect</span>(<span class="number integer">0</span>,<span class="number integer">0</span>,<span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">width</span>, <span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">height</span>);
      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">tracks</span>.<span class="variable">length</span> &gt; <span class="number integer">0</span>)
         <span class="this">this</span>.<span class="variable">draw</span>();
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>initScale</strong></p>

<p><em>initializes scale</em></p>

<ul><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">initScale</span>: <span class="keyword">function</span>() {
	   <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">pretty</span>) {					
		
         <span class="comment">// determine reasonable tick intervals</span>
         <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">auto</span>) {
            <span class="comment">// set major tick interval</span>
            <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span>.<span class="variable">size</span> = <span class="this">this</span>.<span class="variable">determineMajorTick</span>();

            <span class="comment">// set minor tick interval</span>
            <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">minor</span>.<span class="variable">size</span> = <span class="class">Math</span>.<span class="variable">round</span>(<span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span>.<span class="variable">size</span> / <span class="number integer">10</span>);
         }			
		
         <span class="comment">// make scale end on major ticks</span>
         <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">auto</span>) { 
            <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span> -= <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span> % <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span>.<span class="variable">size</span>;
            <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">max</span> = <span class="class">Math</span>.<span class="variable">round</span>(<span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">max</span> / <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span>.<span class="variable">size</span> + .<span class="number integer">4</span>) 
               * <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span>.<span class="variable">size</span>;
         }
      }
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>drawScale</strong></p>

<p><em>draws scale</em></p>

<ul><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">drawScale</span>: <span class="keyword">function</span>(<span class="variable">options</span>){	   
      <span class="keyword">var</span> <span class="variable">firstMinorTick</span>;
      <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="this">this</span>.<span class="variable">ctx</span>;
      <span class="keyword">var</span> <span class="variable">fillStyleRevert</span> = <span class="variable">ctx</span>.<span class="variable">fillStyle</span>;
      
      <span class="keyword">if</span>(<span class="variable">options</span> &amp;&amp; <span class="variable">options</span>.<span class="variable">init</span>)
         <span class="this">this</span>.<span class="variable">initScale</span>();
      
      <span class="comment">// determine tick vertical sizes and vertical tick positions</span>
      <span class="keyword">var</span> <span class="variable">tickStartPos</span> = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span>.<span class="variable">size</span> + <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">size</span>;
      <span class="keyword">var</span> <span class="variable">majorTickEndPos</span> = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span>.<span class="variable">size</span> + <span class="number integer">2</span>;
      <span class="keyword">var</span> <span class="variable">minorTickEndPos</span> = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span>.<span class="variable">size</span> + <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">size</span> * <span class="number float">0.66</span>;
      <span class="keyword">var</span> <span class="variable">halfTickEndPos</span> = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span>.<span class="variable">size</span> + <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">size</span> * <span class="number float">0.33</span>;
      
      <span class="comment">// set scale defaults</span>
      <span class="variable">ctx</span>.<span class="variable">font</span> = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span>.<span class="variable">size</span> + <span class="string">'px arial'</span>;
      <span class="variable">ctx</span>.<span class="variable">textBaseline</span> = <span class="string">'top'</span>;		
      <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span>.<span class="variable">color</span>;
      
      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">offset</span> == <span class="variable">undefined</span>) 
         <span class="this">this</span>.<span class="variable">offset</span> = <span class="class">Math</span>.<span class="variable">ceil</span>( <span class="variable">ctx</span>.<span class="variable">measureText</span>(<span class="string">'0'</span>).<span class="variable">width</span>/<span class="number integer">2</span> + <span class="number integer">10</span> );      
      
      <span class="comment">// determine the place to start first minor tick</span>
      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span> % <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">minor</span>.<span class="variable">size</span> == <span class="number integer">0</span>)
         <span class="variable">firstMinorTick</span> = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span>
      <span class="keyword">else</span>
         <span class="variable">firstMinorTick</span> = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span> - (<span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span> % <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">minor</span>.<span class="variable">size</span>) 
            + <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">minor</span>.<span class="variable">size</span>;
 		    
      <span class="comment">// draw</span>
      <span class="keyword">for</span>(<span class="keyword">var</span> <span class="variable">i</span> = <span class="variable">firstMinorTick</span>; <span class="variable">i</span> &lt;= <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">max</span>; <span class="variable">i</span> += <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">minor</span>.<span class="variable">size</span>){		    
         <span class="variable">ctx</span>.<span class="variable">beginPath</span>();
         <span class="keyword">if</span>(<span class="variable">i</span> == <span class="number integer">187250</span>)
            <span class="keyword">var</span> <span class="variable">h</span> = <span class="number integer">2</span>;
         <span class="keyword">var</span> <span class="variable">curr_pos</span> = <span class="this">this</span>.<span class="variable">pixelsToNts</span>(<span class="variable">i</span> - <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span>) + <span class="this">this</span>.<span class="variable">offset</span>;
         <span class="keyword">if</span> ( <span class="variable">i</span> % <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span>.<span class="variable">size</span> == <span class="number integer">0</span>) { <span class="comment">// draw major tick</span>
            <span class="comment">// create text</span>
            <span class="keyword">var</span> <span class="variable">tickText</span> = <span class="this">this</span>.<span class="variable">getTickText</span>(<span class="variable">i</span>);
            <span class="variable">ctx</span>.<span class="variable">textAlign</span> = <span class="string">'center'</span>;
            <span class="variable">ctx</span>.<span class="variable">fillText</span>( <span class="variable">tickText</span> , <span class="variable">curr_pos</span>, <span class="number integer">0</span> );

            <span class="comment">// create major tick</span>
            <span class="variable">ctx</span>.<span class="variable">moveTo</span>( <span class="variable">curr_pos</span>, <span class="variable">tickStartPos</span> );
            <span class="variable">ctx</span>.<span class="variable">lineTo</span>( <span class="variable">curr_pos</span>, <span class="variable">majorTickEndPos</span> );
            <span class="variable">ctx</span>.<span class="variable">strokeStyle</span> = <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span>.<span class="variable">color</span>;
            <span class="variable">ctx</span>.<span class="variable">stroke</span>();

            } <span class="keyword">else</span> { <span class="comment">// draw minor tick</span>
               <span class="variable">ctx</span>.<span class="variable">moveTo</span>( <span class="variable">curr_pos</span>, <span class="variable">tickStartPos</span> );

               <span class="comment">// create half tick - tick between two major ticks</span>
               <span class="keyword">if</span> ( <span class="variable">i</span> % (<span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span>.<span class="variable">size</span>/<span class="number integer">2</span>) == <span class="number integer">0</span> ) {
                  <span class="variable">ctx</span>.<span class="variable">strokeStyle</span> = <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">halfColor</span>;
                  <span class="variable">ctx</span>.<span class="variable">lineTo</span>( <span class="variable">curr_pos</span>, <span class="variable">halfTickEndPos</span> );
               }
               <span class="comment">// create minor tick</span>
               <span class="keyword">else</span>{
                  <span class="variable">ctx</span>.<span class="variable">strokeStyle</span> = <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">minor</span>.<span class="variable">color</span>;
                  <span class="variable">ctx</span>.<span class="variable">lineTo</span>( <span class="variable">curr_pos</span>, <span class="variable">minorTickEndPos</span> );
               }
               <span class="variable">ctx</span>.<span class="variable">stroke</span>();
            }            
         }
                           
         <span class="comment">// restore fillstyle</span>
         <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">fillStyleRevert</span>;

         <span class="comment">// shift down size of scale</span>
         <span class="variable">ctx</span>.<span class="variable">translate</span>(<span class="number integer">0</span>, <span class="this">this</span>.<span class="variable">getScaleHeight</span>() + <span class="this">this</span>.<span class="variable">laneBuffer</span>);
      },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>pixelsToNts</strong></p>

<p><em>Get the number of nucleotides per the given pixels</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  [pixels] optional - if not given, the ratio of pixels/nts will be returned</p></li><li><p><strong>return</strong>: <em>Int</em>  nucleotides or pixels/nts ratio</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">pixelsToNts</span>: <span class="keyword">function</span>(<span class="variable">pixels</span>) { 
      <span class="keyword">if</span> (<span class="variable">pixels</span> == <span class="variable">undefined</span>)
         <span class="keyword">return</span> ( <span class="this">this</span>.<span class="variable">width</span> / ( <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">max</span> - <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span>) );
      <span class="keyword">else</span>
         <span class="keyword">return</span> ( <span class="this">this</span>.<span class="variable">width</span> / ( <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">max</span> - <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span>) * <span class="variable">pixels</span>  );
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>ntsToPixels</strong></p>

<p><em>Get the number of pixels shown per given nucleotides</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  [nucleotides] optional - if not given, the ratio of nts/pixel will be returned</p></li><li><p><strong>return</strong>: <em>Int</em>  pixels or nts/pixel ratio</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">ntsToPixels</span>: <span class="keyword">function</span>(<span class="variable">nts</span>) { 
      <span class="keyword">if</span> (<span class="variable">nts</span> == <span class="variable">undefined</span>) 
         <span class="keyword">return</span> ( <span class="number integer">1</span> / <span class="this">this</span>.<span class="variable">pixelsToNts</span>() );
      <span class="keyword">else</span>
         <span class="keyword">return</span> ( <span class="variable">nts</span> / <span class="this">this</span>.<span class="variable">width</span> );
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>initScrollable</strong></p>

<p><em>turns static chart into scrollable chart</em></p>

<ul><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">initScrollable</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">scrollStartMin</span>;
	    
      <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">scrolled</span>){
         <span class="comment">// create divs</span>
         <span class="keyword">var</span> <span class="variable">parentDiv</span> = <span class="variable">document</span>.<span class="variable">createElement</span>(<span class="string">'div'</span>);
         <span class="keyword">var</span> <span class="variable">canvasContainer</span> = <span class="variable">document</span>.<span class="variable">createElement</span>(<span class="string">'div'</span>);
         <span class="keyword">var</span> <span class="variable">sliderDiv</span> = <span class="variable">document</span>.<span class="variable">createElement</span>(<span class="string">'div'</span>);
         <span class="variable">sliderDiv</span>.<span class="variable">id</span> = <span class="string">'scribl-zoom-slider'</span>;
         <span class="variable">sliderDiv</span>.<span class="variable">className</span> = <span class="string">'slider'</span>;
         <span class="variable">sliderDiv</span>.<span class="variable">style</span>.<span class="variable">cssFloat</span> = <span class="string">'left'</span>;
         <span class="variable">sliderDiv</span>.<span class="variable">style</span>.<span class="variable">height</span> = (<span class="keyword">new</span> <span class="class">String</span>(<span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">height</span> * .<span class="number integer">5</span>)) + <span class="string">'px'</span>;
         <span class="variable">sliderDiv</span>.<span class="variable">style</span>.<span class="variable">margin</span> = <span class="string">'30px auto auto -20px'</span>
        
         <span class="comment">// grab css styling from canavs</span>
         <span class="variable">parentDiv</span>.<span class="variable">style</span>.<span class="variable">cssText</span> = <span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">style</span>.<span class="variable">cssText</span>;
         <span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">style</span>.<span class="variable">cssText</span> = <span class="string">''</span>;
         <span class="variable">parentWidth</span> = <span class="variable">parseInt</span>(<span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">width</span>) + <span class="number integer">25</span>;
         <span class="variable">parentDiv</span>.<span class="variable">style</span>.<span class="variable">width</span> = <span class="variable">parentWidth</span> + <span class="string">'px'</span>;
         <span class="variable">canvasContainer</span>.<span class="variable">style</span>.<span class="variable">width</span> = <span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">width</span> + <span class="string">'px'</span>;
         <span class="variable">canvasContainer</span>.<span class="variable">style</span>.<span class="variable">overflow</span> = <span class="string">'auto'</span>;
         <span class="variable">canvasContainer</span>.<span class="variable">id</span> = <span class="string">'scroll-wrapper'</span>;                     
         
         
         
         <span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">parentNode</span>.<span class="variable">replaceChild</span>(<span class="variable">parentDiv</span>, <span class="this">this</span>.<span class="variable">canvas</span>);
         <span class="variable">parentDiv</span>.<span class="variable">appendChild</span>(<span class="variable">sliderDiv</span>);
         <span class="variable">canvasContainer</span>.<span class="variable">appendChild</span>(<span class="this">this</span>.<span class="variable">canvas</span>);
         <span class="variable">parentDiv</span>.<span class="variable">appendChild</span>(<span class="variable">canvasContainer</span>);

         <span class="variable">jQuery</span>(<span class="variable">canvasContainer</span>).<span class="variable">dragscrollable</span>({<span class="variable">dragSelector</span>: <span class="string">'canvas:first'</span>, <span class="variable">acceptPropagatedEvent</span>: <span class="variable">false</span>});      
      }
           
      <span class="keyword">var</span> <span class="variable">totalNts</span> =  <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">max</span> - <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span>;
      <span class="keyword">var</span> <span class="variable">scrollStartMax</span> = <span class="this">this</span>.<span class="variable">scrollValues</span>[<span class="number integer">1</span>] || <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">max</span> - <span class="variable">totalNts</span> * .<span class="number integer">35</span>;
      <span class="keyword">if</span>( <span class="this">this</span>.<span class="variable">scrollValues</span>[<span class="number integer">0</span>] != <span class="variable">undefined</span>)
          <span class="variable">scrollStartMin</span> = <span class="this">this</span>.<span class="variable">scrollValues</span>[<span class="number integer">0</span>];
      <span class="keyword">else</span>
          <span class="variable">scrollStartMin</span> = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">max</span> + <span class="variable">totalNts</span> * .<span class="number integer">35</span>;            

      <span class="keyword">var</span> <span class="variable">viewNts</span> = <span class="variable">scrollStartMax</span> - <span class="variable">scrollStartMin</span>;            
      <span class="keyword">var</span> <span class="variable">viewNtsPerPixel</span> = <span class="variable">viewNts</span> / <span class="variable">document</span>.<span class="variable">getElementById</span>(<span class="string">'scroll-wrapper'</span>).<span class="variable">style</span>.<span class="variable">width</span>.<span class="variable">split</span>(<span class="string">'px'</span>)[<span class="number integer">0</span>];

      <span class="keyword">var</span> <span class="variable">canvasWidth</span> = (<span class="variable">totalNts</span> / <span class="variable">viewNtsPerPixel</span>) || <span class="number integer">100</span>;
      <span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">width</span> = <span class="variable">canvasWidth</span>;
      <span class="this">this</span>.<span class="variable">width</span> = <span class="variable">canvasWidth</span> - <span class="number integer">30</span>;
      <span class="variable">schart</span> = <span class="this">this</span>;
      <span class="keyword">var</span> <span class="variable">zoomValue</span> = (<span class="variable">scrollStartMax</span> - <span class="variable">scrollStartMin</span>) / (<span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">max</span> - <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span>) * <span class="number integer">100</span> || <span class="number integer">1</span>;

      <span class="variable">jQuery</span>(<span class="variable">sliderDiv</span>).<span class="variable">slider</span>({
         <span class="variable">orientation</span>: <span class="string">'vertical'</span>,
         <span class="variable">range</span>: <span class="string">'min'</span>,
         <span class="variable">min</span>: <span class="number integer">6</span>,
         <span class="variable">max</span>: <span class="number integer">100</span>,
         <span class="variable">value</span>: <span class="variable">zoomValue</span>,
         <span class="variable">slide</span>: <span class="keyword">function</span>( <span class="variable">event</span>, <span class="variable">ui</span> ) {
            <span class="keyword">var</span> <span class="variable">totalNts</span> = <span class="variable">schart</span>.<span class="variable">scale</span>.<span class="variable">max</span> - <span class="variable">schart</span>.<span class="variable">scale</span>.<span class="variable">min</span>;
            <span class="keyword">var</span> <span class="variable">width</span> = <span class="variable">ui</span>[<span class="string">'value'</span>] / <span class="number integer">100</span> * <span class="variable">totalNts</span>;
            <span class="keyword">var</span> <span class="variable">widthPixels</span> = <span class="variable">ui</span>[<span class="string">'value'</span>] / <span class="number integer">100</span> * <span class="variable">schart</span>.<span class="variable">canvas</span>.<span class="variable">width</span>;
            <span class="keyword">var</span> <span class="variable">canvasContainer</span> = <span class="variable">document</span>.<span class="variable">getElementById</span>(<span class="string">'scroll-wrapper'</span>);
            <span class="keyword">var</span> <span class="variable">center</span> = <span class="variable">canvasContainer</span>.<span class="variable">scrollLeft</span> + <span class="variable">parseInt</span>(<span class="variable">canvasContainer</span>.<span class="variable">style</span>.<span class="variable">width</span>.<span class="variable">split</span>(<span class="string">'px'</span>)[<span class="number integer">0</span>]) / <span class="number integer">2</span>;
                    
            <span class="comment">// get min max pixels</span>
            <span class="keyword">var</span> <span class="variable">minPixel</span> = <span class="variable">center</span> - <span class="variable">widthPixels</span>/<span class="number integer">2</span>;
            <span class="keyword">var</span> <span class="variable">maxPixel</span> = <span class="variable">center</span> + <span class="variable">widthPixels</span>/<span class="number integer">2</span>;
            
            <span class="comment">// convert to nt</span>
            <span class="keyword">var</span> <span class="variable">min</span> = <span class="variable">schart</span>.<span class="variable">scale</span>.<span class="variable">min</span> + (<span class="variable">minPixel</span> / <span class="variable">schart</span>.<span class="variable">canvas</span>.<span class="variable">width</span>) * <span class="variable">totalNts</span>;
            <span class="keyword">var</span> <span class="variable">max</span> = <span class="variable">schart</span>.<span class="variable">scale</span>.<span class="variable">min</span> + (<span class="variable">maxPixel</span> / <span class="variable">schart</span>.<span class="variable">canvas</span>.<span class="variable">width</span>) * <span class="variable">totalNts</span>;

            <span class="variable">schart</span>.<span class="variable">scrollValues</span> = [<span class="variable">min</span>, <span class="variable">max</span>];
            <span class="variable">schart</span>.<span class="variable">ctx</span>.<span class="variable">clearRect</span>(<span class="number integer">0</span>, <span class="number integer">0</span>, <span class="variable">schart</span>.<span class="variable">canvas</span>.<span class="variable">width</span>, <span class="variable">schart</span>.<span class="variable">canvas</span>.<span class="variable">height</span>);
            <span class="variable">schart</span>.<span class="variable">draw</span>();
         }
      });
        

      <span class="keyword">var</span> <span class="variable">startingPixel</span> = (<span class="variable">scrollStartMin</span> - <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span>) / <span class="variable">totalNts</span> * <span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">width</span>;        
      <span class="variable">document</span>.<span class="variable">getElementById</span>(<span class="string">'scroll-wrapper'</span>).<span class="variable">scrollLeft</span> = <span class="variable">startingPixel</span>;
      <span class="this">this</span>.<span class="variable">scrolled</span> = <span class="variable">true</span>;
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>determineMajorTick</strong></p>

<p><em>intelligently determines a major tick interval based on size of the chart/view and size of the numbers on the scale</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Int</em>  major tick interval</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">determineMajorTick</span>: <span class="keyword">function</span>() {
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">font</span> = <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span>.<span class="variable">size</span> + <span class="string">'px arial'</span>;
      <span class="keyword">var</span> <span class="variable">numtimes</span> = <span class="this">this</span>.<span class="variable">width</span>/(<span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">measureText</span>(<span class="this">this</span>.<span class="variable">getTickTextDecimalPlaces</span>(<span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">max</span>)).<span class="variable">width</span> + <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">font</span>.<span class="variable">buffer</span>);

      <span class="comment">// figure out the base of the tick (e.g. 2120 =&gt; 2000)</span>
      <span class="keyword">var</span> <span class="variable">irregularTick</span> = (<span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">max</span> - <span class="this">this</span>.<span class="variable">scale</span>.<span class="variable">min</span>) / <span class="variable">numtimes</span>;
      <span class="keyword">var</span> <span class="variable">baseNum</span> =  <span class="class">Math</span>.<span class="variable">pow</span>(<span class="number integer">10</span>, <span class="variable">parseInt</span>(<span class="variable">irregularTick</span>).<span class="variable">toString</span>().<span class="variable">length</span> -<span class="number integer">1</span>);
      <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span>.<span class="variable">size</span> = <span class="class">Math</span>.<span class="variable">ceil</span>(<span class="variable">irregularTick</span> / <span class="variable">baseNum</span>) * <span class="variable">baseNum</span>;		
				
		<span class="comment">// round up to a 5* or 1* number (e.g 5000 or 10000)</span>
      <span class="keyword">var</span> <span class="variable">digits</span> = (<span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span>.<span class="variable">size</span> + <span class="string">''</span>).<span class="variable">length</span>;
      <span class="keyword">var</span> <span class="variable">places</span> = <span class="class">Math</span>.<span class="variable">pow</span>(<span class="number integer">10</span>, <span class="variable">digits</span>);
      <span class="keyword">var</span> <span class="variable">first_digit</span> = <span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">major</span>.<span class="variable">size</span> / <span class="variable">places</span>;
      
      <span class="keyword">if</span> (<span class="variable">first_digit</span> &gt; .<span class="number integer">1</span> &amp;&amp; <span class="variable">first_digit</span> &lt;= .<span class="number integer">5</span>)
      	<span class="variable">first_digit</span> = .<span class="number integer">5</span>;
      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">first_digit</span> &gt; .<span class="number integer">5</span>)
      	<span class="variable">first_digit</span> = <span class="number integer">1</span>;
      
      <span class="comment">// return major tick interval</span>
      <span class="keyword">return</span> (<span class="variable">first_digit</span> * <span class="variable">places</span>);
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getTickText</strong></p>

<p><em>abbreviates tick text numbers using &#39;k&#39;, or &#39;m&#39; (e.g. 10000 becomes 10k)</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  tickNumber - the tick number that needs to be abbreviated</p></li><li><p><strong>return</strong>: <em>String</em>  abbreviated tickNumber</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getTickText</span>: <span class="keyword">function</span>(<span class="variable">tickNumber</span>) {
      <span class="keyword">if</span> ( !<span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">auto</span> )
         <span class="keyword">return</span> <span class="variable">tickNumber</span>;
		
      <span class="keyword">var</span> <span class="variable">tickText</span> = <span class="variable">tickNumber</span>;
      <span class="keyword">if</span> (<span class="variable">tickNumber</span> &gt;= <span class="number integer">1000000</span> ) {
         <span class="keyword">var</span> <span class="variable">decPlaces</span> = <span class="number integer">5</span>;
         <span class="keyword">var</span> <span class="variable">base</span> = <span class="class">Math</span>.<span class="variable">pow</span>(<span class="number integer">10</span>, <span class="variable">decPlaces</span>)
         <span class="variable">tickText</span> = <span class="class">Math</span>.<span class="variable">round</span>(<span class="variable">tickText</span> <span class="regexp">/ 1000000 * base) /</span> <span class="variable">base</span> + <span class="string">'m'</span>; <span class="comment">// round to decPlaces</span>
      } <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">tickNumber</span> &gt;= <span class="number integer">1000</span> ) {
         <span class="keyword">var</span> <span class="variable">decPlaces</span> = <span class="number integer">2</span>;
         <span class="keyword">var</span> <span class="variable">base</span> = <span class="class">Math</span>.<span class="variable">pow</span>(<span class="number integer">10</span>, <span class="variable">decPlaces</span>)		    
         <span class="variable">tickText</span> = <span class="class">Math</span>.<span class="variable">round</span>(<span class="variable">tickText</span> <span class="regexp">/ 1000 * base) /</span> <span class="variable">base</span> + <span class="string">'k'</span>;
      }
		
      <span class="keyword">return</span> <span class="variable">tickText</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getTickTextDecimalPlaces</strong></p>

<p><em>determines the tick text with decimal places</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  tickNumber - the tick number that needs to be abbreviated</p></li><li><p><strong>return</strong>: <em>String</em>  abbreviated tickNumber</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getTickTextDecimalPlaces</span>: <span class="keyword">function</span>(<span class="variable">tickNumber</span>){
      <span class="keyword">if</span> ( !<span class="this">this</span>.<span class="variable">tick</span>.<span class="variable">auto</span> )
         <span class="keyword">return</span> <span class="variable">tickNumber</span>;
		
      <span class="keyword">var</span> <span class="variable">tickText</span> = <span class="variable">tickNumber</span>;
      <span class="keyword">if</span> (<span class="variable">tickNumber</span> &gt;= <span class="number integer">1000000</span> ) {
         <span class="keyword">var</span> <span class="variable">decPlaces</span> = <span class="number integer">5</span>;
         <span class="variable">tickText</span> = <span class="class">Math</span>.<span class="variable">round</span>( <span class="variable">tickText</span> <span class="regexp">/ (1000000 /</span> <span class="class">Math</span>.<span class="variable">pow</span>(<span class="number integer">10</span>,<span class="variable">decPlaces</span>)) ) + <span class="string">'m'</span>; <span class="comment">// round to 2 decimal places</span>
      } <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">tickNumber</span> &gt;= <span class="number integer">1000</span> ){
         <span class="keyword">var</span> <span class="variable">decPlaces</span> = <span class="number integer">2</span>;
         <span class="variable">tickText</span> = <span class="class">Math</span>.<span class="variable">round</span>( <span class="variable">tickText</span> <span class="regexp">/ (1000 /</span> <span class="class">Math</span>.<span class="variable">pow</span>(<span class="number integer">10</span>,<span class="variable">decPlaces</span>)) ) + <span class="string">'k'</span>;
      }

      <span class="keyword">return</span> <span class="variable">tickText</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>handleMouseEvent</strong></p>

<p><em>handles mouse events</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  event - triggered event</p></li><li><p><strong>param</strong>: <em>String</em>  type - type of event</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">handleMouseEvent</span>: <span class="keyword">function</span>(<span class="variable">e</span>, <span class="variable">type</span>) {
      <span class="this">this</span>.<span class="variable">myMouseEventHandler</span>.<span class="variable">setMousePosition</span>(<span class="variable">e</span>);
      <span class="keyword">var</span> <span class="variable">positionY</span> = <span class="this">this</span>.<span class="variable">myMouseEventHandler</span>.<span class="variable">mouseY</span>;
      <span class="keyword">var</span> <span class="variable">lane</span>;
      
      <span class="keyword">for</span>( <span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="this">this</span>.<span class="variable">tracks</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
         <span class="keyword">for</span>( <span class="keyword">var</span> <span class="variable">k</span>=<span class="number integer">0</span>; <span class="variable">k</span> &lt; <span class="this">this</span>.<span class="variable">tracks</span>[<span class="variable">i</span>].<span class="variable">lanes</span>.<span class="variable">length</span>; <span class="variable">k</span>++) {
            <span class="keyword">var</span> <span class="variable">yt</span> = <span class="this">this</span>.<span class="variable">tracks</span>[<span class="variable">i</span>].<span class="variable">lanes</span>[<span class="variable">k</span>].<span class="variable">getPixelPositionY</span>();
            <span class="keyword">var</span> <span class="variable">yb</span> = <span class="variable">yt</span> + <span class="this">this</span>.<span class="variable">tracks</span>[<span class="variable">i</span>].<span class="variable">lanes</span>[<span class="variable">k</span>].<span class="variable">getHeight</span>();
            <span class="keyword">if</span> (<span class="variable">positionY</span> &gt;= <span class="variable">yt</span> &amp;&amp; <span class="variable">positionY</span> &lt;= <span class="variable">yb</span> ) {
               <span class="variable">lane</span> = <span class="this">this</span>.<span class="variable">tracks</span>[<span class="variable">i</span>].<span class="variable">lanes</span>[<span class="variable">k</span>];
               <span class="keyword">break</span>;
            }
         }
      }
      
      <span class="comment">// if mouse is not on any tracks then return</span>
      <span class="keyword">if</span> (!<span class="variable">lane</span>) <span class="keyword">return</span>;
      
      <span class="keyword">var</span> <span class="variable">drawStyle</span> = <span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">getDrawStyle</span>();
      
      <span class="keyword">if</span> (<span class="variable">drawStyle</span> == <span class="string">'collapse'</span>) {
         <span class="this">this</span>.<span class="variable">redraw</span>();
      } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">drawStyle</span> == <span class="string">'line'</span>) {
        <span class="comment">// do nothing </span>
      } <span class="keyword">else</span> {
         <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">save</span>(); 
         <span class="variable">lane</span>.<span class="variable">erase</span>();
         <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">translate</span>(<span class="number integer">0</span>, <span class="variable">lane</span>.<span class="variable">getPixelPositionY</span>());
         <span class="variable">lane</span>.<span class="variable">draw</span>();
         <span class="keyword">var</span> <span class="variable">ltt</span>;
         <span class="keyword">while</span> (<span class="variable">ltt</span> =  <span class="this">this</span>.<span class="variable">lastToolTips</span>.<span class="variable">pop</span>() ) {
            <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">putImageData</span>(<span class="variable">ltt</span>.<span class="variable">pixels</span>, <span class="variable">ltt</span>.<span class="variable">x</span>, <span class="variable">ltt</span>.<span class="variable">y</span> )
         }
         <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">restore</span>();
      }
      
      
      <span class="keyword">var</span> <span class="variable">chart</span> = <span class="this">this</span>;
		
      <span class="keyword">if</span> (<span class="variable">type</span> == <span class="string">'click'</span>) {
         <span class="keyword">var</span> <span class="variable">clicksFns</span> = <span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">clicks</span>;
         <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">clicksFns</span>.<span class="variable">length</span>; <span class="variable">i</span>++)
            <span class="variable">clicksFns</span>[<span class="variable">i</span>](<span class="variable">chart</span>);
      } <span class="keyword">else</span> {
         <span class="keyword">var</span> <span class="variable">mouseoverFns</span> = <span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">mouseovers</span>;
         <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">mouseoverFns</span>.<span class="variable">length</span>; <span class="variable">i</span>++) 
            <span class="variable">mouseoverFns</span>[<span class="variable">i</span>](<span class="variable">chart</span>);								    
      }
		
      <span class="this">this</span>.<span class="variable">myMouseEventHandler</span>.<span class="variable">reset</span>(<span class="variable">chart</span>);
      

	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addClickEventListener</strong></p>

<p><em>add&#39;s function that will execute each time a feature is clicked</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  func - function to be triggered</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addClickEventListener</span>: <span class="keyword">function</span>(<span class="variable">func</span>) {
      <span class="this">this</span>.<span class="variable">events</span>.<span class="variable">clicks</span>.<span class="variable">push</span>(<span class="variable">func</span>);
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addMouseoverEventListener</strong></p>

<p><em>add&#39;s function that will execute each time a feature is mouseovered</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  func - function to be triggered</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addMouseoverEventListener</span>: <span class="keyword">function</span>(<span class="variable">func</span>) {
		<span class="this">this</span>.<span class="variable">events</span>.<span class="variable">mouseovers</span>.<span class="variable">push</span>(<span class="variable">func</span>);
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>removeEventListeners</strong></p>

<p><em>remove event listerners</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  event-type - e.g. mouseover, click, etc...</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">removeEventListeners</span>: <span class="keyword">function</span>(<span class="variable">eventType</span>){
      <span class="keyword">if</span> (<span class="variable">eventType</span> == <span class="string">'mouseover'</span>)
         <span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">removeEventListener</span>(<span class="string">'mousemove'</span>, <span class="this">this</span>.<span class="variable">mouseHandler</span>);
      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">eventType</span> == <span class="string">'click'</span>)
         <span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">removeEventListener</span>(<span class="string">'click'</span>, <span class="this">this</span>.<span class="variable">clickHandler</span>);
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>registerEventListeners</strong></p>

<p><em>adds event listerners</em></p>

<ul><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">registerEventListeners</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">chart</span> = <span class="this">this</span>;

      <span class="keyword">if</span> ( <span class="this">this</span>.<span class="variable">events</span>.<span class="variable">mouseovers</span>.<span class="variable">length</span> &gt; <span class="number integer">0</span>) {
         <span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">removeEventListener</span>(<span class="string">'mousemove'</span>, <span class="variable">chart</span>.<span class="variable">mouseHandler</span>);
         <span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">addEventListener</span>(<span class="string">'mousemove'</span>, <span class="variable">chart</span>.<span class="variable">mouseHandler</span>, <span class="variable">false</span>);
      }
      <span class="keyword">if</span> ( <span class="this">this</span>.<span class="variable">events</span>.<span class="variable">clicks</span>.<span class="variable">length</span> &gt; <span class="number integer">0</span> ) {
         <span class="comment">//$(this.canvas).bind('click', function(e) {chart.handleMouseEvent(e, 'click')})</span>
         <span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">removeEventListener</span>(<span class="string">'click'</span>, <span class="variable">chart</span>.<span class="variable">clickHandler</span>);
         <span class="this">this</span>.<span class="variable">canvas</span>.<span class="variable">addEventListener</span>(<span class="string">'click'</span>, <span class="variable">chart</span>.<span class="variable">clickHandler</span>, <span class="variable">false</span>);
      }
      <span class="this">this</span>.<span class="variable">events</span>.<span class="variable">added</span> = <span class="variable">true</span>;
   }
	
	
});
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="Scribl.track.js"><a href="#">Scribl.track</a></h2></td><td>Scribl.track.js</td></tr><tr class="code">
<td class="docs">
<h2>Scribl:Track</h2>

<p><em>Tracks are used to segregrate different sequence data</em></p>

<p>Chase Miller 2011
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Track</span> = <span class="class">Class</span>.<span class="variable">extend</span>({</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>init</strong></p>

<p><em>Constructor</em></p>

<p>This is called with <code>new Track()</code>, but to create new Tracks associated with a chart use <code>Scribl.addTrack()</code></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  ctx - the canvas.context object</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">init</span>: <span class="keyword">function</span>(<span class="variable">chart</span>) {
      <span class="comment">// defaults</span>
      <span class="keyword">var</span> <span class="variable">track</span> = <span class="this">this</span>;
      <span class="this">this</span>.<span class="variable">chart</span> = <span class="variable">chart</span>
      <span class="this">this</span>.<span class="variable">lanes</span> = [];
      <span class="this">this</span>.<span class="variable">ctx</span> = <span class="variable">chart</span>.<span class="variable">ctx</span>;
      <span class="this">this</span>.<span class="variable">uid</span> = <span class="variable">_uniqueId</span>(<span class="string">'track'</span>);      
      <span class="this">this</span>.<span class="variable">drawStyle</span> = <span class="variable">undefined</span>;
      <span class="this">this</span>.<span class="variable">hide</span> = <span class="variable">false</span>;
      <span class="this">this</span>.<span class="variable">hooks</span> = {};
      
      <span class="comment">// add draw hooks</span>
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span>&lt;<span class="variable">chart</span>.<span class="variable">trackHooks</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
         <span class="this">this</span>.<span class="variable">addDrawHook</span>( <span class="variable">chart</span>.<span class="variable">trackHooks</span>[<span class="variable">i</span>] );
      }
      
      
      <span class="comment">// coverage variables</span>
      <span class="this">this</span>.<span class="variable">coverageData</span> = [];  <span class="comment">// number of features at any given pixel;</span>
      <span class="this">this</span>.<span class="variable">maxDepth</span> = <span class="number integer">0</span>; <span class="comment">// highest depth for this track;</span>
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addLane</strong></p>

<p><em>creates a new Lane associated with this Track</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Object</em>  Lane - a Lane object</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addLane</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">lane</span> = <span class="keyword">new</span> <span class="class">Lane</span>(<span class="this">this</span>.<span class="variable">ctx</span>, <span class="this">this</span>);
      <span class="this">this</span>.<span class="variable">lanes</span>.<span class="variable">push</span>(<span class="variable">lane</span>);
      <span class="keyword">return</span> <span class="variable">lane</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addGene</strong></p>

<p><em>syntactic sugar function to add a feature with the gene type to this Track</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  position - start position of the gene</p></li><li><p><strong>param</strong>: <em>Int</em>  length - length of the gene</p></li><li><p><strong>param</strong>: <em>String</em>  strand - &#39;+&#39; or &#39;-&#39; strand</p></li><li><p><strong>param</strong>: <em>Hash</em>  [opts] - optional hash of options that can be applied to gene  </p></li><li><p><strong>return</strong>: <em>Object</em>  gene - a feature with the &#39;gene&#39; type</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addGene</span>: <span class="keyword">function</span>(<span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) {
      <span class="keyword">return</span> (<span class="this">this</span>.<span class="variable">addFeature</span>( <span class="keyword">new</span> <span class="class">BlockArrow</span>(&quot;<span class="variable">gene</span>&quot;, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) ) );
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addProtein</strong></p>

<p><em>syntactic sugar function to add a feature with the protein type to this Track</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  position - start position of the protein</p></li><li><p><strong>param</strong>: <em>Int</em>  length - length of the protein</p></li><li><p><strong>param</strong>: <em>String</em>  strand - &#39;+&#39; or &#39;-&#39; strand</p></li><li><p><strong>param</strong>: <em>Hash</em>  [opts] - optional hash of options that can be applied to protein  </p></li><li><p><strong>return</strong>: <em>Object</em>  protein - a feature with the &#39;protein&#39; type</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addProtein</span>: <span class="keyword">function</span>(<span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) {
      <span class="keyword">return</span> (<span class="this">this</span>.<span class="variable">addFeature</span>( <span class="keyword">new</span> <span class="class">BlockArrow</span>(&quot;<span class="variable">protein</span>&quot;, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) ) );
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addFeature</strong></p>

<p><em>addFeature to this Track and let Scribl manage lane placement to avoid overlaps</em></p>

<p>example:
<code>track.addFeature( new Rect(&#39;complex&#39;,3500, 2000) );</code></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  feature - any of the derived Glyph classes (e.g. Rect, Arrow, etc..)</p></li><li><p><strong>return</strong>: <em>Object</em>  feature - new feature</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addFeature</span>: <span class="keyword">function</span>( <span class="variable">feature</span> ) {
		
      <span class="keyword">var</span> <span class="variable">curr_lane</span>;
      <span class="keyword">var</span> <span class="variable">new_lane</span> = <span class="variable">true</span>;
      
      <span class="comment">// try to add feature at lower lanes then move up</span>
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">j</span>=<span class="number integer">0</span>; <span class="variable">j</span> &lt; <span class="this">this</span>.<span class="variable">lanes</span>.<span class="variable">length</span>; <span class="variable">j</span>++) {
         <span class="keyword">var</span> <span class="variable">prev_feature</span> = <span class="this">this</span>.<span class="variable">lanes</span>[<span class="variable">j</span>].<span class="variable">features</span>[ <span class="this">this</span>.<span class="variable">lanes</span>[<span class="variable">j</span>].<span class="variable">features</span>.<span class="variable">length</span> - <span class="number integer">1</span> ];

         <span class="comment">// check if new lane is needed</span>
         <span class="keyword">var</span> <span class="variable">spacer</span> = <span class="number integer">3</span>/<span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">pixelsToNts</span>() || <span class="number integer">3</span>;
         <span class="keyword">if</span> ( <span class="variable">prev_feature</span> != <span class="variable">undefined</span> &amp;&amp; (<span class="variable">feature</span>.<span class="variable">position</span> - <span class="variable">spacer</span>) &gt; (<span class="variable">prev_feature</span>.<span class="variable">position</span> + <span class="variable">prev_feature</span>.<span class="variable">length</span>) ) {
            <span class="variable">new_lane</span> = <span class="variable">false</span>;
            <span class="variable">curr_lane</span> = <span class="this">this</span>.<span class="variable">lanes</span>[<span class="variable">j</span>];
            <span class="keyword">break</span>;
         }
      }

      <span class="comment">// add new lane if needed</span>
      <span class="keyword">if</span> (<span class="variable">new_lane</span>)
         <span class="variable">curr_lane</span> = <span class="this">this</span>.<span class="variable">addLane</span>();
			
      <span class="comment">// add feature</span>
      <span class="variable">curr_lane</span>.<span class="variable">addFeature</span>( <span class="variable">feature</span> );	
      <span class="keyword">return</span> <span class="variable">feature</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>hide</strong></p>

<p><em>hides the track so it doesn&#39;t get drawn</em></p>

<ul><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">hide</span>: <span class="keyword">function</span>() {
	   <span class="this">this</span>.<span class="variable">hide</span> = <span class="variable">true</span>;
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>unhide</strong></p>

<p><em>unhides the track so it is drawn</em></p>

<ul><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">unhide</span>: <span class="keyword">function</span>() {
	   <span class="this">this</span>.<span class="variable">hide</span> = <span class="variable">false</span>;
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getDrawStyle</strong></p>

<p><em>returns the draw style associated with this track</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em>  drawStyle - the style this track will be drawn e.g. expand, collapse, line     </p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getDrawStyle</span>: <span class="keyword">function</span>() {
      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">drawStyle</span>)
         <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">drawStyle</span>
      <span class="keyword">else</span>
         <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">drawStyle</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getHeight</strong></p>

<p><em>returns the height of this track in pixels</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Int</em>  height</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getHeight</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">wholeHeight</span> = <span class="number integer">0</span>;
		
      <span class="keyword">var</span> <span class="variable">numLanes</span> = <span class="this">this</span>.<span class="variable">lanes</span>.<span class="variable">length</span>;
      <span class="keyword">var</span> <span class="variable">laneBuffer</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">laneBuffer</span>;
      <span class="keyword">var</span> <span class="variable">drawStyle</span> = <span class="this">this</span>.<span class="variable">getDrawStyle</span>();
      <span class="keyword">if</span> (<span class="variable">drawStyle</span> == <span class="string">'line'</span> || <span class="variable">drawStyle</span> == <span class="string">'collapse'</span>)
         <span class="variable">numLanes</span> = <span class="number integer">1</span>;
		
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">numLanes</span>; <span class="variable">i</span>++) {
         <span class="variable">wholeHeight</span> += <span class="variable">laneBuffer</span>;
         <span class="variable">wholeHeight</span> += <span class="this">this</span>.<span class="variable">lanes</span>[<span class="variable">i</span>].<span class="variable">getHeight</span>();
      }
      <span class="comment">// subtract 1 laneBuffer b\c laneBuffers are between lanes</span>
      <span class="variable">wholeHeight</span> -= <span class="variable">laneBuffer</span>;
		
      <span class="keyword">return</span> <span class="variable">wholeHeight</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getPixelPositionY</strong></p>

<p><em>gets the number of pixels from the top of the chart to the top of this track</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Int</em>  pixelPositionY</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getPixelPositionY</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">track</span> = <span class="this">this</span>;
      <span class="keyword">var</span> <span class="variable">y</span>;
      
      <span class="keyword">if</span> (!<span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">scale</span>.<span class="variable">off</span>)
         <span class="variable">y</span> = <span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">getScaleHeight</span>() + <span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">laneBuffer</span>;
      <span class="keyword">else</span>
         <span class="variable">y</span> = <span class="number integer">0</span>;

      <span class="keyword">for</span>( <span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">tracks</span>.<span class="variable">length</span>; <span class="variable">i</span>++ ) {
         <span class="keyword">if</span> (<span class="variable">track</span>.<span class="variable">uid</span> == <span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">tracks</span>[<span class="variable">i</span>].<span class="variable">uid</span>) <span class="keyword">break</span>;
         <span class="variable">y</span> += <span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">trackBuffer</span>;
         <span class="variable">y</span> += <span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">tracks</span>[<span class="variable">i</span>].<span class="variable">getHeight</span>();
      }
   
      <span class="keyword">return</span> <span class="variable">y</span>; 
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>calcCoverageData</strong></p>

<p><em>calculates the coverage (the number of features) at each pixel</em></p>

<ul><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">calcCoverageData</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">lanes</span> = <span class="this">this</span>.<span class="variable">lanes</span> 
      <span class="keyword">var</span> <span class="variable">min</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">scale</span>.<span class="variable">min</span>;
      <span class="keyword">var</span> <span class="variable">max</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">scale</span>.<span class="variable">max</span>;
	   
	   <span class="comment">// determine feature locations</span>
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span>&lt;<span class="variable">lanes</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
         <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">k</span>=<span class="number integer">0</span>; <span class="variable">k</span>&lt;<span class="variable">lanes</span>[<span class="variable">i</span>].<span class="variable">features</span>.<span class="variable">length</span>; <span class="variable">k</span>++) {
            <span class="keyword">var</span> <span class="variable">feature</span> = <span class="variable">lanes</span>[<span class="variable">i</span>].<span class="variable">features</span>[<span class="variable">k</span>];
            <span class="keyword">var</span> <span class="variable">pos</span> = <span class="variable">feature</span>.<span class="variable">position</span>;
            <span class="keyword">var</span> <span class="variable">end</span> = <span class="variable">feature</span>.<span class="variable">getEnd</span>();
            <span class="keyword">if</span> ( (<span class="variable">pos</span> &gt;= <span class="variable">min</span> &amp;&amp; <span class="variable">pos</span> &lt;= <span class="variable">max</span>) || (<span class="variable">end</span> &gt;= <span class="variable">min</span> &amp;&amp; <span class="variable">end</span> &lt;= <span class="variable">max</span>) ) {
               <span class="keyword">var</span> <span class="variable">from</span> = <span class="class">Math</span>.<span class="variable">round</span>( <span class="variable">feature</span>.<span class="variable">getPixelPositionX</span>() );
               <span class="keyword">var</span> <span class="variable">to</span> =  <span class="class">Math</span>.<span class="variable">round</span>( <span class="variable">from</span> + <span class="variable">feature</span>.<span class="variable">getPixelLength</span>() );
               <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">j</span>=<span class="variable">from</span>; <span class="variable">j</span> &lt;= <span class="variable">to</span>; <span class="variable">j</span>++) { 
                  <span class="this">this</span>.<span class="variable">coverageData</span>[<span class="variable">j</span>] = <span class="this">this</span>.<span class="variable">coverageData</span>[<span class="variable">j</span>] + <span class="number integer">1</span> || <span class="number integer">1</span>; 
                  <span class="this">this</span>.<span class="variable">maxDepth</span> = <span class="class">Math</span>.<span class="variable">max</span>(<span class="this">this</span>.<span class="variable">coverageData</span>[<span class="variable">j</span>], <span class="this">this</span>.<span class="variable">maxDepth</span>);
               }
            }
         }
      }     
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>erase</strong></p>

<p><em>erases this track</em></p>

<ul><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">erase</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">track</span> = <span class="this">this</span>;
      <span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">ctx</span>.<span class="variable">clearRect</span>(<span class="number integer">0</span>, <span class="variable">track</span>.<span class="variable">getPixelPositionY</span>(), <span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">width</span>, <span class="variable">track</span>.<span class="variable">getHeight</span>());
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>draw</strong></p>

<p><em>draws Track</em></p>

<ul><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">draw</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">track</span> = <span class="this">this</span>;
      
      <span class="comment">// execute hooks</span>
      <span class="keyword">var</span> <span class="variable">dontDraw</span> = <span class="variable">false</span>;
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="variable">track</span>.<span class="variable">hooks</span>) {
         <span class="variable">dontDraw</span> = <span class="variable">track</span>.<span class="variable">hooks</span>[<span class="variable">i</span>](<span class="variable">track</span>) || <span class="variable">dontDraw</span>;
      }
      
      <span class="comment">// check if track is waiting and if so do nothing</span>
      <span class="keyword">if</span> ( <span class="variable">track</span>.<span class="variable">status</span> == <span class="string">'waiting'</span> ) {
         <span class="variable">track</span>.<span class="variable">drawOnResponse</span> = <span class="variable">true</span>;
         <span class="keyword">return</span>;
      }
      
      <span class="comment">// check if track shouldn't be drawn</span>
      <span class="keyword">if</span>(<span class="variable">track</span>.<span class="variable">hide</span>)
         <span class="keyword">return</span>;
                  
      <span class="keyword">var</span> <span class="variable">style</span> = <span class="variable">track</span>.<span class="variable">getDrawStyle</span>();
      <span class="keyword">var</span> <span class="variable">laneSize</span> = <span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">laneSizes</span>;
      <span class="keyword">var</span> <span class="variable">lanes</span> = <span class="variable">track</span>.<span class="variable">lanes</span>;
      <span class="keyword">var</span> <span class="variable">laneBuffer</span> = <span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">laneBuffer</span>;
      <span class="keyword">var</span> <span class="variable">trackBuffer</span> = <span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">trackBuffer</span>;
      <span class="keyword">var</span> <span class="variable">y</span> =  <span class="variable">laneSize</span> + <span class="variable">trackBuffer</span>;
      <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">ctx</span>;
      
      <span class="keyword">if</span> (!<span class="variable">dontDraw</span>) {
         
         <span class="comment">// draw lanes</span>
      
         <span class="comment">// draw expanded/default style</span>
         <span class="keyword">if</span> ( <span class="variable">style</span> == <span class="variable">undefined</span> || <span class="variable">style</span> == <span class="string">'expand'</span> ) {   		
            <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span>&lt;<span class="variable">lanes</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
               <span class="variable">lanes</span>[<span class="variable">i</span>].<span class="variable">y</span> = <span class="variable">y</span>;
               <span class="keyword">if</span>(<span class="variable">lanes</span>[<span class="variable">i</span>].<span class="variable">draw</span>()) {
                  <span class="keyword">var</span> <span class="variable">height</span> = <span class="variable">lanes</span>[<span class="variable">i</span>].<span class="variable">getHeight</span>();
                  <span class="variable">ctx</span>.<span class="variable">translate</span>(<span class="number integer">0</span>, <span class="variable">height</span> + <span class="variable">laneBuffer</span>);
                  <span class="variable">y</span> = <span class="variable">y</span> + <span class="variable">height</span> + <span class="variable">laneBuffer</span>;
               }
            }
         } <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">style</span> == <span class="string">'collapse'</span> ) { <span class="comment">// draw collapse style (i.e. single lane)</span>
            <span class="keyword">var</span> <span class="variable">features</span> = []
            <span class="comment">// concat all features into single array</span>
            <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span>&lt;<span class="variable">lanes</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
               <span class="variable">features</span> = <span class="variable">features</span>.<span class="variable">concat</span>(<span class="variable">lanes</span>[<span class="variable">i</span>].<span class="variable">features</span>);
            }
            <span class="comment">// sort features so the minimal number of lanes are used</span>
            <span class="variable">features</span>.<span class="variable">sort</span>( <span class="keyword">function</span>(<span class="variable">a</span>,<span class="variable">b</span>){ <span class="keyword">return</span>(<span class="variable">a</span>.<span class="variable">position</span> - <span class="variable">b</span>.<span class="variable">position</span>); } );
            <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">j</span>=<span class="number integer">0</span>; <span class="variable">j</span>&lt;<span class="variable">features</span>.<span class="variable">length</span>; <span class="variable">j</span>++) {
               <span class="keyword">var</span> <span class="variable">originalLength</span> = <span class="variable">features</span>[<span class="variable">j</span>].<span class="variable">length</span>;
               <span class="keyword">var</span> <span class="variable">originalName</span> = <span class="variable">features</span>[<span class="variable">j</span>].<span class="variable">name</span>;
               <span class="keyword">var</span> <span class="variable">m</span> = <span class="variable">undefined</span>;
               <span class="comment">// for( m=j+1; m &lt; features.length; m++) {</span>
               <span class="comment">//    // if a feature is overlapping change length to draw as a single feature</span>
               <span class="comment">//    if (features[j].getEnd() &gt;= features[m].position) {</span>
               <span class="comment">//       features[j].length = Math.max(features[j].getEnd(), features[m].getEnd()) - features[j].position;</span>
               <span class="comment">//       features[j].name = &quot;&quot;;</span>
               <span class="comment">//    } else break;</span>
               <span class="comment">// }               </span>
               <span class="comment">// draw</span>
               <span class="variable">features</span>[<span class="variable">j</span>].<span class="variable">draw</span>();
               <span class="comment">// put length and name back to correct values</span>
               <span class="variable">features</span>[<span class="variable">j</span>].<span class="variable">length</span> = <span class="variable">originalLength</span>;
               <span class="variable">features</span>[<span class="variable">j</span>].<span class="variable">name</span> = <span class="variable">originalName</span>;
               <span class="comment">// update j to skip features that were merged</span>
             <span class="comment">//  j = m-1;</span>
            }
            <span class="comment">// translate down to next lane to draw</span>
            <span class="keyword">if</span> (<span class="variable">lanes</span>.<span class="variable">length</span> &gt; <span class="number integer">0</span>)
               <span class="variable">ctx</span>.<span class="variable">translate</span>(<span class="number integer">0</span>, <span class="variable">lanes</span>[<span class="number integer">0</span>].<span class="variable">getHeight</span>() + <span class="variable">laneBuffer</span>);
   
         <span class="comment">// draw as a line chart of the coverage</span>
         } <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">style</span> == <span class="string">'line'</span> ) {
            <span class="variable">track</span>.<span class="variable">coverageData</span> = [];
            <span class="keyword">if</span> (<span class="variable">track</span>.<span class="variable">coverageData</span>.<span class="variable">length</span> == <span class="number integer">0</span>) <span class="variable">track</span>.<span class="variable">calcCoverageData</span>();
   	   
            <span class="keyword">var</span> <span class="variable">normalizationFactor</span> = <span class="this">this</span>.<span class="variable">maxDepth</span>;

            <span class="variable">ctx</span>.<span class="variable">beginPath</span>();
   <span class="comment">//         ctx.moveTo(this.chart.offset, laneSize);</span>
            <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">k</span>=<span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">offset</span>; <span class="variable">k</span> &lt;= <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">width</span> + <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">offset</span>; <span class="variable">k</span>++) {
               <span class="keyword">var</span> <span class="variable">normalizedPt</span> = <span class="variable">track</span>.<span class="variable">coverageData</span>[<span class="variable">k</span>] / <span class="variable">normalizationFactor</span> * <span class="variable">laneSize</span> || <span class="number integer">0</span>;
               <span class="variable">normalizedPt</span> = <span class="variable">laneSize</span> - <span class="variable">normalizedPt</span>;
               <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">k</span>, <span class="variable">normalizedPt</span>);
            }
            <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">width</span> + <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">offset</span>, <span class="variable">laneSize</span>)
   <span class="comment">//		   ctx.lineTo(this.chart.offset, laneSize);</span>
            <span class="variable">ctx</span>.<span class="variable">stroke</span>();
            <span class="variable">ctx</span>.<span class="variable">translate</span>(<span class="number integer">0</span>, <span class="variable">lanes</span>[<span class="number integer">0</span>].<span class="variable">getHeight</span>() + <span class="variable">laneBuffer</span>);
         }
   	}
   	
      <span class="comment">// add track buffer - extra laneBuffer</span>
      <span class="variable">ctx</span>.<span class="variable">translate</span>(<span class="number integer">0</span>,<span class="variable">trackBuffer</span>-<span class="variable">laneBuffer</span>);
		
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addDrawHook</strong></p>

<p><em>add function that executes before the track is drawn</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  function - takes track as param, returns true to stop the normal draw, false to allow</p></li><li><p><strong>return</strong>: <em>Int</em>  id - returns the uniqe id for the hook which is used to remove it</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addDrawHook</span>: <span class="keyword">function</span>(<span class="variable">fn</span>, <span class="variable">hookId</span>) {
      <span class="keyword">var</span> <span class="variable">uid</span> = <span class="variable">hookId</span> || <span class="variable">_uniqueId</span>(<span class="string">'drawHook'</span>);
      <span class="this">this</span>.<span class="variable">hooks</span>[<span class="variable">uid</span>] = <span class="variable">fn</span>;
      <span class="keyword">return</span> <span class="variable">uid</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>removeDrawHook</strong></p>

<p><em>removes function that executes before the track is drawn</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  id - the id of drawHook function that will be removed</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">removeDrawHook</span>: <span class="keyword">function</span>(<span class="variable">uid</span>) {
       <span class="keyword">delete</span> <span class="this">this</span>.<span class="variable">hooks</span>[<span class="variable">uid</span>];
    }
});
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="Scribl.lane.js"><a href="#">Scribl.lane</a></h2></td><td>Scribl.lane.js</td></tr><tr class="code">
<td class="docs">
<p><strong>Scribl::Lane</strong></p>

<p><em>A lane is used to draw features on a single y position</em></p>

<p>Chase Miller 2011
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Lane</span> = <span class="class">Class</span>.<span class="variable">extend</span>({</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>init</strong></p>

<p><em>Constructor</em></p>

<p>This is called with <code>new Lane()</code>, but to create new Lanes associated with a chart use <code>track.addLane()</code></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  ctx - the canvas.context object</p></li><li><p><strong>param</strong>: <em>Object</em>  track - track that this lane belongs to</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">init</span>: <span class="keyword">function</span>(<span class="variable">ctx</span>, <span class="variable">track</span>) {
      <span class="comment">// defaults</span>
      <span class="this">this</span>.<span class="variable">height</span> = <span class="variable">undefined</span>;
      <span class="this">this</span>.<span class="variable">features</span> = [];
      <span class="this">this</span>.<span class="variable">ctx</span> = <span class="variable">ctx</span>;
      <span class="this">this</span>.<span class="variable">track</span> = <span class="variable">track</span>;
      <span class="this">this</span>.<span class="variable">chart</span> = <span class="variable">track</span>.<span class="variable">chart</span>;
      <span class="this">this</span>.<span class="variable">uid</span> = <span class="variable">_uniqueId</span>(<span class="string">'lane'</span>);
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addGene</strong></p>

<p><em>syntactic sugar function to add a feature with the gene type to this Lane</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  position - start position of the gene</p></li><li><p><strong>param</strong>: <em>Int</em>  length - length of the gene</p></li><li><p><strong>param</strong>: <em>String</em>  strand - &#39;+&#39; or &#39;-&#39; strand</p></li><li><p><strong>param</strong>: <em>Hash</em>  [opts] - optional hash of options that can be applied to gene  </p></li><li><p><strong>return</strong>: <em>Object</em>  gene - a feature with the &#39;gene&#39; type      </p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addGene</span>: <span class="keyword">function</span>(<span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) {
      <span class="keyword">return</span> (<span class="this">this</span>.<span class="variable">addFeature</span>( <span class="keyword">new</span> <span class="class">BlockArrow</span>(&quot;<span class="variable">gene</span>&quot;, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) ) );
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addProtein</strong></p>

<p><em>syntactic sugar function to add a feature with the protein type to this Lane</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  position - start position of the protein</p></li><li><p><strong>param</strong>: <em>Int</em>  length - length of the protein</p></li><li><p><strong>param</strong>: <em>String</em>  strand - &#39;+&#39; or &#39;-&#39; strand</p></li><li><p><strong>param</strong>: <em>Hash</em>  [opts] - optional hash of options that can be applied to protein  </p></li><li><p><strong>return</strong>: <em>Object</em>  protein - a feature with the &#39;protein&#39; type</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addProtein</span>: <span class="keyword">function</span>(<span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) {
      <span class="keyword">return</span> (<span class="this">this</span>.<span class="variable">addFeature</span>( <span class="keyword">new</span> <span class="class">BlockArrow</span>(&quot;<span class="variable">protein</span>&quot;, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) ) );
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addFeature</strong></p>

<p><em>addFeature to this Lane, allowing potential overlaps</em></p>

<p>example:
<code>lane.addFeature( new Rect(&#39;complex&#39;,3500, 2000) );</code></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  feature - any of the derived Glyph classes (e.g. Rect, Arrow, etc..)</p></li><li><p><strong>return</strong>: <em>Object</em>  feature - new feature</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addFeature</span>: <span class="keyword">function</span>( <span class="variable">feature</span> ) {
		
      <span class="comment">// create feature</span>
      <span class="variable">feature</span>.<span class="variable">lane</span> = <span class="this">this</span>;
      <span class="this">this</span>.<span class="variable">features</span>.<span class="variable">push</span>(<span class="variable">feature</span>);
      
      <span class="comment">// initialize hash containers for &quot;type&quot; level options</span>
      <span class="keyword">if</span> (! <span class="this">this</span>.<span class="variable">chart</span>[<span class="variable">feature</span>.<span class="variable">type</span>] ){
         <span class="this">this</span>.<span class="variable">chart</span>[<span class="variable">feature</span>.<span class="variable">type</span>] = {<span class="string">'text'</span>: {}}
      }
      
      <span class="comment">// determine chart absolute_min and absolute_max</span>
      <span class="keyword">if</span> ( <span class="variable">feature</span>.<span class="variable">length</span> + <span class="variable">feature</span>.<span class="variable">position</span> &gt; <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">scale</span>.<span class="variable">max</span> || !<span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">scale</span>.<span class="variable">max</span> )
         <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">scale</span>.<span class="variable">max</span> = <span class="variable">feature</span>.<span class="variable">length</span> + <span class="variable">feature</span>.<span class="variable">position</span>;
      <span class="keyword">if</span> ( <span class="variable">feature</span>.<span class="variable">position</span> &lt; <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">scale</span>.<span class="variable">min</span> || !<span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">scale</span>.<span class="variable">min</span> )
         <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">scale</span>.<span class="variable">min</span> = <span class="variable">feature</span>.<span class="variable">position</span>;				
      	
      <span class="keyword">return</span> <span class="variable">feature</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>loadFeatures</strong></p>

<p><em>adds the features to this Lane</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array</em>  features - array of features, which can be any of the derived Glyph classes (e.g. Rect, Arrow, etc..)</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">loadFeatures</span>: <span class="keyword">function</span>(<span class="variable">features</span>) {
      <span class="keyword">var</span> <span class="variable">featureNum</span> = <span class="variable">features</span>.<span class="variable">length</span>;
      <span class="keyword">for</span>(<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span>&lt;<span class="variable">featureNum</span>; <span class="variable">i</span>++)
         <span class="this">this</span>.<span class="variable">addFeature</span>(<span class="variable">features</span>[<span class="variable">i</span>]);
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getHeight</strong></p>

<p><em>returns the height of this lane in pixels</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Int</em>  height</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getHeight</span>: <span class="keyword">function</span>() {
      <span class="keyword">if</span> ( <span class="this">this</span>.<span class="variable">height</span> != <span class="variable">undefined</span> )
         <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">height</span>;
      <span class="keyword">else</span>
         <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">laneSizes</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getPixelPositionY</strong></p>

<p><em>gets the number of pixels from the top of the chart to the top of this lane</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Int</em>  pixelPositionY</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getPixelPositionY</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">lane</span> = <span class="this">this</span>;
      <span class="keyword">var</span> <span class="variable">y</span> = <span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">getPixelPositionY</span>();
      <span class="keyword">var</span> <span class="variable">laneHeight</span> = <span class="variable">lane</span>.<span class="variable">getHeight</span>();
      <span class="keyword">for</span>( <span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">lanes</span>.<span class="variable">length</span>; <span class="variable">i</span>++ ) {	      
         <span class="keyword">if</span> (<span class="variable">lane</span>.<span class="variable">uid</span> == <span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">lanes</span>[<span class="variable">i</span>].<span class="variable">uid</span>) <span class="keyword">break</span>;
         <span class="variable">y</span> += <span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">laneBuffer</span>;
         <span class="variable">y</span> += <span class="variable">laneHeight</span>;
      }
      
      <span class="keyword">return</span> <span class="variable">y</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>erase</strong></p>

<p><em>erases this lane</em></p>

<ul><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">erase</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">lane</span> = <span class="this">this</span>;
      <span class="variable">lane</span>.<span class="variable">chart</span>.<span class="variable">ctx</span>.<span class="variable">clearRect</span>(<span class="number integer">0</span>, <span class="variable">lane</span>.<span class="variable">getPixelPositionY</span>(), <span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">canvas</span>.<span class="variable">width</span>, <span class="variable">lane</span>.<span class="variable">getHeight</span>());
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>draw</strong></p>

<p><em>draws lane</em></p>

<ul><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">draw</span>: <span class="keyword">function</span>() {
	   <span class="keyword">var</span> <span class="variable">min</span> = <span class="this">this</span>.<span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">scale</span>.<span class="variable">min</span>;
      <span class="keyword">var</span> <span class="variable">max</span> = <span class="this">this</span>.<span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">scale</span>.<span class="variable">max</span>;
	   <span class="keyword">var</span> <span class="variable">hasGlyphs</span> = <span class="variable">false</span>;
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span>&lt; <span class="this">this</span>.<span class="variable">features</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
         <span class="keyword">var</span> <span class="variable">pos</span> = <span class="this">this</span>.<span class="variable">features</span>[<span class="variable">i</span>].<span class="variable">position</span>;
         <span class="keyword">var</span> <span class="variable">end</span> = <span class="this">this</span>.<span class="variable">features</span>[<span class="variable">i</span>].<span class="variable">getEnd</span>();
         <span class="keyword">if</span> ( <span class="variable">pos</span> &gt;= <span class="variable">min</span> &amp;&amp; <span class="variable">pos</span> &lt;= <span class="variable">max</span> || <span class="variable">end</span> &gt;= <span class="variable">min</span> &amp;&amp; <span class="variable">end</span> &lt;= <span class="variable">max</span>) {
            <span class="this">this</span>.<span class="variable">features</span>[<span class="variable">i</span>].<span class="variable">draw</span>();
            <span class="variable">hasGlyphs</span> = <span class="variable">true</span>;
         }
      }
      <span class="keyword">return</span> <span class="variable">hasGlyphs</span>;
   }
});
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="Scribl.glyph.js"><a href="#">Scribl.glyph</a></h2></td><td>Scribl.glyph.js</td></tr><tr class="code">
<td class="docs">
<p><strong>Scribl::Glyph</strong></p>

<p><em>Generic glyph class that should not be used directly. 
All feature classes (e.g. Rect, arrow, etc..) inherit
from this class</em></p>

<p>Chase Miller 2011</p>

<p> </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Glyph</span> = <span class="class">Class</span>.<span class="variable">extend</span>({</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>init</strong></p>

<p><em>Constructor, call this with <code>new Glyph()</code></em>
This method must be called in all feature subclasses like so <code>this._super(type, pos, length, strand, opts)</code> </p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  type - a tag to associate this glyph with</p></li><li><p><strong>param</strong>: <em>Int</em>  position - start position of the glyph</p></li><li><p><strong>param</strong>: <em>Int</em>  length - length of the glyph</p></li><li><p><strong>param</strong>: <em>String</em>  strand - &#39;+&#39; or &#39;-&#39; strand</p></li><li><p><strong>param</strong>: <em>Hash</em>  [opts] - optional hash of attributes that can be applied to glyph</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">init</span>: <span class="keyword">function</span>(<span class="variable">type</span>, <span class="variable">pos</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) {
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      
      <span class="comment">// set unique id</span>
      <span class="this">this</span>.<span class="variable">uid</span> = <span class="variable">_uniqueId</span>(<span class="string">'feature'</span>);
      
      <span class="comment">// set variables</span>
      <span class="variable">glyph</span>.<span class="variable">position</span> = <span class="variable">pos</span>;
      <span class="variable">glyph</span>.<span class="variable">length</span> = <span class="variable">length</span>;
      <span class="variable">glyph</span>.<span class="variable">strand</span> = <span class="variable">strand</span>;
      <span class="comment">// this is used for all attributes at the chart level (e.g. chart.gene.color = &quot;blue&quot; )</span>
      <span class="this">this</span>.<span class="variable">type</span> = <span class="variable">type</span>;
      <span class="variable">glyph</span>.<span class="variable">opts</span> = {};
      
      <span class="variable">glyph</span>.<span class="variable">name</span> = &quot;&quot;;
      <span class="variable">glyph</span>.<span class="variable">borderColor</span> = &quot;<span class="variable">none</span>&quot;;
      <span class="variable">glyph</span>.<span class="variable">borderWidth</span> = <span class="variable">undefined</span>;
      <span class="variable">glyph</span>.<span class="variable">ntLevel</span> = <span class="number integer">4</span>; <span class="comment">// in pixels - sets the level at which glyphs are rendered as actual nucleotides instead of icons</span>
      <span class="variable">glyph</span>.<span class="variable">tooltips</span> = [];
      <span class="variable">glyph</span>.<span class="variable">hooks</span> = {};
      
      <span class="comment">// add seq hook</span>
      <span class="variable">glyph</span>.<span class="variable">addDrawHook</span>(<span class="keyword">function</span>(<span class="variable">theGlyph</span>) {
        <span class="keyword">if</span> (<span class="variable">theGlyph</span>.<span class="variable">ntLevel</span> != <span class="variable">undefined</span> &amp;&amp; <span class="variable">theGlyph</span>.<span class="variable">seq</span> &amp;&amp; <span class="variable">theGlyph</span>.<span class="variable">lane</span>.<span class="variable">chart</span>.<span class="variable">ntsToPixels</span>() &lt; <span class="variable">theGlyph</span>.<span class="variable">ntLevel</span>){
           <span class="keyword">var</span> <span class="variable">s</span> = <span class="keyword">new</span> <span class="class">Seq</span>(<span class="variable">theGlyph</span>.<span class="variable">type</span>, <span class="variable">theGlyph</span>.<span class="variable">position</span>, <span class="variable">theGlyph</span>.<span class="variable">length</span>, <span class="variable">theGlyph</span>.<span class="variable">seq</span>, <span class="variable">theGlyph</span>.<span class="variable">opts</span>);
           <span class="variable">s</span>.<span class="variable">lane</span> = <span class="variable">theGlyph</span>.<span class="variable">lane</span>;
           <span class="variable">s</span>.<span class="variable">ctx</span> = <span class="variable">theGlyph</span>.<span class="variable">ctx</span>;
           <span class="variable">s</span>.<span class="variable">_draw</span>();
           <span class="comment">// return true to stop normal drawing of glyph</span>
           <span class="keyword">return</span> <span class="variable">true</span>;
        }
        <span class="comment">// return false to allow normal draing of glyph</span>
        <span class="keyword">return</span> <span class="variable">false</span>;
      }, &quot;<span class="variable">ntHook</span>&quot;);
      
      <span class="comment">// initialize font variables</span>
      <span class="variable">glyph</span>.<span class="variable">text</span> = {};
      <span class="comment">// unset defaults that can be used to override chart defaults for specific glyphs</span>
      <span class="variable">glyph</span>.<span class="variable">text</span>.<span class="variable">font</span> = <span class="variable">undefined</span>; <span class="comment">// default: 'arial'</span>
      <span class="variable">glyph</span>.<span class="variable">text</span>.<span class="variable">size</span> = <span class="variable">undefined</span>;  <span class="comment">// default: '15' in pixels </span>
      <span class="variable">glyph</span>.<span class="variable">text</span>.<span class="variable">color</span> = <span class="variable">undefined</span>; <span class="comment">// default: 'black'</span>
      <span class="variable">glyph</span>.<span class="variable">text</span>.<span class="variable">align</span> = <span class="variable">undefined</span>; <span class="comment">// default: 'middle'		</span>
      
      <span class="variable">glyph</span>.<span class="variable">onClick</span> = <span class="variable">undefined</span>;
      <span class="variable">glyph</span>.<span class="variable">onMouseover</span> = <span class="variable">undefined</span>;
      
      <span class="comment">// set option attributes if any</span>
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">attribute</span> <span class="keyword">in</span> <span class="variable">opts</span>) {
         <span class="variable">glyph</span>[<span class="variable">attribute</span>] = <span class="variable">opts</span>[<span class="variable">attribute</span>];
         <span class="variable">glyph</span>.<span class="variable">opts</span>[<span class="variable">attribute</span>] = <span class="variable">opts</span>[<span class="variable">attribute</span>];
      }
		
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>setColorGradient</strong></p>

<p><em>creates a gradient given a list of colors</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>List</em>  colors - takes as many colors as you like</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">setColorGradient</span>: <span class="keyword">function</span>() {
      <span class="keyword">if</span>(<span class="variable">arguments</span>.<span class="variable">length</span> == <span class="number integer">1</span>){
          <span class="this">this</span>.<span class="variable">color</span> = <span class="variable">arguments</span>[<span class="number integer">0</span>];
          <span class="keyword">return</span>;
      }
      <span class="keyword">var</span> <span class="variable">lineargradient</span> = <span class="this">this</span>.<span class="variable">lane</span>.<span class="variable">ctx</span>.<span class="variable">createLinearGradient</span>(<span class="this">this</span>.<span class="regexp">/2, 0, this.length/</span><span class="number integer">2</span>, <span class="this">this</span>.<span class="variable">getHeight</span>());
      <span class="keyword">var</span> <span class="variable">color</span>;
      <span class="keyword">for</span>(<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">color</span>=<span class="variable">arguments</span>[<span class="variable">i</span>], <span class="variable">i</span> &lt; <span class="variable">arguments</span>.<span class="variable">length</span>; <span class="variable">i</span>++){
          <span class="variable">lineargradient</span>.<span class="variable">addColorStop</span>(<span class="variable">i</span> / (<span class="variable">arguments</span>.<span class="variable">length</span>-<span class="number integer">1</span>), <span class="variable">color</span>);
      }
      <span class="this">this</span>.<span class="variable">color</span> = <span class="variable">lineargradient</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getPixelLength</strong></p>

<p><em>gets the length of the glyph/feature in pixels</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Int</em>  length - in pixels</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getPixelLength</span>: <span class="keyword">function</span>() { 
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      <span class="keyword">return</span> ( <span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">chart</span>.<span class="variable">pixelsToNts</span>(<span class="variable">glyph</span>.<span class="variable">length</span>) || <span class="number integer">1</span> ); 
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getPixelPositionx</strong></p>

<p><em>gets the number of pixels from the left of the chart to the left of this glyph/feature</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Float</em>  positionX - in pixels</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getPixelPositionX</span>: <span class="keyword">function</span>() { 
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      <span class="keyword">var</span> <span class="variable">offset</span> = <span class="variable">parseInt</span>(<span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">offset</span>) || <span class="number integer">0</span>; 
      <span class="keyword">if</span> (<span class="variable">glyph</span>.<span class="variable">parent</span>)
         <span class="keyword">var</span> <span class="variable">position</span> = <span class="variable">glyph</span>.<span class="variable">position</span> + <span class="variable">glyph</span>.<span class="variable">parent</span>.<span class="variable">position</span> - <span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">scale</span>.<span class="variable">min</span>;
      <span class="keyword">else</span> 
         <span class="keyword">var</span> <span class="variable">position</span> = <span class="variable">glyph</span>.<span class="variable">position</span> - <span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">scale</span>.<span class="variable">min</span>;
      <span class="keyword">return</span> ( <span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">pixelsToNts</span>( <span class="variable">position</span> ) + <span class="variable">offset</span>); 
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getPixelPositionY</strong></p>

<p><em>gets the number of pixels from the top of the chart to the top of this glyph/feature</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Float</em>  positionY - in pixels</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getPixelPositionY</span> : <span class="keyword">function</span>() { 
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      <span class="keyword">return</span> (<span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">getPixelPositionY</span>()); 
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getEnd</strong></p>

<p><em>gets the nucleotide/amino acid end point of this glyph/feature</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Int</em>  end - in nucleotides/amino acids</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getEnd</span>: <span class="keyword">function</span>() {
      <span class="keyword">return</span> (<span class="this">this</span>.<span class="variable">position</span> + <span class="this">this</span>.<span class="variable">length</span>);
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>clone</strong></p>

<p><em>shallow copy</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Object</em>  copy - shallow copy of this glyph/feature</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">clone</span>: <span class="keyword">function</span>(<span class="variable">glyphType</span>) {
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      <span class="keyword">var</span> <span class="variable">newFeature</span>;
      
      <span class="variable">glyphType</span> = <span class="variable">glyphType</span> || <span class="variable">glyph</span>.<span class="variable">glyphType</span>;
      
      <span class="keyword">if</span> (<span class="variable">glyphType</span> == &quot;<span class="class">Rect</span>&quot; || <span class="variable">glyphType</span> == &quot;<span class="class">Line</span>&quot;)
         <span class="variable">glyph</span>.<span class="variable">strand</span> = <span class="variable">undefined</span>

      <span class="keyword">if</span>(<span class="variable">glyph</span>.<span class="variable">strand</span>){
         <span class="keyword">var</span> <span class="variable">str</span> = <span class="string">'new '</span> + <span class="variable">glyphType</span> + <span class="string">'(&quot;'</span> + <span class="variable">glyph</span>.<span class="variable">type</span> + <span class="string">'&quot;,'</span> + <span class="variable">glyph</span>.<span class="variable">position</span> + <span class="string">','</span> + <span class="variable">glyph</span>.<span class="variable">length</span> + <span class="string">',&quot;'</span> + <span class="variable">glyph</span>.<span class="variable">strand</span> + <span class="string">'&quot;,'</span> + <span class="class">JSON</span>.<span class="variable">stringify</span>(<span class="variable">glyph</span>.<span class="variable">opts</span>) + <span class="string">')'</span>;
         <span class="variable">newFeature</span> = <span class="variable">eval</span>( <span class="variable">str</span> );
         <span class="keyword">var</span> <span class="variable">attrs</span> = <span class="class">Object</span>.<span class="variable">keys</span>(<span class="variable">glyph</span>);
         <span class="keyword">for</span> ( <span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">attrs</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
            <span class="variable">newFeature</span>[<span class="variable">attrs</span>[<span class="variable">i</span>]] = <span class="variable">glyph</span>[<span class="variable">attrs</span>[<span class="variable">i</span>]];
         }
      } <span class="keyword">else</span> {
         <span class="keyword">var</span> <span class="variable">str</span> =  <span class="string">'new '</span> + <span class="variable">glyphType</span> + <span class="string">'(&quot;'</span> + <span class="variable">glyph</span>.<span class="variable">type</span> + <span class="string">'&quot;,'</span> + <span class="variable">glyph</span>.<span class="variable">position</span> + <span class="string">','</span> + <span class="variable">glyph</span>.<span class="variable">length</span> + <span class="string">','</span> + <span class="class">JSON</span>.<span class="variable">stringify</span>(<span class="variable">glyph</span>.<span class="variable">opts</span>) + <span class="string">')'</span>;
         <span class="variable">newFeature</span> = <span class="variable">eval</span>(<span class="variable">str</span>);
         <span class="keyword">var</span> <span class="variable">attrs</span> = <span class="class">Object</span>.<span class="variable">keys</span>(<span class="variable">glyph</span>);
         <span class="keyword">for</span> ( <span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">attrs</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
            <span class="variable">newFeature</span>[<span class="variable">attrs</span>[<span class="variable">i</span>]] = <span class="variable">glyph</span>[<span class="variable">attrs</span>[<span class="variable">i</span>]];
         }
      } 
      
      <span class="variable">newFeature</span>.<span class="variable">tooltips</span> = <span class="variable">glyph</span>.<span class="variable">tooltips</span>;
      <span class="variable">newFeature</span>.<span class="variable">hooks</span> = <span class="variable">glyph</span>.<span class="variable">hooks</span>;
      <span class="keyword">return</span>( <span class="variable">newFeature</span> );
	          
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getAttr</strong></p>

<p><em>determine and retrieve the appropriate value for each attribute, checks parent, default, type, and glyph levels in the appropriate order</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>*</em>  attribute</p></li><li><p><strong>return</strong>: <em>*</em>  attribute</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getAttr</span> : <span class="keyword">function</span>(<span class="variable">attr</span>) {
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      <span class="keyword">var</span> <span class="variable">attrs</span> = <span class="variable">attr</span>.<span class="variable">split</span>(<span class="string">'-'</span>);
      
      <span class="comment">// glyph level</span>
      <span class="keyword">var</span> <span class="variable">glyphLevel</span> = <span class="variable">glyph</span>;
      <span class="keyword">for</span>( <span class="keyword">var</span> <span class="variable">k</span>=<span class="number integer">0</span>; <span class="variable">k</span> &lt; <span class="variable">attrs</span>.<span class="variable">length</span>; <span class="variable">k</span>++) { <span class="variable">glyphLevel</span> = <span class="variable">glyphLevel</span>[<span class="variable">attrs</span>[<span class="variable">k</span>]]; }
      <span class="keyword">if</span> (<span class="variable">glyphLevel</span>) <span class="keyword">return</span> <span class="variable">glyphLevel</span>
      
      <span class="comment">// parent level</span>
      <span class="keyword">if</span> (<span class="variable">glyph</span>.<span class="variable">parent</span>) {
         <span class="keyword">var</span> <span class="variable">parentLevel</span> = <span class="variable">glyph</span>.<span class="variable">parent</span>;
         <span class="keyword">for</span>( <span class="keyword">var</span> <span class="variable">k</span>=<span class="number integer">0</span>; <span class="variable">k</span> &lt; <span class="variable">attrs</span>.<span class="variable">length</span>; <span class="variable">k</span>++) { <span class="variable">parentLevel</span> = <span class="variable">parentLevel</span>[<span class="variable">attrs</span>[<span class="variable">k</span>]]; }
         <span class="keyword">if</span> (<span class="variable">parentLevel</span>) <span class="keyword">return</span> <span class="variable">parentLevel</span>;
      }
      
      <span class="comment">// type level</span>
      <span class="keyword">var</span> <span class="variable">typeLevel</span> = <span class="this">this</span>.<span class="variable">lane</span>.<span class="variable">chart</span>[<span class="variable">glyph</span>.<span class="variable">type</span>];
      <span class="keyword">if</span> (<span class="variable">typeLevel</span>) {
         <span class="keyword">for</span>( <span class="keyword">var</span> <span class="variable">k</span>=<span class="number integer">0</span>; <span class="variable">k</span> &lt; <span class="variable">attrs</span>.<span class="variable">length</span>; <span class="variable">k</span>++) { <span class="variable">typeLevel</span> = <span class="variable">typeLevel</span>[<span class="variable">attrs</span>[<span class="variable">k</span>]]; }
         <span class="keyword">if</span> (<span class="variable">typeLevel</span>) <span class="keyword">return</span> <span class="variable">typeLevel</span>;
      }
      
      <span class="comment">// chart level</span>
      <span class="keyword">var</span> <span class="variable">chartLevel</span> = <span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">chart</span>.<span class="variable">glyph</span>;
      <span class="keyword">for</span>( <span class="keyword">var</span> <span class="variable">k</span>=<span class="number integer">0</span>; <span class="variable">k</span> &lt; <span class="variable">attrs</span>.<span class="variable">length</span>; <span class="variable">k</span>++) { <span class="variable">chartLevel</span> = <span class="variable">chartLevel</span>[<span class="variable">attrs</span>[<span class="variable">k</span>]]; }
      <span class="keyword">if</span> (<span class="variable">chartLevel</span>) <span class="keyword">return</span> <span class="variable">chartLevel</span>;
      
      <span class="comment">// nothing</span>
      <span class="keyword">return</span> <span class="variable">undefined</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>drawText</strong></p>

<p><em>draws the text for a glyph/feature
    </em>  <br/>## </p>

<ul><li><p><strong>param</strong>: <em>String</em>  text</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">drawText</span> : <span class="keyword">function</span>(<span class="variable">text</span>) {
      <span class="comment">// initialize</span>
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">chart</span>.<span class="variable">ctx</span>;
      <span class="keyword">var</span> <span class="variable">padding</span> = <span class="number integer">5</span>;
      <span class="keyword">var</span> <span class="variable">length</span> = <span class="variable">glyph</span>.<span class="variable">getPixelLength</span>();
      <span class="keyword">var</span> <span class="variable">height</span> = <span class="variable">glyph</span>.<span class="variable">getHeight</span>();
      <span class="keyword">var</span> <span class="variable">fontSize</span> = <span class="variable">glyph</span>.<span class="variable">getAttr</span>(<span class="string">'text-size'</span>);
      <span class="keyword">var</span> <span class="variable">fontSizeMin</span> = <span class="number integer">8</span>;
      <span class="keyword">var</span> <span class="variable">fontStyle</span> = <span class="variable">glyph</span>.<span class="variable">getAttr</span>(<span class="string">'text-style'</span>);
      <span class="comment">// set ctx</span>
      <span class="variable">ctx</span>.<span class="variable">font</span> = <span class="variable">fontSize</span> + &quot;<span class="variable">px</span> &quot; + <span class="variable">fontStyle</span>;
      <span class="variable">ctx</span>.<span class="variable">textBaseline</span> = &quot;<span class="variable">middle</span>&quot;;
      <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">glyph</span>.<span class="variable">getAttr</span>(<span class="string">'text-color'</span>);
      
      
      <span class="comment">// align text properly</span>
      <span class="keyword">var</span> <span class="variable">placement</span> = <span class="variable">undefined</span>
      
      <span class="comment">// handle relative text alignment based on glyph orientation</span>
      <span class="keyword">var</span> <span class="variable">align</span> = <span class="variable">glyph</span>.<span class="variable">getAttr</span>(<span class="string">'text-align'</span>);
      <span class="keyword">if</span> ( <span class="variable">align</span> == &quot;<span class="variable">start</span>&quot;)
         <span class="keyword">if</span> ( <span class="variable">glyph</span>.<span class="variable">strand</span> == <span class="string">'+'</span> )
            <span class="variable">align</span> = <span class="string">'left'</span>;
         <span class="keyword">else</span>
            <span class="variable">align</span> = <span class="string">'right'</span>;
      <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">align</span> == &quot;<span class="variable">end</span>&quot; ) 
         <span class="keyword">if</span> ( <span class="variable">glyph</span>.<span class="variable">strand</span> == <span class="string">'+'</span> )
            <span class="variable">align</span> = <span class="string">'right'</span>;
         <span class="keyword">else</span>
            <span class="variable">align</span> = <span class="string">'left'</span>;

      <span class="comment">// handle absolute text alignment	</span>
      <span class="variable">ctx</span>.<span class="variable">textAlign</span> = <span class="variable">align</span>;
      <span class="keyword">if</span> (<span class="variable">align</span> == <span class="string">'left'</span>)
         <span class="variable">placement</span> = <span class="number integer">0</span> + <span class="variable">padding</span>;
      <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">align</span> == <span class="string">'center'</span> )
         <span class="variable">placement</span> = <span class="variable">length</span>/<span class="number integer">2</span>;
      <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">align</span> == &quot;<span class="variable">right</span>&quot; )
			<span class="variable">placement</span> = <span class="variable">length</span> - <span class="variable">padding</span>;

      <span class="comment">// test if text size is too big and if so make it smaller</span>
      <span class="keyword">var</span> <span class="variable">dim</span> = <span class="variable">ctx</span>.<span class="variable">measureText</span>(<span class="variable">text</span>);
      <span class="keyword">if</span> (<span class="variable">text</span> &amp;&amp; <span class="variable">text</span> != &quot;&quot;) {
         <span class="keyword">while</span> ( (<span class="variable">length</span>-<span class="variable">dim</span>.<span class="variable">width</span>) &lt; <span class="number integer">4</span> ) {
            <span class="variable">fontSize</span> = <span class="regexp">/^\d+/</span>.<span class="variable">exec</span>(<span class="variable">ctx</span>.<span class="variable">font</span>);
            <span class="variable">fontSize</span>--;
            <span class="variable">dim</span> = <span class="variable">ctx</span>.<span class="variable">measureText</span>(<span class="variable">text</span>);
            <span class="variable">ctx</span>.<span class="variable">font</span> = <span class="variable">fontSize</span> +  &quot;<span class="variable">px</span> &quot; + <span class="variable">fontStyle</span>;
			
            <span class="comment">// Check if font is getting too small</span>
            <span class="keyword">if</span> (<span class="variable">fontSize</span> &lt;= <span class="variable">fontSizeMin</span>) {
               <span class="variable">text</span> = &quot;&quot;;  <span class="comment">// set name to blank if glyph is too small to display text</span>
               <span class="keyword">break</span>;
            }
         }
			
         <span class="comment">// handle special case</span>
         <span class="keyword">if</span> (<span class="variable">glyph</span>.<span class="variable">glyphType</span> == &quot;<span class="class">Complex</span>&quot;) {
            <span class="keyword">var</span> <span class="variable">offset</span> = <span class="number integer">0</span>;
            <span class="keyword">var</span> <span class="variable">fontsize</span> = <span class="regexp">/^\d+/</span>.<span class="variable">exec</span>(<span class="variable">ctx</span>.<span class="variable">font</span>);
            <span class="keyword">if</span> (<span class="variable">align</span> == &quot;<span class="variable">center</span>&quot;)
               <span class="variable">offset</span> = -(<span class="variable">ctx</span>.<span class="variable">measureText</span>(<span class="variable">text</span>).<span class="regexp">/2 + padding/</span><span class="number integer">2</span>); 
            <span class="variable">ctx</span>.<span class="variable">clearRect</span>(<span class="variable">placement</span> + <span class="variable">offset</span>, <span class="regexp">/2 - fontsize/</span><span class="number integer">2</span>, <span class="variable">ctx</span>.<span class="variable">measureText</span>(<span class="variable">text</span>).<span class="variable">width</span> + <span class="variable">padding</span>, <span class="variable">fontsize</span>);
         }
         <span class="variable">ctx</span>.<span class="variable">fillText</span>(<span class="variable">text</span>, <span class="variable">placement</span>, <span class="variable">height</span>/<span class="number integer">2</span>);
      }
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>calcRoundness</strong></p>

<p><em>determines a roundness value based on the height of the glyph feature, so roundness looks consistent as lane size changes</em>    </p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Int</em>  roundness</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">calcRoundness</span> : <span class="keyword">function</span>() {
	   <span class="keyword">var</span> <span class="variable">roundness</span> = <span class="this">this</span>.<span class="variable">getHeight</span>() * <span class="this">this</span>.<span class="variable">getAttr</span>(<span class="string">'roundness'</span>)/<span class="number integer">100</span>;
	   <span class="comment">// round roundness to the nearest 0.5</span>
      <span class="variable">roundness</span> = ((<span class="variable">roundness</span>*<span class="number integer">10</span> % <span class="number integer">5</span>) &gt;= <span class="number float">2.5</span> ? <span class="variable">parseInt</span>(<span class="variable">roundness</span>*<span class="number integer">10</span> <span class="regexp">/ 5) * 5 + 5 : parseInt(roundness*10 /</span> <span class="number integer">5</span>) * <span class="number integer">5</span>) / <span class="number integer">10</span>;
	   <span class="keyword">return</span> (<span class="variable">roundness</span>);
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>isContainedWithinRect</strong></p>

<p><em>determines if this glyph/feature is contained within a box with the given coordinates</em>    </p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  selectionTlX - top left X coordinate of bounding box</p></li><li><p><strong>param</strong>: <em>Int</em>  selectionTlY - top left Y coordinate of bounding box</p></li><li><p><strong>param</strong>: <em>Int</em>  selectionBrX - bottom right X coordinate of bounding box</p></li><li><p><strong>param</strong>: <em>Int</em>  selectionBrY - bottom right Y coordinate of bounding box</p></li><li><p><strong>return</strong>: <em>Boolean</em>  isContained</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">isContainedWithinRect</span> : <span class="keyword">function</span>(<span class="variable">selectionTlX</span>, <span class="variable">selectionTlY</span>, <span class="variable">selectionBrX</span>, <span class="variable">selectionBrY</span>) {
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      <span class="keyword">var</span> <span class="variable">y</span> = <span class="variable">glyph</span>.<span class="variable">getPixelPositionY</span>();
      <span class="keyword">var</span> <span class="variable">tlX</span> = <span class="variable">glyph</span>.<span class="variable">getPixelPositionX</span>();
      <span class="keyword">var</span> <span class="variable">tlY</span> = <span class="variable">y</span>
      <span class="keyword">var</span> <span class="variable">brX</span> = <span class="variable">glyph</span>.<span class="variable">getPixelPositionX</span>() + <span class="variable">glyph</span>.<span class="variable">getPixelLength</span>();
      <span class="keyword">var</span> <span class="variable">brY</span> = <span class="variable">y</span> + <span class="variable">glyph</span>.<span class="variable">getHeight</span>(); 
      <span class="keyword">return</span> <span class="variable">tlX</span> &gt;= <span class="variable">selectionTlX</span>
         &amp;&amp; <span class="variable">brX</span> &lt;= <span class="variable">selectionBrX</span>
         &amp;&amp; <span class="variable">tlY</span> &gt;= <span class="variable">selectionTlY</span>
         &amp;&amp; <span class="variable">brY</span> &lt;= <span class="variable">selectionBrY</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getHeight</strong></p>

<p><em>returns the height of this glyph/feature in pixels</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Int</em>  height</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getHeight</span> : <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      <span class="keyword">return</span> ( <span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">getHeight</span>() );
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getFillStyle</strong></p>

<p><em>converts glyph.color into the format taken by canvas.context.fillStyle</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Sting | Object</em>  fillStyle</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getFillStyle</span> : <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      <span class="keyword">var</span> <span class="variable">color</span> = <span class="variable">glyph</span>.<span class="variable">getAttr</span>(<span class="string">'color'</span>);
		
      <span class="keyword">if</span> (<span class="variable">color</span> <span class="variable">instanceof</span> <span class="class">Array</span>) {
         <span class="keyword">var</span> <span class="variable">lineargradient</span> = <span class="this">this</span>.<span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">ctx</span>.<span class="variable">createLinearGradient</span>(<span class="this">this</span>.<span class="regexp">/2, 0, this.length/</span><span class="number integer">2</span>, <span class="this">this</span>.<span class="variable">getHeight</span>());
         <span class="keyword">var</span> <span class="variable">currColor</span>;
         <span class="keyword">for</span>(<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">currColor</span>=<span class="variable">color</span>[<span class="variable">i</span>], <span class="variable">i</span> &lt; <span class="variable">color</span>.<span class="variable">length</span>; <span class="variable">i</span>++)
            <span class="variable">lineargradient</span>.<span class="variable">addColorStop</span>(<span class="variable">i</span> / (<span class="variable">color</span>.<span class="variable">length</span>-<span class="number integer">1</span>), <span class="variable">currColor</span>);
         <span class="keyword">return</span> <span class="variable">lineargradient</span>
      } <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">color</span> <span class="variable">instanceof</span> <span class="class">Function</span>) {
         <span class="keyword">var</span> <span class="variable">lineargradient</span> = <span class="this">this</span>.<span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">chart</span>.<span class="variable">ctx</span>.<span class="variable">createLinearGradient</span>(<span class="this">this</span>.<span class="regexp">/2, 0, this.length/</span><span class="number integer">2</span>, <span class="this">this</span>.<span class="variable">getHeight</span>());
        <span class="keyword">return</span> <span class="variable">color</span>(<span class="variable">lineargradient</span>); 
      } <span class="keyword">else</span> 
         <span class="keyword">return</span> <span class="variable">color</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getStrokeStyle</strong></p>

<p><em>converts glyph.borderColor into the format taken by canvas.context.fillStyle</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Sting | Object</em>  fillStyle</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getStrokeStyle</span> : <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      <span class="keyword">var</span> <span class="variable">color</span> = <span class="variable">glyph</span>.<span class="variable">getAttr</span>(<span class="string">'borderColor'</span>);
		
      <span class="keyword">if</span> (<span class="keyword">typeof</span>(<span class="variable">color</span>) == &quot;<span class="variable">object</span>&quot;) {
         <span class="keyword">var</span> <span class="variable">lineargradient</span> = <span class="this">this</span>.<span class="variable">lane</span>.<span class="variable">ctx</span>.<span class="variable">createLinearGradient</span>(<span class="this">this</span>.<span class="regexp">/2, 0, this.length/</span><span class="number integer">2</span>, <span class="this">this</span>.<span class="variable">getHeight</span>());
         <span class="keyword">var</span> <span class="variable">currColor</span>;
         <span class="keyword">for</span>(<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">currColor</span>=<span class="variable">color</span>[<span class="variable">i</span>], <span class="variable">i</span> &lt; <span class="variable">color</span>.<span class="variable">length</span>; <span class="variable">i</span>++)
            <span class="variable">lineargradient</span>.<span class="variable">addColorStop</span>(<span class="variable">i</span> / (<span class="variable">color</span>.<span class="variable">length</span>-<span class="number integer">1</span>), <span class="variable">currColor</span>);
         <span class="keyword">return</span> <span class="variable">lineargradient</span>
      } <span class="keyword">else</span> 
         <span class="keyword">return</span> <span class="variable">color</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>isSubFeature</strong></p>

<p><em>checks if glyph/feature has a parent</em></p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em>  isSubFeature? </p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">isSubFeature</span>: <span class="keyword">function</span>() {
      <span class="keyword">return</span> (<span class="this">this</span>.<span class="variable">parent</span> != <span class="variable">undefined</span>);
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>erase</strong></p>

<p><em>erase this glyph/feature</em></p>

<ul><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">erase</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">save</span>();
      <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">setTransform</span>(<span class="number integer">1</span>,<span class="number integer">0</span>,<span class="number integer">0</span>,<span class="number integer">1</span>,<span class="number integer">0</span>,<span class="number integer">0</span>);
      <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">clearRect</span>(<span class="variable">glyph</span>.<span class="variable">getPixelPositionX</span>(), <span class="variable">glyph</span>.<span class="variable">getPixelPositionY</span>(), <span class="variable">glyph</span>.<span class="variable">getPixelLength</span>(), <span class="variable">glyph</span>.<span class="variable">getHeight</span>());
      <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">restore</span>();
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addDrawHook</strong></p>

<p><em>add function to glyph that executes before the glyph is drawn</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  function - takes glyph as param, returns true to stop the normal draw, false to allow</p></li><li><p><strong>return</strong>: <em>Int</em>  id - returns the uniqe id for the hook which is used to remove it</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addDrawHook</span>: <span class="keyword">function</span>(<span class="variable">fn</span>, <span class="variable">hookId</span>) {
      <span class="keyword">var</span> <span class="variable">uid</span> = <span class="variable">hookId</span> || <span class="variable">_uniqueId</span>(<span class="string">'drawHook'</span>);
      <span class="this">this</span>.<span class="variable">hooks</span>[<span class="variable">uid</span>] = <span class="variable">fn</span>;
      <span class="keyword">return</span> <span class="variable">uid</span>;
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>removeDrawHook</strong></p>

<p><em>removes function to glyph that executes before the glyph is drawn</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  id - the id of drawHook function that will be removed</p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">removeDrawHook</span>: <span class="keyword">function</span>(<span class="variable">uid</span>) {
       <span class="keyword">delete</span> <span class="this">this</span>.<span class="variable">hooks</span>[<span class="variable">uid</span>];
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addTooltip</strong></p>

<p><em>add tooltip to glyph. Can add multiple tooltips</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  placement - two options &#39;above&#39; glyph or &#39;below&#39; glyph</p></li><li><p><strong>param</strong>: <em>Int</em>  verticalOffset - + numbers for up, - for down</p></li><li><p><strong>param</strong>: <em>Hash</em>  options - optional attributes, horizontalOffset and ntOffset (nucleotide)</p></li><li><p><strong>return</strong>: <em>Object</em>  tooltip   </p></li><li><p><strong>api</strong>: <em>public</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addTooltip</span>: <span class="keyword">function</span>(<span class="variable">text</span>, <span class="variable">placement</span>, <span class="variable">verticalOffset</span>, <span class="variable">opts</span>){
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      <span class="keyword">var</span> <span class="variable">tt</span> = <span class="keyword">new</span> <span class="class">Tooltip</span>(<span class="variable">text</span>, <span class="variable">placement</span>, <span class="variable">verticalOffset</span>, <span class="variable">opts</span>);
      <span class="variable">tt</span>.<span class="variable">feature</span> = <span class="variable">glyph</span>;
      <span class="variable">glyph</span>.<span class="variable">tooltips</span>.<span class="variable">push</span>( <span class="variable">tt</span> );
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>fireTooltips</strong></p>

<p><em>draws the tooltips associated with this feature</em></p>

<ul><li><p><strong>api</strong>: <em>public</em></p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">fireTooltips</span>: <span class="keyword">function</span>() {
       <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="this">this</span>.<span class="variable">tooltips</span>.<span class="variable">length</span>; <span class="variable">i</span>++)
         <span class="this">this</span>.<span class="variable">tooltips</span>[<span class="variable">i</span>].<span class="variable">fire</span>()
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>draw</strong></p>

<p><em>draws the glyph</em></p>

<ul><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">draw</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      
      <span class="comment">// set ctx</span>
      <span class="variable">glyph</span>.<span class="variable">ctx</span> = <span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">chart</span>.<span class="variable">ctx</span>;
      <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">beginPath</span>();
      
      <span class="comment">// intialize</span>
      <span class="keyword">var</span> <span class="variable">fontSize</span> = <span class="regexp">/^\d+/</span>.<span class="variable">exec</span>(<span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">font</span>);
      <span class="keyword">var</span> <span class="variable">font</span> = <span class="regexp">/\S+$/</span>.<span class="variable">exec</span>(<span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">font</span>);
      <span class="keyword">var</span> <span class="variable">fontSizeMin</span> = <span class="number integer">10</span>;
      <span class="variable">glyph</span>.<span class="variable">onClick</span> = <span class="variable">glyph</span>.<span class="variable">getAttr</span>(<span class="string">'onClick'</span>);
      <span class="variable">glyph</span>.<span class="variable">onMouseover</span> = <span class="variable">glyph</span>.<span class="variable">getAttr</span>(<span class="string">'onMouseover'</span>);
      <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">glyph</span>.<span class="variable">getFillStyle</span>();
      <span class="keyword">var</span> <span class="variable">fillStyle</span> = <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">fillStyle</span>;
      <span class="keyword">var</span> <span class="variable">position</span> = <span class="variable">glyph</span>.<span class="variable">getPixelPositionX</span>();
      <span class="keyword">var</span> <span class="variable">height</span> = <span class="variable">glyph</span>.<span class="variable">getHeight</span>();
      
      (<span class="variable">height</span> &lt; <span class="variable">fontSizeMin</span>) ? <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">font</span> = <span class="variable">fontSizeMin</span> + &quot;<span class="variable">px</span> &quot; + <span class="variable">font</span> : <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">font</span> = <span class="variable">height</span> *.<span class="number integer">9</span> + &quot;<span class="variable">px</span> &quot; + <span class="variable">font</span>;					
      
      <span class="comment">// setup ctx position and orientation</span>
      <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">translate</span>(<span class="variable">position</span>, <span class="number integer">0</span>);			
      <span class="keyword">if</span> (<span class="variable">glyph</span>.<span class="variable">strand</span> == <span class="string">'-'</span> &amp;&amp; !<span class="variable">glyph</span>.<span class="variable">isSubFeature</span>()) 
         <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">transform</span>(-<span class="number integer">1</span>, <span class="number integer">0</span>, <span class="number integer">0</span>, <span class="number integer">1</span>, <span class="variable">glyph</span>.<span class="variable">getPixelLength</span>(), <span class="number integer">0</span>);
      
      <span class="keyword">var</span> <span class="variable">dontDraw</span> = <span class="variable">false</span>;
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="variable">glyph</span>.<span class="variable">hooks</span>) {
         <span class="variable">dontDraw</span> = <span class="variable">glyph</span>.<span class="variable">hooks</span>[<span class="variable">i</span>](<span class="variable">glyph</span>) || <span class="variable">dontDraw</span>;
      }
      <span class="keyword">if</span> (!<span class="variable">dontDraw</span>) {
         <span class="comment">// draw glyph with subclass specific draw</span>
         <span class="variable">glyph</span>.<span class="variable">_draw</span>();
      }
            
      
      <span class="comment">// draw border color</span>
      <span class="keyword">if</span> (<span class="variable">glyph</span>.<span class="variable">borderColor</span> != &quot;<span class="variable">none</span>&quot;) {
         <span class="keyword">if</span>(<span class="variable">glyph</span>.<span class="variable">color</span> == <span class="string">'none'</span> &amp;&amp; <span class="variable">glyph</span>.<span class="variable">parent</span>.<span class="variable">glyphType</span> == <span class="string">'Complex'</span>) {
            <span class="variable">glyph</span>.<span class="variable">erase</span>();
         }
         <span class="keyword">var</span> <span class="variable">saveStrokeStyle</span> = <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">strokeStyle</span>;
         <span class="keyword">var</span> <span class="variable">saveLineWidth</span> = <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">lineWidth</span>;
         <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">strokeStyle</span> = <span class="variable">glyph</span>.<span class="variable">getStrokeStyle</span>();
         <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">lineWidth</span> = <span class="variable">glyph</span>.<span class="variable">getAttr</span>(<span class="string">'borderWidth'</span>);
         <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">stroke</span>();
         <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">strokeStyle</span> = <span class="variable">saveStrokeStyle</span>;
         <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">lineWidth</span> = <span class="variable">saveLineWidth</span>;
      }
		
		<span class="comment">// draw fill color</span>
      <span class="keyword">if</span> (<span class="variable">glyph</span>.<span class="variable">color</span> !=&quot;<span class="variable">none</span>&quot;) <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">fill</span>();
		
      <span class="comment">// explicity change transformation matrix back -- it's faster than save restore!</span>
      <span class="keyword">if</span> (<span class="variable">glyph</span>.<span class="variable">strand</span> == <span class="string">'-'</span> &amp;&amp; !<span class="variable">glyph</span>.<span class="variable">isSubFeature</span>()) 
         <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">transform</span>(-<span class="number integer">1</span>, <span class="number integer">0</span>, <span class="number integer">0</span>, <span class="number integer">1</span>, <span class="variable">glyph</span>.<span class="variable">getPixelLength</span>(), <span class="number integer">0</span>);

      <span class="comment">// draw text</span>
      <span class="variable">glyph</span>.<span class="variable">drawText</span>(<span class="variable">glyph</span>.<span class="variable">getAttr</span>(<span class="string">'name'</span>));
		
      <span class="comment">// explicity change transformation matrix back -- it's faster than save restore!</span>
      <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">translate</span>(-<span class="variable">position</span>, <span class="number integer">0</span>);
      <span class="variable">glyph</span>.<span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">fillStyle</span>;
      
      <span class="comment">// setup mouse events if need be</span>
      <span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>.<span class="variable">addEvents</span>(<span class="this">this</span>); 
			
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>redraw</strong></p>

<p><em>erases this specific glyph and redraws it</em></p>

<ul><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">redraw</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> <span class="variable">glyph</span> = <span class="this">this</span>;
      <span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">ctx</span>.<span class="variable">save</span>();
      <span class="variable">glyph</span>.<span class="variable">erase</span>;
      <span class="keyword">var</span> <span class="variable">y</span> = <span class="variable">glyph</span>.<span class="variable">getPixelPositionY</span>();
      <span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">ctx</span>.<span class="variable">translate</span>(<span class="number integer">0</span>, <span class="variable">y</span>);
      <span class="variable">glyph</span>.<span class="variable">draw</span>();
      <span class="variable">glyph</span>.<span class="variable">lane</span>.<span class="variable">ctx</span>.<span class="variable">restore</span>();
   }
   
});
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="Scribl.events.js"><a href="#">Scribl.events</a></h2></td><td>Scribl.events.js</td></tr><tr class="code">
<td class="docs">
<p><strong>Scribl::Events</strong></p>

<p><em>Adds event support to Scribl</em></p>

<p>Chase Miller 2011
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">MouseEventHandler</span> = <span class="class">Class</span>.<span class="variable">extend</span>({</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>init</strong></p>

<p><em>Constructor, call this with <code>new MouseEventHandler()</code></em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  chart - Scribl object</p></li><li><p><strong>return</strong>: <em>Object</em>  MouseEventHandler object</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">init</span>: <span class="keyword">function</span>(<span class="variable">chart</span>) {
      <span class="this">this</span>.<span class="variable">chart</span> = <span class="variable">chart</span>;
      <span class="this">this</span>.<span class="variable">mouseX</span> = <span class="keyword">null</span>;
      <span class="this">this</span>.<span class="variable">mouseY</span> = <span class="keyword">null</span>;
      <span class="this">this</span>.<span class="variable">eventElement</span> = <span class="variable">undefined</span>; 
      <span class="this">this</span>.<span class="variable">isEventDetected</span> = <span class="variable">false</span>;	
      <span class="this">this</span>.<span class="variable">tooltip</span> = <span class="keyword">new</span> <span class="class">Tooltip</span>(&quot;&quot;, <span class="string">'above'</span>, -<span class="number integer">4</span>);
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addEvents</strong></p>

<p><em>registers event listeners if feature (or parent if part of complex feature) has mouse events associated with it</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  feature - any of the derived Glyph classes (e.g. Rect, Arrow, etc..)</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addEvents</span>: <span class="keyword">function</span>(<span class="variable">feature</span>) {
      <span class="keyword">var</span> <span class="variable">chart</span> = <span class="this">this</span>.<span class="variable">chart</span>;
      <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">chart</span>.<span class="variable">ctx</span>;
      <span class="keyword">var</span> <span class="variable">me</span> = <span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>;
      
      <span class="comment">// check if any features use onmouseover and if so register an event listener if not already done</span>
      <span class="keyword">if</span> (<span class="variable">feature</span>.<span class="variable">onMouseover</span> &amp;&amp; !<span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">hasMouseover</span> ) {
      	<span class="variable">chart</span>.<span class="variable">addMouseoverEventListener</span>(<span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>.<span class="variable">handleMouseover</span>);
      	<span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">hasMouseover</span> = <span class="variable">true</span>;
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">feature</span>.<span class="variable">tooltips</span>.<span class="variable">length</span>&gt;<span class="number integer">0</span> &amp;&amp; !<span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">hasMouseover</span>){
      	<span class="variable">chart</span>.<span class="variable">addMouseoverEventListener</span>(<span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>.<span class="variable">handleMouseover</span>);
      	<span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">hasMouseover</span> = <span class="variable">true</span>;
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">feature</span>.<span class="variable">parent</span> &amp;&amp; <span class="variable">feature</span>.<span class="variable">parent</span>.<span class="variable">tooltips</span>.<span class="variable">length</span>&gt;<span class="number integer">0</span> &amp;&amp; !<span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">hasMouseover</span>){
      	<span class="variable">chart</span>.<span class="variable">addMouseoverEventListener</span>(<span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>.<span class="variable">handleMouseover</span>);
      	<span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">hasMouseover</span> = <span class="variable">true</span>;
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">feature</span>.<span class="variable">parent</span> &amp;&amp; <span class="variable">feature</span>.<span class="variable">parent</span>.<span class="variable">onMouseover</span> &amp;&amp; !<span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">hasMouseover</span>) {
      	<span class="variable">chart</span>.<span class="variable">addMouseoverEventListener</span>(<span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>.<span class="variable">handleMouseover</span>);
      	<span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">hasMouseover</span> = <span class="variable">true</span>;
      }
      	
      <span class="comment">// check if any features use onclick and if so register event listeners if not already done</span>
      <span class="keyword">if</span> (<span class="variable">feature</span>.<span class="variable">onClick</span> &amp;&amp; !<span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">hasClick</span>) {
      	<span class="variable">chart</span>.<span class="variable">addClickEventListener</span>(<span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>.<span class="variable">handleClick</span>);
      	<span class="variable">chart</span>.<span class="variable">addMouseoverEventListener</span>(<span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>.<span class="variable">handleMouseStyle</span>);
      	<span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">hasClick</span> = <span class="variable">true</span>;
      } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">feature</span>.<span class="variable">parent</span> &amp;&amp; <span class="variable">feature</span>.<span class="variable">parent</span>.<span class="variable">onClick</span> &amp;&amp; !<span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">hasClick</span>) {
      	<span class="variable">chart</span>.<span class="variable">addClickEventListener</span>(<span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>.<span class="variable">handleClick</span>);
      	<span class="variable">chart</span>.<span class="variable">addMouseoverEventListener</span>(<span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>.<span class="variable">handleMouseStyle</span>);
      	<span class="variable">chart</span>.<span class="variable">events</span>.<span class="variable">hasClick</span> = <span class="variable">true</span>;
      }
      
      <span class="comment">// determine if cursor is currently in a drawn object (feature)</span>
      <span class="keyword">if</span> (!<span class="variable">me</span>.<span class="variable">isEventDetected</span> &amp;&amp; <span class="variable">ctx</span>.<span class="variable">isPointInPath_mozilla</span>(<span class="variable">me</span>.<span class="variable">mouseX</span>,<span class="variable">me</span>.<span class="variable">mouseY</span>)) {
      	<span class="variable">me</span>.<span class="variable">eventElement</span> = <span class="variable">feature</span>;
      	<span class="variable">me</span>.<span class="variable">isEventDetected</span> = <span class="variable">true</span>;
      }		
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>setMousePosition</strong></p>

<p><em>sets the mouse position relative to the canvas</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  e - event</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">setMousePosition</span>: <span class="keyword">function</span>(<span class="variable">e</span>) {
      <span class="keyword">if</span> (<span class="variable">e</span>!=<span class="keyword">null</span>) {
         <span class="keyword">var</span> <span class="variable">rect</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">canvas</span>.<span class="variable">getBoundingClientRect</span>();
         <span class="this">this</span>.<span class="variable">mouseX</span> = <span class="variable">e</span>.<span class="variable">clientX</span> - <span class="variable">rect</span>.<span class="variable">left</span>;
         <span class="this">this</span>.<span class="variable">mouseY</span> = <span class="variable">e</span>.<span class="variable">clientY</span> - <span class="variable">rect</span>.<span class="variable">top</span>;
      }
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>handleClick</strong></p>

<p><em>gets called when there is a click and determines how to handle it</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  chart - Scribl object</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">handleClick</span>: <span class="keyword">function</span>(<span class="variable">chart</span>) {
      <span class="keyword">var</span> <span class="variable">me</span> = <span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>;
      <span class="keyword">var</span> <span class="variable">clicked</span> = <span class="variable">me</span>.<span class="variable">eventElement</span>;
      <span class="keyword">var</span> <span class="variable">onClick</span>;
      
      <span class="comment">// check if the click occured on a feature/object with an onClick property</span>
      <span class="keyword">if</span> (<span class="variable">clicked</span> != <span class="variable">undefined</span> &amp;&amp; <span class="variable">clicked</span>.<span class="variable">onClick</span> != <span class="variable">undefined</span>)
         <span class="variable">onClick</span> = <span class="variable">clicked</span>.<span class="variable">onClick</span>
      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">clicked</span> &amp;&amp; <span class="variable">clicked</span>.<span class="variable">parent</span> &amp;&amp; <span class="variable">clicked</span>.<span class="variable">parent</span>.<span class="variable">onClick</span>)
         <span class="variable">onClick</span> = <span class="variable">clicked</span>.<span class="variable">parent</span>.<span class="variable">onClick</span>
      
      <span class="keyword">if</span>(<span class="variable">onClick</span>){
         <span class="comment">// open window if string</span>
         <span class="keyword">if</span> (<span class="keyword">typeof</span>(<span class="variable">onClick</span>) == &quot;<span class="variable">string</span>&quot;){ <span class="variable">window</span>.<span class="variable">open</span>(<span class="variable">onClick</span>); }
         <span class="comment">// if function run function with feature as argument</span>
         <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(<span class="variable">onClick</span>) == &quot;<span class="keyword">function</span>&quot;){ <span class="variable">onClick</span>(<span class="variable">clicked</span>); }
      }
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>handleMouseover</strong></p>

<p><em>gets called when there is a mouseover and fires tooltip if necessary</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  chart - Scribl object</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">handleMouseover</span>: <span class="keyword">function</span>(<span class="variable">chart</span>) {
      <span class="keyword">var</span> <span class="variable">me</span> = <span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>;
      <span class="keyword">var</span> <span class="variable">clicked</span> = <span class="variable">me</span>.<span class="variable">eventElement</span>;
      
      <span class="comment">// handle mouseover tooltips</span>
      <span class="keyword">if</span> (<span class="variable">clicked</span> &amp;&amp; <span class="variable">clicked</span>.<span class="variable">onMouseover</span> == <span class="variable">undefined</span> &amp;&amp; <span class="variable">clicked</span>.<span class="variable">parent</span> &amp;&amp; <span class="variable">clicked</span>.<span class="variable">parent</span>.<span class="variable">onMouseover</span>) {
         <span class="variable">clicked</span>.<span class="variable">onMouseover</span> = <span class="variable">clicked</span>.<span class="variable">parent</span>.<span class="variable">onMouseover</span>
      }
      
      <span class="keyword">if</span>(<span class="variable">clicked</span> &amp;&amp; <span class="variable">clicked</span>.<span class="variable">onMouseover</span>) {
         <span class="comment">// open window if string</span>
         <span class="keyword">if</span> (<span class="keyword">typeof</span>(<span class="variable">clicked</span>.<span class="variable">onMouseover</span>) == &quot;<span class="variable">string</span>&quot;){ <span class="variable">me</span>.<span class="variable">tooltip</span>.<span class="variable">fire</span>(<span class="variable">clicked</span>); }
         <span class="comment">// if function run function with feature as argument</span>
         <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(<span class="variable">clicked</span>.<span class="variable">onMouseover</span>) == &quot;<span class="keyword">function</span>&quot;){ <span class="variable">clicked</span>.<span class="variable">onMouseover</span>(<span class="variable">clicked</span>); }
      }
      
      <span class="comment">// handle tooltip object tooltips</span>
      <span class="keyword">if</span> (<span class="variable">clicked</span> &amp;&amp; <span class="variable">clicked</span>.<span class="variable">tooltips</span>.<span class="variable">length</span> &gt; <span class="number integer">0</span>)
         <span class="variable">clicked</span>.<span class="variable">fireTooltips</span>();
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>handleMouseStyle</strong></p>

<p><em>changes cursor to pointer if the feature the mouse is over can be clicked</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  chart - Scribl object</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">handleMouseStyle</span>: <span class="keyword">function</span>(<span class="variable">chart</span>) {
      <span class="keyword">var</span> <span class="variable">me</span> = <span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>;
      <span class="keyword">var</span> <span class="variable">obj</span> = <span class="variable">me</span>.<span class="variable">eventElement</span>;
      <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">chart</span>.<span class="variable">ctx</span>;
      
      <span class="keyword">if</span> (<span class="variable">obj</span> &amp;&amp; <span class="variable">obj</span>.<span class="variable">onClick</span> != <span class="variable">undefined</span>)
         <span class="variable">ctx</span>.<span class="variable">canvas</span>.<span class="variable">style</span>.<span class="variable">cursor</span> = <span class="string">'pointer'</span>;
      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">obj</span> &amp;&amp; <span class="variable">obj</span>.<span class="variable">parent</span> &amp;&amp; <span class="variable">obj</span>.<span class="variable">parent</span>.<span class="variable">onClick</span> != <span class="variable">undefined</span>)
         <span class="variable">ctx</span>.<span class="variable">canvas</span>.<span class="variable">style</span>.<span class="variable">cursor</span> = <span class="string">'pointer'</span>;
      <span class="keyword">else</span>
         <span class="variable">ctx</span>.<span class="variable">canvas</span>.<span class="variable">style</span>.<span class="variable">cursor</span> = <span class="string">'auto'</span>; 		
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>reset</strong></p>

<p><em>resets the state of the mouseEventHandler</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  chart - Scribl object</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">reset</span>: <span class="keyword">function</span>(<span class="variable">chart</span>) {
      <span class="keyword">var</span> <span class="variable">me</span> = <span class="variable">chart</span>.<span class="variable">myMouseEventHandler</span>;
      <span class="variable">me</span>.<span class="variable">mouseX</span> = <span class="keyword">null</span>;
      <span class="variable">me</span>.<span class="variable">mouseY</span> = <span class="keyword">null</span>;
      <span class="variable">me</span>.<span class="variable">eventElement</span> = <span class="variable">undefined</span>;
      <span class="variable">me</span>.<span class="variable">isEventDetected</span> = <span class="keyword">null</span>;
      <span class="variable">me</span>.<span class="variable">elementIndexCounter</span> = <span class="number integer">0</span>;
   }
	
});

<span class="comment">// FIX FOR FIREFOX BUG in ctx.isPointInPath() function</span>
<span class="class">CanvasRenderingContext2D</span>.<span class="variable">prototype</span>.<span class="variable">isPointInPath_mozilla</span> = <span class="keyword">function</span>( <span class="variable">x</span>, <span class="variable">y</span> )
{
   <span class="keyword">if</span> (<span class="variable">navigator</span>.<span class="variable">userAgent</span>.<span class="variable">indexOf</span>(<span class="string">'Firefox'</span>) != -<span class="number integer">1</span>){
      <span class="this">this</span>.<span class="variable">save</span>();
      <span class="this">this</span>.<span class="variable">setTransform</span>( <span class="number integer">1</span>, <span class="number integer">0</span>, <span class="number integer">0</span>, <span class="number integer">1</span>, <span class="number integer">0</span>, <span class="number integer">0</span> );
      <span class="keyword">var</span> <span class="variable">ret</span> = <span class="this">this</span>.<span class="variable">isPointInPath</span>( <span class="variable">x</span>, <span class="variable">y</span> );
      <span class="this">this</span>.<span class="variable">restore</span>();
   } <span class="keyword">else</span>
      <span class="keyword">var</span> <span class="variable">ret</span> = <span class="this">this</span>.<span class="variable">isPointInPath</span>( <span class="variable">x</span>, <span class="variable">y</span> );
		
   <span class="keyword">return</span> <span class="variable">ret</span>;
}
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="Scribl.utils.js"><a href="#">Scribl.utils</a></h2></td><td>Scribl.utils.js</td></tr><tr class="code">
<td class="docs">
<p><strong>Scribl::Utils</strong></p>

<p>Chase Miller 2011
 </p>
</td>
<td class="code">

</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>ScriblWrapLines</strong></p>

<p><em>transforms text to fit in a column of given width</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Int</em>  max - column width in letters</p></li><li><p><strong>param</strong>: <em>String</em>  text</p></li><li><p><strong>return</strong>: <em>String</em>  formatted text</p></li><li><p><strong>api</strong>: <em>internal</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="class">ScriblWrapLines</span>(<span class="variable">max</span>, <span class="variable">text</span>) {
	<span class="keyword">var</span> <span class="variable">lines</span> = [];
	<span class="variable">text</span> = &quot;&quot; + <span class="variable">text</span>;
	<span class="keyword">var</span> <span class="variable">temp</span> = &quot;&quot;;
	<span class="keyword">var</span> <span class="variable">chcount</span> = <span class="number integer">0</span>; 
	<span class="keyword">var</span> <span class="variable">linecount</span> = <span class="number integer">0</span>;
	<span class="keyword">var</span> <span class="variable">words</span> = <span class="variable">text</span>.<span class="variable">split</span>(&quot; &quot;);
	
	<span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">words</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
		<span class="keyword">if</span> ((<span class="variable">words</span>[<span class="variable">i</span>].<span class="variable">length</span> + <span class="variable">temp</span>.<span class="variable">length</span>) &lt;= <span class="variable">max</span>)
			<span class="variable">temp</span> += &quot; &quot; + <span class="variable">words</span>[<span class="variable">i</span>]
		<span class="keyword">else</span> {
			<span class="comment">// word is bigger than line break</span>
			<span class="keyword">if</span> (<span class="variable">temp</span> == &quot;&quot;) {
				<span class="variable">trunc1</span> = <span class="variable">words</span>[<span class="variable">i</span>].<span class="variable">slice</span>(<span class="number integer">0</span>, <span class="variable">max</span>-<span class="number integer">1</span>);
				<span class="variable">temp</span> += &quot; &quot; + <span class="variable">trunc1</span> + &quot;-&quot;
				<span class="variable">trunc2</span> = <span class="variable">words</span>[<span class="variable">i</span>].<span class="variable">slice</span>(<span class="variable">max</span>, <span class="variable">words</span>[<span class="variable">i</span>].<span class="variable">length</span>);
				<span class="variable">words</span>.<span class="variable">splice</span>(<span class="variable">i</span>+<span class="number integer">1</span>, <span class="number integer">0</span>, <span class="variable">trunc2</span>);
				<span class="variable">lines</span>.<span class="variable">push</span>(<span class="variable">temp</span>);
				<span class="variable">temp</span> = &quot;&quot;;
				<span class="variable">linecount</span>++;
			}
			<span class="keyword">else</span> {
				<span class="variable">i</span>--;
				<span class="variable">lines</span>.<span class="variable">push</span>(<span class="variable">temp</span>);
				<span class="variable">linecount</span>++;
				<span class="variable">temp</span> = &quot;&quot;;
			}
		}
	}
	<span class="variable">linecount</span>++;
	<span class="variable">lines</span>.<span class="variable">push</span>(<span class="variable">temp</span>)
	<span class="keyword">return</span> ([<span class="variable">lines</span>, <span class="variable">linecount</span>]); <span class="comment">// sends value of temp back</span>
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>create unique ids </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">idCounter</span> = <span class="number integer">0</span>;
<span class="variable">_uniqueId</span> = <span class="keyword">function</span>(<span class="variable">prefix</span>) {
  <span class="keyword">var</span> <span class="variable">id</span> = <span class="variable">idCounter</span>++;
  <span class="keyword">return</span> <span class="variable">prefix</span> ? <span class="variable">prefix</span> + <span class="variable">id</span> : <span class="variable">id</span>;
};

<span class="comment">// polyfill for older browsers</span>
<span class="class">Object</span>.<span class="variable">keys</span>=<span class="class">Object</span>.<span class="variable">keys</span>||<span class="keyword">function</span>(<span class="variable">o</span>,<span class="variable">k</span>,<span class="variable">r</span>){<span class="variable">r</span>=[];<span class="keyword">for</span>(<span class="variable">k</span> <span class="keyword">in</span> <span class="variable">o</span>)<span class="variable">r</span>.<span class="variable">hasOwnProperty</span>.<span class="variable">call</span>(<span class="variable">o</span>,<span class="variable">k</span>)&amp;&amp;<span class="variable">r</span>.<span class="variable">push</span>(<span class="variable">k</span>);<span class="keyword">return</span> <span class="variable">r</span>}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>add indexOf if not implemented for compatibility
    with older browsers</p>
</td>
<td class="code">
<pre><code><span class="keyword">if</span> (!<span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">indexOf</span>) {  
    <span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">indexOf</span> = <span class="keyword">function</span> (<span class="variable">searchElement</span></code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>, fromIndex </p>
</td>
<td class="code">
<pre><code>) {  
        &quot;<span class="variable">use</span> <span class="variable">strict</span>&quot;;  
        <span class="keyword">if</span> (<span class="this">this</span> === <span class="keyword">void</span> <span class="number integer">0</span> || <span class="this">this</span> === <span class="keyword">null</span>) {  
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">TypeError</span>();  
        }  
        <span class="keyword">var</span> <span class="variable">t</span> = <span class="class">Object</span>(<span class="this">this</span>);  
        <span class="keyword">var</span> <span class="variable">len</span> = <span class="variable">t</span>.<span class="variable">length</span> &gt;&gt;&gt; <span class="number integer">0</span>;  
        <span class="keyword">if</span> (<span class="variable">len</span> === <span class="number integer">0</span>) {  
            <span class="keyword">return</span> -<span class="number integer">1</span>;  
        }  
        <span class="keyword">var</span> <span class="variable">n</span> = <span class="number integer">0</span>;  
        <span class="keyword">if</span> (<span class="variable">arguments</span>.<span class="variable">length</span> &gt; <span class="number integer">0</span>) {  
            <span class="variable">n</span> = <span class="class">Number</span>(<span class="variable">arguments</span>[<span class="number integer">1</span>]);  
            <span class="keyword">if</span> (<span class="variable">n</span> !== <span class="variable">n</span>) { <span class="comment">// shortcut for verifying if it's NaN  </span>
                <span class="variable">n</span> = <span class="number integer">0</span>;  
            } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">n</span> !== <span class="number integer">0</span> &amp;&amp; <span class="variable">n</span> !== <span class="class">Infinity</span> &amp;&amp; <span class="variable">n</span> !== -<span class="class">Infinity</span>) {  
                <span class="variable">n</span> = (<span class="variable">n</span> &gt; <span class="number integer">0</span> || -<span class="number integer">1</span>) * <span class="class">Math</span>.<span class="variable">floor</span>(<span class="class">Math</span>.<span class="variable">abs</span>(<span class="variable">n</span>));  
            }  
        }  
        <span class="keyword">if</span> (<span class="variable">n</span> &gt;= <span class="variable">len</span>) {  
            <span class="keyword">return</span> -<span class="number integer">1</span>;  
        }  
        <span class="keyword">var</span> <span class="variable">k</span> = <span class="variable">n</span> &gt;= <span class="number integer">0</span> ? <span class="variable">n</span> : <span class="class">Math</span>.<span class="variable">max</span>(<span class="variable">len</span> - <span class="class">Math</span>.<span class="variable">abs</span>(<span class="variable">n</span>), <span class="number integer">0</span>);  
        <span class="keyword">for</span> (; <span class="variable">k</span> &lt; <span class="variable">len</span>; <span class="variable">k</span>++) {  
            <span class="keyword">if</span> (<span class="variable">k</span> <span class="keyword">in</span> <span class="variable">t</span> &amp;&amp; <span class="variable">t</span>[<span class="variable">k</span>] === <span class="variable">searchElement</span>) {  
                <span class="keyword">return</span> <span class="variable">k</span>;  
            }  
        }  
        <span class="keyword">return</span> -<span class="number integer">1</span>;  
    }  
}</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="Scribl.tooltips.js"><a href="#">Scribl.tooltips</a></h2></td><td>Scribl.tooltips.js</td></tr><tr class="code">
<td class="docs">
<p><strong>Scribl::Tooltips</strong></p>

<p><em>Adds event support to Scribl</em></p>

<p>Chase Miller 2011
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Tooltip</span> = <span class="class">Class</span>.<span class="variable">extend</span>({</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>init</strong></p>

<p><em>Constructor, call this with <code>new tooltips()</code></em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  chart - Scribl object</p></li><li><p><strong>return</strong>: <em>Object</em>  tooltip object</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">init</span>: <span class="keyword">function</span>(<span class="variable">text</span>, <span class="variable">placement</span>, <span class="variable">verticalOffset</span>, <span class="variable">opts</span>) {
	   <span class="keyword">var</span> <span class="variable">tt</span> = <span class="this">this</span>;    
	   <span class="variable">tt</span>.<span class="variable">text</span> = <span class="variable">text</span>; 
      <span class="variable">tt</span>.<span class="variable">placement</span> = <span class="variable">placement</span> || <span class="string">'above'</span>;
      <span class="variable">tt</span>.<span class="variable">verticalOffset</span> = <span class="variable">verticalOffset</span> || <span class="number integer">0</span>;      
      <span class="comment">// set option attributes if any</span>
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">attribute</span> <span class="keyword">in</span> <span class="variable">opts</span>)
         <span class="variable">tt</span>[<span class="variable">attribute</span>] = <span class="variable">opts</span>[<span class="variable">attribute</span>];
         
      <span class="variable">tt</span>.<span class="variable">horizontalOffset</span> = <span class="variable">tt</span>.<span class="variable">horizontalOffset</span> || <span class="number integer">0</span>;
      <span class="variable">tt</span>.<span class="variable">ntOffset</span> = <span class="variable">tt</span>.<span class="variable">ntOffset</span> || <span class="number integer">0</span>;
         
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>fire</strong></p>

<p><em>fires the tooltip</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  feature - any of the derived Glyph classes (e.g. Rect, Arrow, etc..)</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">fire</span>: <span class="keyword">function</span>(<span class="variable">ft</span>) {  		
      <span class="comment">// get curr opacity</span>
      <span class="keyword">var</span> <span class="variable">feature</span> = <span class="variable">ft</span> || <span class="this">this</span>.<span class="variable">feature</span>;
      <span class="this">this</span>.<span class="variable">chart</span> = <span class="variable">feature</span>.<span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">chart</span>;
      <span class="this">this</span>.<span class="variable">ctx</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">ctx</span>;
      
      <span class="this">this</span>.<span class="variable">draw</span>(<span class="variable">feature</span>, <span class="number integer">1</span>);
      
   },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>draw</strong></p>

<p><em>draws tooltip</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  feature - any of the derived Glyph classes (e.g. Rect, Arrow, etc..)</p></li><li><p><strong>param</strong>: <em>Int</em>  opacity</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">draw</span>: <span class="keyword">function</span>(<span class="variable">feature</span>, <span class="variable">opacity</span>) {
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">globalAlpha</span> = <span class="variable">opacity</span>;	
      
      <span class="comment">// define attributes</span>
      <span class="keyword">var</span> <span class="variable">roundness</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">tooltips</span>.<span class="variable">roundness</span>;
      <span class="keyword">var</span> <span class="variable">font</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">tooltips</span>.<span class="variable">text</span>.<span class="variable">font</span>;
      <span class="keyword">var</span> <span class="variable">fontSize</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">tooltips</span>.<span class="variable">text</span>.<span class="variable">size</span>;
      <span class="keyword">var</span> <span class="variable">text</span> = <span class="this">this</span>.<span class="variable">text</span> || <span class="variable">feature</span>.<span class="variable">onMouseover</span>;
      
      <span class="comment">// Save</span>
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">save</span>();
      		
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">font</span> = <span class="variable">fontSize</span> +  &quot;<span class="variable">px</span> &quot; + <span class="variable">font</span>;
      
      <span class="comment">// determine properties of line</span>
      <span class="keyword">var</span> <span class="variable">dim</span> = <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">measureText</span>(<span class="variable">text</span>);
      <span class="keyword">var</span> <span class="variable">textlines</span> = [<span class="variable">text</span>];
      <span class="keyword">var</span> <span class="variable">height</span> = <span class="variable">fontSize</span> + <span class="number integer">10</span>;
      <span class="keyword">var</span> <span class="variable">length</span> = <span class="variable">dim</span>.<span class="variable">width</span> + <span class="number integer">10</span>;
      <span class="keyword">var</span> <span class="variable">vertical_offset</span> = <span class="variable">height</span> - <span class="number integer">4</span>;
      <span class="keyword">var</span> <span class="variable">fillStyle</span>;
      <span class="keyword">var</span> <span class="variable">strokeStyle</span>;
      
      <span class="comment">// determine nt offset</span>
      <span class="keyword">var</span> <span class="variable">ntOffsetPx</span> = <span class="number integer">0</span>;
      <span class="keyword">if</span>(<span class="variable">feature</span>.<span class="variable">seq</span>) {
         <span class="keyword">var</span> <span class="variable">lengthPx</span> = <span class="variable">feature</span>.<span class="variable">getPixelLength</span>();
         <span class="variable">ntOffsetPx</span> = <span class="this">this</span>.<span class="variable">ntOffset</span> * (<span class="variable">lengthPx</span> / <span class="variable">feature</span>.<span class="variable">length</span>);
      }
      
      <span class="comment">// Get coordinates</span>
      <span class="keyword">var</span> <span class="variable">x</span> = <span class="variable">feature</span>.<span class="variable">getPixelPositionX</span>() + <span class="this">this</span>.<span class="variable">horizontalOffset</span> + <span class="variable">ntOffsetPx</span>;
      <span class="keyword">var</span> <span class="variable">y</span>;
      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">placement</span> == <span class="string">'below'</span>)
         <span class="variable">y</span> = <span class="variable">feature</span>.<span class="variable">getPixelPositionY</span>() + <span class="variable">feature</span>.<span class="variable">getHeight</span>() - <span class="this">this</span>.<span class="variable">verticalOffset</span>;
      <span class="keyword">else</span> 
         <span class="variable">y</span> = <span class="variable">feature</span>.<span class="variable">getPixelPositionY</span>() - <span class="variable">height</span> - <span class="this">this</span>.<span class="variable">verticalOffset</span>;
         
      
         
       
      <span class="comment">// var x = feature.getPixelPositionX();</span>
      <span class="comment">// var y = feature.getPixelPositionY() + feature.getHeight();</span>
      
      
      <span class="comment">// linewrap text</span>
      <span class="keyword">var</span> <span class="variable">geneLength</span> = <span class="variable">feature</span>.<span class="variable">getPixelLength</span>();
      <span class="keyword">var</span> <span class="variable">mincols</span> = <span class="number integer">200</span>;
      <span class="keyword">if</span> (<span class="variable">length</span> &gt; <span class="variable">mincols</span>) {
         <span class="keyword">var</span> <span class="variable">charpixel</span> = <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">measureText</span>(&quot;<span class="variable">s</span>&quot;).<span class="variable">width</span>;
         <span class="keyword">var</span> <span class="variable">max</span> = <span class="variable">parseInt</span>(<span class="variable">mincols</span> / <span class="variable">charpixel</span>);
         <span class="keyword">var</span> <span class="variable">formattedText</span> = <span class="class">ScriblWrapLines</span>(<span class="variable">max</span>, <span class="variable">text</span>);
         <span class="variable">length</span> = <span class="variable">mincols</span> + <span class="number integer">10</span>;
         <span class="variable">height</span> = <span class="variable">formattedText</span>[<span class="number integer">1</span>]*<span class="variable">fontSize</span> + <span class="number integer">10</span>;
         <span class="variable">textlines</span> = <span class="variable">formattedText</span>[<span class="number integer">0</span>];
      }
      
      <span class="comment">// check if tooltip will run off screen</span>
      <span class="keyword">if</span> (<span class="variable">length</span> + <span class="variable">x</span> &gt; <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">width</span>)
         <span class="variable">x</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">width</span> - <span class="variable">length</span>;
      
      <span class="comment">// draw light style</span>
      <span class="keyword">if</span> ( <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">tooltips</span>.<span class="variable">style</span> == &quot;<span class="variable">light</span>&quot; ) {
         <span class="variable">fillStyle</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">ctx</span>.<span class="variable">createLinearGradient</span>(<span class="variable">x</span> + <span class="regexp">/2, y, x + length/</span><span class="number integer">2</span>, <span class="variable">y</span> + <span class="variable">height</span>);  
         <span class="variable">fillStyle</span>.<span class="variable">addColorStop</span>(<span class="number integer">0</span>,<span class="string">'rgb(253, 248, 196)'</span>);
         <span class="variable">fillStyle</span>.<span class="variable">addColorStop</span>(.<span class="number integer">75</span>,<span class="string">'rgb(253, 248, 196)'</span>);  
         <span class="variable">fillStyle</span>.<span class="variable">addColorStop</span>(<span class="number integer">1</span>,<span class="string">'white'</span>);
         
         <span class="variable">strokeStyle</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">ctx</span>.<span class="variable">createLinearGradient</span>(<span class="variable">x</span> + <span class="regexp">/2, y, x + length/</span><span class="number integer">2</span>, <span class="variable">y</span> + <span class="variable">height</span>);  
         <span class="variable">strokeStyle</span>.<span class="variable">addColorStop</span>(<span class="number integer">0</span>,<span class="string">'black'</span>);  
         <span class="variable">strokeStyle</span>.<span class="variable">addColorStop</span>(<span class="number integer">1</span>,<span class="string">'rgb(64, 64, 64)'</span>);
         
         <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">tooltips</span>.<span class="variable">text</span>.<span class="variable">color</span> = &quot;<span class="variable">black</span>&quot;;
      
      <span class="comment">// draw dark style	</span>
      } <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">tooltips</span>.<span class="variable">style</span> == &quot;<span class="variable">dark</span>&quot; ) {		
         <span class="variable">fillStyle</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">ctx</span>.<span class="variable">createLinearGradient</span>(<span class="variable">x</span> + <span class="regexp">/2, y, x + length/</span><span class="number integer">2</span>, <span class="variable">y</span> + <span class="variable">height</span>);  
         <span class="variable">fillStyle</span>.<span class="variable">addColorStop</span>(<span class="number integer">0</span>,<span class="string">'rgb(64, 64, 64)'</span>);
         <span class="variable">fillStyle</span>.<span class="variable">addColorStop</span>(<span class="number integer">1</span>,<span class="string">'rgb(121, 121, 121)'</span>);  
         	
         <span class="variable">strokeStyle</span> = &quot;<span class="variable">white</span>&quot;;
         <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">tooltips</span>.<span class="variable">text</span>.<span class="variable">color</span> = &quot;<span class="variable">white</span>&quot;;
      }
		
		<span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">lastToolTips</span>.<span class="variable">push</span>( { 
		   <span class="string">'pixels'</span> : <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">getImageData</span>(<span class="variable">x</span>-<span class="number integer">1</span>, <span class="variable">y</span>-<span class="number integer">1</span>, <span class="variable">length</span>+<span class="number integer">2</span>, <span class="variable">height</span>+<span class="number integer">2</span>),
		   <span class="string">'x'</span> : <span class="variable">x</span>-<span class="number integer">1</span>,
		   <span class="string">'y'</span> : <span class="variable">y</span>-<span class="number integer">1</span>
		});
		
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">fillStyle</span>;
      
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">beginPath</span>();
      
      <span class="comment">// calculate points</span>
      
      <span class="comment">// top left corner</span>
      <span class="variable">tlc_ctrl_x</span> = <span class="variable">x</span>; 				<span class="comment">// control point</span>
      <span class="variable">tlc_ctrl_y</span> = <span class="variable">y</span>;
      <span class="variable">tlc_lgth_x</span> = <span class="variable">x</span> + <span class="variable">roundness</span>; 	<span class="comment">// horizontal point</span>
      <span class="variable">tlc_lgth_y</span> = <span class="variable">y</span>;
      <span class="variable">tlc_wdth_x</span> = <span class="variable">x</span>;				<span class="comment">// vertical point</span>
      <span class="variable">tlc_wdth_y</span> = <span class="variable">y</span> + <span class="variable">roundness</span>;
      
      <span class="comment">// bottom left corner</span>
      <span class="variable">blc_ctrl_x</span> = <span class="variable">x</span>; 				<span class="comment">// control point</span>
      <span class="variable">blc_ctrl_y</span> = <span class="variable">y</span> + <span class="variable">height</span>;
      <span class="variable">blc_lgth_x</span> = <span class="variable">x</span> + <span class="variable">roundness</span>; 	<span class="comment">// horizontal point</span>
      <span class="variable">blc_lgth_y</span> = <span class="variable">y</span> + <span class="variable">height</span>;
      <span class="variable">blc_wdth_x</span> = <span class="variable">x</span>;				<span class="comment">// vertical point</span>
      <span class="variable">blc_wdth_y</span> = <span class="variable">y</span> + <span class="variable">height</span> - <span class="variable">roundness</span>;
      
      <span class="comment">// bottom right corner</span>
      <span class="variable">brc_ctrl_x</span> = <span class="variable">x</span> + <span class="variable">length</span>; 				<span class="comment">// control point</span>
      <span class="variable">brc_ctrl_y</span> = <span class="variable">y</span> + <span class="variable">height</span>;
      <span class="variable">brc_lgth_x</span> = <span class="variable">x</span> + <span class="variable">length</span> - <span class="variable">roundness</span>; 	<span class="comment">// horizontal point</span>
      <span class="variable">brc_lgth_y</span> = <span class="variable">y</span> + <span class="variable">height</span>;
      <span class="variable">brc_wdth_x</span> = <span class="variable">x</span> + <span class="variable">length</span>;				<span class="comment">// vertical point</span>
      <span class="variable">brc_wdth_y</span> = <span class="variable">y</span> + <span class="variable">height</span> - <span class="variable">roundness</span>;
      
      <span class="comment">// top right corner</span>
      <span class="variable">trc_ctrl_x</span> = <span class="variable">x</span> + <span class="variable">length</span>; 				<span class="comment">// control point</span>
      <span class="variable">trc_ctrl_y</span> = <span class="variable">y</span>;
      <span class="variable">trc_lgth_x</span> = <span class="variable">x</span> + <span class="variable">length</span> - <span class="variable">roundness</span>; 	<span class="comment">// horizontal point</span>
      <span class="variable">trc_lgth_y</span> = <span class="variable">y</span>;
      <span class="variable">trc_wdth_x</span> = <span class="variable">x</span> + <span class="variable">length</span>;				<span class="comment">// vertical point</span>
      <span class="variable">trc_wdth_y</span> = <span class="variable">y</span> + <span class="variable">roundness</span>;


      <span class="comment">// draw lines</span>
   
      <span class="comment">// top left corner</span>
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">moveTo</span>(<span class="variable">tlc_lgth_x</span>, <span class="variable">tlc_lgth_y</span>);       
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">tlc_ctrl_x</span>, <span class="variable">tlc_ctrl_y</span>, <span class="variable">tlc_wdth_x</span>, <span class="variable">tlc_wdth_y</span>);
      
      <span class="comment">// bottom left corner</span>
      	<span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">blc_wdth_x</span>, <span class="variable">blc_wdth_y</span>);
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">blc_ctrl_x</span>, <span class="variable">blc_ctrl_y</span>, <span class="variable">blc_lgth_x</span>, <span class="variable">blc_lgth_y</span>);
      
      <span class="comment">// bottom right corner</span>
      	<span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">brc_lgth_x</span>, <span class="variable">brc_lgth_y</span>);
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">brc_ctrl_x</span>, <span class="variable">brc_ctrl_y</span>, <span class="variable">brc_wdth_x</span>, <span class="variable">brc_wdth_y</span>);
      
      <span class="comment">// top right corner</span>
      	<span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">trc_wdth_x</span>, <span class="variable">trc_wdth_y</span>);
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">trc_ctrl_x</span>, <span class="variable">trc_ctrl_y</span>, <span class="variable">trc_lgth_x</span>, <span class="variable">trc_lgth_y</span>);
      
      <span class="comment">// top line</span>
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">tlc_lgth_x</span>, <span class="variable">tlc_lgth_y</span>);
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">fill</span>();
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">lineWidth</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">tooltips</span>.<span class="variable">borderWidth</span>;
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">strokeStyle</span> = <span class="variable">strokeStyle</span>;
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">stroke</span>();
      
      <span class="comment">// draw text;</span>
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">textBaseline</span> = &quot;<span class="variable">middle</span>&quot;;
      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="this">this</span>.<span class="variable">chart</span>.<span class="variable">tooltips</span>.<span class="variable">text</span>.<span class="variable">color</span>;
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">textlines</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
         <span class="keyword">var</span> <span class="variable">dim</span> = <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">measureText</span>(<span class="variable">textlines</span>[<span class="variable">i</span>]);
         <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">fillText</span>(<span class="variable">textlines</span>[<span class="variable">i</span>], <span class="variable">x</span> + <span class="number integer">5</span>  , <span class="variable">y</span> + <span class="variable">fontSize</span>*(<span class="variable">i</span>+<span class="number integer">1</span>));
      }

      <span class="this">this</span>.<span class="variable">ctx</span>.<span class="variable">restore</span>();
		
   }
});</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="Scribl.svg.js"><a href="#">Scribl.svg</a></h2></td><td>Scribl.svg.js</td></tr><tr class="code">
<td class="docs">
<p>utility functions for converting canvas to svg
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">CanvasToSVG</span> = {
	<span class="variable">idCounter</span>: <span class="number integer">0</span>,
	<span class="variable">convert</span>: <span class="keyword">function</span>(<span class="variable">sourceCanvas</span>, <span class="variable">targetSVG</span>, <span class="variable">x</span>, <span class="variable">y</span>) {
		<span class="keyword">var</span> <span class="variable">svgNS</span> = &quot;<span class="variable">http</span>:<span class="comment">//www.w3.org/2000/svg&quot;;</span>
		<span class="keyword">var</span> <span class="variable">xlinkNS</span> = &quot;<span class="variable">http</span>:<span class="comment">//www.w3.org/1999/xlink&quot;;</span>

		<span class="comment">// get base64 encoded png from Canvas</span>
		<span class="keyword">var</span> <span class="variable">image</span> = <span class="variable">sourceCanvas</span>.<span class="variable">toDataURL</span>();

		<span class="comment">// must be careful with the namespaces</span>
		<span class="keyword">var</span> <span class="variable">svgimg</span> = <span class="variable">document</span>.<span class="variable">createElementNS</span>(<span class="variable">svgNS</span>, &quot;<span class="variable">image</span>&quot;);

		<span class="variable">svgimg</span>.<span class="variable">setAttribute</span>(<span class="string">'id'</span>, <span class="string">'importedCanvas_'</span> + <span class="this">this</span>.<span class="variable">idCounter</span>++);
		<span class="variable">svgimg</span>.<span class="variable">setAttributeNS</span>(<span class="variable">xlinkNS</span>, <span class="string">'xlink:href'</span>, <span class="variable">image</span>);

		<span class="variable">svgimg</span>.<span class="variable">setAttribute</span>(<span class="string">'x'</span>, <span class="variable">x</span> ? <span class="variable">x</span> : <span class="number integer">0</span>);
		<span class="variable">svgimg</span>.<span class="variable">setAttribute</span>(<span class="string">'y'</span>, <span class="variable">y</span> ? <span class="variable">y</span> : <span class="number integer">0</span>);
		<span class="variable">svgimg</span>.<span class="variable">setAttribute</span>(<span class="string">'width'</span>, <span class="variable">sourceCanvas</span>.<span class="variable">width</span>);
		<span class="variable">svgimg</span>.<span class="variable">setAttribute</span>(<span class="string">'height'</span>, <span class="variable">sourceCanvas</span>.<span class="variable">height</span>);
	
		<span class="comment">// pixel data needs to be saved because of firefox data:// url bug:</span>
		<span class="comment">// http://markmail.org/message/o2kd3bnnv3vcbwb2</span>
		<span class="variable">svgimg</span>.<span class="variable">imageData</span> = <span class="variable">sourceCanvas</span>.<span class="variable">toDataURL</span>();
	
		<span class="variable">targetSVG</span>.<span class="variable">appendChild</span>(<span class="variable">svgimg</span>);
	}
}


<span class="keyword">var</span> <span class="variable">toXml</span> = <span class="keyword">function</span>(<span class="variable">str</span>) {
	<span class="keyword">return</span> $(<span class="string">'&lt;p/&gt;'</span>).<span class="variable">text</span>(<span class="variable">str</span>).<span class="variable">html</span>();
};

<span class="comment">// Function: svgCanvasToString</span>
<span class="comment">// Main function to set up the SVG content for output </span>
<span class="comment">//</span>
<span class="comment">// Returns: </span>
<span class="comment">// String containing the SVG image for output</span>

<span class="keyword">var</span> <span class="variable">svgToString</span> = <span class="keyword">function</span>(<span class="variable">svgcontent</span>) {
	<span class="comment">// keep calling it until there are none to remove</span>
	<span class="keyword">while</span> (<span class="variable">removeUnusedDefElems</span>() &gt; <span class="number integer">0</span>) {};
	
	<span class="variable">pathActions</span>.<span class="variable">clear</span>(<span class="variable">true</span>);
	
	<span class="comment">// Keep SVG-Edit comment on top</span>
	$.<span class="variable">each</span>(<span class="variable">svgcontent</span>.<span class="variable">childNodes</span>, <span class="keyword">function</span>(<span class="variable">i</span>, <span class="variable">node</span>) {
		<span class="keyword">if</span>(<span class="variable">i</span> &amp;&amp; <span class="variable">node</span>.<span class="variable">nodeType</span> == <span class="number integer">8</span> &amp;&amp; <span class="variable">node</span>.<span class="variable">data</span>.<span class="variable">indexOf</span>(<span class="string">'Created with'</span>) &gt;= <span class="number integer">0</span>) {
			<span class="variable">svgcontent</span>.<span class="variable">insertBefore</span>(<span class="variable">node</span>, <span class="variable">svgcontent</span>.<span class="variable">firstChild</span>);
		}
	});
	
	<span class="comment">// Move out of in-group editing mode</span>
	<span class="keyword">if</span>(<span class="variable">current_group</span>) {
		<span class="variable">leaveContext</span>();
		<span class="variable">selectOnly</span>([<span class="variable">current_group</span>]);
	}
	
	<span class="keyword">var</span> <span class="variable">naked_svgs</span> = [];
	
	<span class="comment">// Unwrap gsvg if it has no special attributes (only id and style)</span>
	$(<span class="variable">svgcontent</span>).<span class="variable">find</span>(<span class="string">'g:data(gsvg)'</span>).<span class="variable">each</span>(<span class="keyword">function</span>() {
		<span class="keyword">var</span> <span class="variable">attrs</span> = <span class="this">this</span>.<span class="variable">attributes</span>;
		<span class="keyword">var</span> <span class="variable">len</span> = <span class="variable">attrs</span>.<span class="variable">length</span>;
		<span class="keyword">for</span>(<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span>&lt;<span class="variable">len</span>; <span class="variable">i</span>++) {
			<span class="keyword">if</span>(<span class="variable">attrs</span>[<span class="variable">i</span>].<span class="variable">nodeName</span> == <span class="string">'id'</span> || <span class="variable">attrs</span>[<span class="variable">i</span>].<span class="variable">nodeName</span> == <span class="string">'style'</span>) {
				<span class="variable">len</span>--;
			}
		}
		<span class="comment">// No significant attributes, so ungroup</span>
		<span class="keyword">if</span>(<span class="variable">len</span> &lt;= <span class="number integer">0</span>) {
			<span class="keyword">var</span> <span class="variable">svg</span> = <span class="this">this</span>.<span class="variable">firstChild</span>;
			<span class="variable">naked_svgs</span>.<span class="variable">push</span>(<span class="variable">svg</span>);
			$(<span class="this">this</span>).<span class="variable">replaceWith</span>(<span class="variable">svg</span>);
		}
	});
	
	<span class="keyword">var</span> <span class="variable">output</span> = <span class="variable">svgToString</span>(<span class="variable">svgcontent</span>, <span class="number integer">0</span>);
	
	<span class="comment">// Rewrap gsvg</span>
	<span class="keyword">if</span>(<span class="variable">naked_svgs</span>.<span class="variable">length</span>) {
		$(<span class="variable">naked_svgs</span>).<span class="variable">each</span>(<span class="keyword">function</span>() {
			<span class="variable">groupSvgElem</span>(<span class="this">this</span>);
		});
	}
	
	<span class="keyword">return</span> <span class="variable">output</span>;
}

<span class="comment">// Function: svgToString</span>
<span class="comment">// Sub function ran on each SVG element to convert it to a string as desired</span>
<span class="comment">// </span>
<span class="comment">// Parameters: </span>
<span class="comment">// elem - The SVG element to convert</span>
<span class="comment">// indent - Integer with the amount of spaces to indent this tag</span>
<span class="comment">//</span>
<span class="comment">// Returns: </span>
<span class="comment">// String with the given element as an SVG tag</span>
<span class="keyword">var</span> <span class="variable">svgToString</span> = <span class="keyword">function</span>(<span class="variable">elem</span>, <span class="variable">indent</span>) {
	<span class="keyword">var</span> <span class="variable">out</span> = <span class="keyword">new</span> <span class="class">Array</span>();<span class="comment">//, toXml;// = Utils.toXml;</span>

	<span class="keyword">if</span> (<span class="variable">elem</span>) {
		<span class="comment">//cleanupElement(elem);</span>
		<span class="keyword">var</span> <span class="variable">attrs</span> = <span class="variable">elem</span>.<span class="variable">attributes</span>,
			<span class="variable">attr</span>,
			<span class="variable">i</span>,
			<span class="variable">childs</span> = <span class="variable">elem</span>.<span class="variable">childNodes</span>;
		
		<span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span>&lt;<span class="variable">indent</span>; <span class="variable">i</span>++) <span class="variable">out</span>.<span class="variable">push</span>(&quot; &quot;);
		<span class="variable">out</span>.<span class="variable">push</span>(&quot;&lt;&quot;); <span class="variable">out</span>.<span class="variable">push</span>(<span class="variable">elem</span>.<span class="variable">nodeName</span>);			
		<span class="keyword">if</span>(<span class="variable">elem</span>.<span class="variable">id</span> == <span class="string">'svgcontent'</span>) {
			<span class="comment">// Process root element separately</span>
			<span class="keyword">var</span> <span class="variable">res</span> = <span class="variable">getResolution</span>();
			<span class="variable">out</span>.<span class="variable">push</span>(<span class="string">' width=&quot;'</span> + <span class="variable">res</span>.<span class="variable">w</span> + <span class="string">'&quot; height=&quot;'</span> + <span class="variable">res</span>.<span class="variable">h</span> + <span class="string">'&quot; xmlns=&quot;'</span>+<span class="variable">svgns</span>+<span class="string">'&quot;'</span>);
			
			<span class="keyword">var</span> <span class="variable">nsuris</span> = {};
			
			<span class="comment">// Check elements for namespaces, add if found</span>
			$(<span class="variable">elem</span>).<span class="variable">find</span>(<span class="string">'*'</span>).<span class="variable">andSelf</span>().<span class="variable">each</span>(<span class="keyword">function</span>() {
				<span class="keyword">var</span> <span class="variable">el</span> = <span class="this">this</span>;
				$.<span class="variable">each</span>(<span class="this">this</span>.<span class="variable">attributes</span>, <span class="keyword">function</span>(<span class="variable">i</span>, <span class="variable">attr</span>) {
					<span class="keyword">var</span> <span class="variable">uri</span> = <span class="variable">attr</span>.<span class="variable">namespaceURI</span>;
					<span class="keyword">if</span>(<span class="variable">uri</span> &amp;&amp; !<span class="variable">nsuris</span>[<span class="variable">uri</span>] &amp;&amp; <span class="variable">nsMap</span>[<span class="variable">uri</span>] !== <span class="string">'xmlns'</span> &amp;&amp; <span class="variable">nsMap</span>[<span class="variable">uri</span>] !== <span class="string">'xml'</span> ) {
						<span class="variable">nsuris</span>[<span class="variable">uri</span>] = <span class="variable">true</span>;
						<span class="variable">out</span>.<span class="variable">push</span>(&quot; <span class="variable">xmlns</span>:&quot; + <span class="variable">nsMap</span>[<span class="variable">uri</span>] + <span class="string">'=&quot;'</span> + <span class="variable">uri</span> +<span class="string">'&quot;'</span>);
					}
				});
			});
			
			<span class="keyword">var</span> <span class="variable">i</span> = <span class="variable">attrs</span>.<span class="variable">length</span>;
			<span class="keyword">while</span> (<span class="variable">i</span>--) {
				<span class="variable">attr</span> = <span class="variable">attrs</span>.<span class="variable">item</span>(<span class="variable">i</span>);
				<span class="keyword">var</span> <span class="variable">attrVal</span> = <span class="variable">toXml</span>(<span class="variable">attr</span>.<span class="variable">nodeValue</span>);
				
				<span class="comment">// Namespaces have already been dealt with, so skip</span>
				<span class="keyword">if</span>(<span class="variable">attr</span>.<span class="variable">nodeName</span>.<span class="variable">indexOf</span>(<span class="string">'xmlns:'</span>) === <span class="number integer">0</span>) <span class="keyword">continue</span>;

				<span class="comment">// only serialize attributes we don't use internally</span>
				<span class="keyword">if</span> (<span class="variable">attrVal</span> != &quot;&quot; &amp;&amp; 
					[<span class="string">'width'</span>,<span class="string">'height'</span>,<span class="string">'xmlns'</span>,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'viewBox'</span>,<span class="string">'id'</span>,<span class="string">'overflow'</span>].<span class="variable">indexOf</span>(<span class="variable">attr</span>.<span class="variable">localName</span>) == -<span class="number integer">1</span>) 
				{

					<span class="keyword">if</span>(!<span class="variable">attr</span>.<span class="variable">namespaceURI</span> || <span class="variable">nsMap</span>[<span class="variable">attr</span>.<span class="variable">namespaceURI</span>]) {
						<span class="variable">out</span>.<span class="variable">push</span>(<span class="string">' '</span>); 
						<span class="variable">out</span>.<span class="variable">push</span>(<span class="variable">attr</span>.<span class="variable">nodeName</span>); <span class="variable">out</span>.<span class="variable">push</span>(&quot;=\&quot;&quot;);
						<span class="variable">out</span>.<span class="variable">push</span>(<span class="variable">attrVal</span>); <span class="variable">out</span>.<span class="variable">push</span>(&quot;\&quot;&quot;);
					}
				}
			}
		} <span class="keyword">else</span> {
			<span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="variable">attrs</span>.<span class="variable">length</span>-<span class="number integer">1</span>; <span class="variable">i</span>&gt;=<span class="number integer">0</span>; <span class="variable">i</span>--) {
				<span class="variable">attr</span> = <span class="variable">attrs</span>.<span class="variable">item</span>(<span class="variable">i</span>);
				<span class="keyword">var</span> <span class="variable">attrVal</span> = <span class="variable">toXml</span>(<span class="variable">attr</span>.<span class="variable">nodeValue</span>);
				<span class="comment">//remove bogus attributes added by Gecko</span>
				<span class="keyword">if</span> ([<span class="string">'-moz-math-font-style'</span>, <span class="string">'_moz-math-font-style'</span>].<span class="variable">indexOf</span>(<span class="variable">attr</span>.<span class="variable">localName</span>) &gt;= <span class="number integer">0</span>) <span class="keyword">continue</span>;
				<span class="keyword">if</span> (<span class="variable">attrVal</span> != &quot;&quot;) {
					<span class="keyword">if</span>(<span class="variable">attrVal</span>.<span class="variable">indexOf</span>(<span class="string">'pointer-events'</span>) === <span class="number integer">0</span>) <span class="keyword">continue</span>;
					<span class="keyword">if</span>(<span class="variable">attr</span>.<span class="variable">localName</span> === &quot;<span class="keyword">class</span>&quot; &amp;&amp; <span class="variable">attrVal</span>.<span class="variable">indexOf</span>(<span class="string">'se_'</span>) === <span class="number integer">0</span>) <span class="keyword">continue</span>;
					<span class="variable">out</span>.<span class="variable">push</span>(&quot; &quot;); 
					<span class="keyword">if</span>(<span class="variable">attr</span>.<span class="variable">localName</span> === <span class="string">'d'</span>) <span class="variable">attrVal</span> = <span class="variable">pathActions</span>.<span class="variable">convertPath</span>(<span class="variable">elem</span>, <span class="variable">true</span>);
					<span class="comment">//if(!isNaN(attrVal)) {</span>
					<span class="comment">//	attrVal = shortFloat(attrVal);</span>
					<span class="comment">//}</span>
					
					<span class="comment">// Embed images when saving </span>
               <span class="comment">// if(save_options.apply</span>
               <span class="comment">//    &amp;&amp; elem.nodeName === 'image' </span>
               <span class="comment">//    &amp;&amp; attr.localName === 'href'</span>
               <span class="comment">//    &amp;&amp; save_options.images</span>
               <span class="comment">//    &amp;&amp; save_options.images === 'embed') </span>
               <span class="comment">// {</span>
               <span class="comment">//    var img = encodableImages[attrVal];</span>
               <span class="comment">//    if(img) attrVal = img;</span>
               <span class="comment">// }</span>
					
					<span class="comment">// map various namespaces to our fixed namespace prefixes</span>
					<span class="comment">// (the default xmlns attribute itself does not get a prefix)</span>
				<span class="comment">//	if(!attr.namespaceURI || attr.namespaceURI == svgns || nsMap[attr.namespaceURI]) {</span>
						<span class="variable">out</span>.<span class="variable">push</span>(<span class="variable">attr</span>.<span class="variable">nodeName</span>); <span class="variable">out</span>.<span class="variable">push</span>(&quot;=\&quot;&quot;);
						<span class="variable">out</span>.<span class="variable">push</span>(<span class="variable">attrVal</span>); <span class="variable">out</span>.<span class="variable">push</span>(&quot;\&quot;&quot;);
				<span class="comment">//	}</span>
				}
			}
		}

		<span class="keyword">if</span> (<span class="variable">elem</span>.<span class="variable">hasChildNodes</span>()) {
			<span class="variable">out</span>.<span class="variable">push</span>(&quot;&gt;&quot;);
			<span class="variable">indent</span>++;
			<span class="keyword">var</span> <span class="variable">bOneLine</span> = <span class="variable">false</span>;
			
			<span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span>&lt;<span class="variable">childs</span>.<span class="variable">length</span>; <span class="variable">i</span>++)
			{
				<span class="keyword">var</span> <span class="variable">child</span> = <span class="variable">childs</span>.<span class="variable">item</span>(<span class="variable">i</span>);
				<span class="keyword">switch</span>(<span class="variable">child</span>.<span class="variable">nodeType</span>) {
				<span class="keyword">case</span> <span class="number integer">1</span>: <span class="comment">// element node</span>
					<span class="variable">out</span>.<span class="variable">push</span>(&quot;\<span class="variable">n</span>&quot;);
					<span class="variable">out</span>.<span class="variable">push</span>(<span class="variable">svgToString</span>(<span class="variable">childs</span>.<span class="variable">item</span>(<span class="variable">i</span>), <span class="variable">indent</span>));
					<span class="keyword">break</span>;
				<span class="keyword">case</span> <span class="number integer">3</span>: <span class="comment">// text node</span>
					<span class="keyword">var</span> <span class="variable">str</span> = <span class="variable">child</span>.<span class="variable">nodeValue</span>.<span class="variable">replace</span>(<span class="regexp">/^\s+|\s+$/g</span>, &quot;&quot;);
					<span class="keyword">if</span> (<span class="variable">str</span> != &quot;&quot;) {
						<span class="variable">bOneLine</span> = <span class="variable">true</span>;
						<span class="variable">out</span>.<span class="variable">push</span>(<span class="variable">toXml</span>(<span class="variable">str</span>) + &quot;&quot;);
					}
					<span class="keyword">break</span>;
				<span class="keyword">case</span> <span class="number integer">8</span>: <span class="comment">// comment</span>
					<span class="variable">out</span>.<span class="variable">push</span>(&quot;\<span class="variable">n</span>&quot;);
					<span class="variable">out</span>.<span class="variable">push</span>(<span class="keyword">new</span> <span class="class">Array</span>(<span class="variable">indent</span>+<span class="number integer">1</span>).<span class="variable">join</span>(&quot; &quot;));
					<span class="variable">out</span>.<span class="variable">push</span>(&quot;&lt;!--&quot;);
					<span class="variable">out</span>.<span class="variable">push</span>(<span class="variable">child</span>.<span class="variable">data</span>);
					<span class="variable">out</span>.<span class="variable">push</span>(&quot;--&gt;&quot;);
					<span class="keyword">break</span>;
				} <span class="comment">// switch on node type</span>
			}
			<span class="variable">indent</span>--;
			<span class="keyword">if</span> (!<span class="variable">bOneLine</span>) {
				<span class="variable">out</span>.<span class="variable">push</span>(&quot;\<span class="variable">n</span>&quot;);
				<span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span>&lt;<span class="variable">indent</span>; <span class="variable">i</span>++) <span class="variable">out</span>.<span class="variable">push</span>(&quot; &quot;);
			}
			<span class="variable">out</span>.<span class="variable">push</span>(&quot;&lt;/&quot;); <span class="variable">out</span>.<span class="variable">push</span>(<span class="variable">elem</span>.<span class="variable">nodeName</span>); <span class="variable">out</span>.<span class="variable">push</span>(&quot;&gt;&quot;);
		} <span class="keyword">else</span> {
			<span class="variable">out</span>.<span class="variable">push</span>(&quot;/&gt;&quot;);
		}
	}
	<span class="keyword">return</span> <span class="variable">out</span>.<span class="variable">join</span>(<span class="string">''</span>);
}; <span class="comment">// end svgToString()</span>


</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="glyph/Scribl.arrow.js"><a href="#">Scribl.arrow</a></h2></td><td>glyph/Scribl.arrow.js</td></tr><tr class="code">
<td class="docs">
<p><strong>Scribl::Glyph::Arrow</strong></p>

<p><em>Glyph used to draw any arrow shape</em></p>

<p>Chase Miller 2011
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Arrow</span> = <span class="class">Glyph</span>.<span class="variable">extend</span>({</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>init</strong></p>

<p><em>Constructor, call this with <code>new Arrow()</code></em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  type - a tag to associate this glyph with</p></li><li><p><strong>param</strong>: <em>Int</em>  position - start position of the glyph</p></li><li><p><strong>param</strong>: <em>Int</em>  length - length of the glyph</p></li><li><p><strong>param</strong>: <em>String</em>  strand - &#39;+&#39; or &#39;-&#39; strand</p></li><li><p><strong>param</strong>: <em>Hash</em>  [opts] - optional hash of attributes that can be applied to glyph</p></li><li><p><strong>api</strong>: <em>public</em></p><p>   </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">init</span>: <span class="keyword">function</span>(<span class="variable">type</span>, <span class="variable">position</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) {
         <span class="comment">// call base class glyph init method to initialize glyph</span>
         <span class="this">this</span>.<span class="variable">_super</span>(<span class="variable">type</span>, <span class="variable">position</span>, <span class="number integer">0</span>, <span class="variable">strand</span>, <span class="variable">opts</span>);
         
         <span class="comment">// set defaults</span>
         <span class="this">this</span>.<span class="variable">slope</span> = <span class="number integer">1</span>;
         <span class="this">this</span>.<span class="variable">glyphType</span> = &quot;<span class="class">Arrow</span>&quot;;
         <span class="this">this</span>.<span class="variable">thickness</span> = <span class="number float">4.6</span>
		},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>getPixelThickness</strong></p>

<p><em>gets pixel thickness</em></p>

<h2></h2>

<ul><li><p><strong>preturn</strong>: <em>Int</em>  pixelThickness</p></li><li><p><strong>api</strong>: <em>internal</em></p><p>   </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">getPixelThickness</span>: <span class="keyword">function</span>() {
         <span class="keyword">var</span> <span class="variable">arrow</span> = <span class="this">this</span>;
         <span class="keyword">var</span> <span class="variable">height</span> = <span class="variable">arrow</span>.<span class="variable">getHeight</span>();
         <span class="keyword">var</span> <span class="variable">arrowLength</span> = <span class="regexp">/2 /</span> <span class="class">Math</span>.<span class="variable">tan</span>(<span class="class">Math</span>.<span class="variable">atan</span>(<span class="variable">arrow</span>.<span class="variable">slope</span>))
         <span class="keyword">return</span> ( <span class="variable">arrow</span>.<span class="variable">thickness</span> / <span class="number integer">10</span> * <span class="variable">arrowLength</span> );
		},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>erase</strong></p>

<p><em>erase this glyph/feature</em></p>

<ul><li><p><strong>api</strong>: <em>public</em></p><p>   </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">erase</span>: <span class="keyword">function</span>() {
         <span class="keyword">var</span> <span class="variable">arrow</span> = <span class="this">this</span>;
         <span class="keyword">var</span> <span class="variable">thickness</span> =  <span class="variable">arrow</span>.<span class="variable">getPixelThickness</span>();
         <span class="variable">arrow</span>.<span class="variable">ctx</span>.<span class="variable">clearRect</span>( -<span class="variable">thickness</span>,<span class="number integer">0</span>, <span class="variable">thickness</span>, <span class="variable">arrow</span>.<span class="variable">getHeight</span>() );
		},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>_draw</strong></p>

<p><em>private arrow specific draw method that gets called by this.</em>super.draw()_</p>

<ul><li><strong>para</strong>: <em>m</em>
[context] - optional canvas.context </li><li><strong>para</strong>: <em>m</em>
[length] - optional length of glyph/feature</li><li><strong>para</strong>: <em>m</em>
[height] - optional height of lane</li><li><strong>para</strong>: <em>m</em>
[roundness] - optional roundness of glyph/feature      </li><li><p><strong>api</strong>: <em>internal</em></p><p>   </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">_draw</span> : <span class="keyword">function</span>(<span class="variable">ctx</span>, <span class="variable">length</span>, <span class="variable">height</span>, <span class="variable">roundness</span>) {

         <span class="comment">// Initialize</span>
         <span class="keyword">var</span> <span class="variable">arrow</span> = <span class="this">this</span>;
         
         <span class="comment">// see if optional parameters are set and get chart specific info</span>
         <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">ctx</span> || <span class="variable">arrow</span>.<span class="variable">ctx</span>;
         <span class="keyword">var</span> <span class="variable">height</span> = <span class="variable">height</span> || <span class="variable">arrow</span>.<span class="variable">getHeight</span>();
         <span class="keyword">var</span> <span class="variable">roundness</span> = <span class="variable">roundness</span> + <span class="number integer">1</span> || <span class="variable">arrow</span>.<span class="variable">calcRoundness</span>();
         <span class="keyword">if</span> (<span class="variable">roundness</span> != <span class="variable">undefined</span>) <span class="variable">roundness</span> -= <span class="number integer">1</span>;
         <span class="keyword">var</span> <span class="variable">thickness</span> =  <span class="variable">arrow</span>.<span class="variable">getPixelThickness</span>();
         <span class="keyword">var</span> <span class="variable">arrowLength</span> = <span class="number integer">0</span>;
         
         <span class="comment">// set start x and y draw locations to 0</span>
         <span class="variable">x</span> = <span class="variable">y</span> = <span class="number integer">0</span>;			
         
         <span class="comment">// arrow x and control coords</span>
         <span class="variable">a_b_x</span> = <span class="variable">x</span> - <span class="variable">arrowLength</span> - <span class="variable">roundness</span>;  <span class="comment">// bottom x coord					</span>
         <span class="variable">a_t_x</span> = <span class="variable">x</span> - <span class="variable">arrowLength</span> - <span class="variable">roundness</span>; <span class="comment">// top point x coord</span>
         <span class="variable">a_max_x</span> = <span class="variable">x</span>  - <span class="variable">arrowLength</span>;  <span class="comment">// the furthest point of the arrow</span>
         
         <span class="comment">// use bezier quadratic equation to calculate control point x coord</span>
         <span class="variable">t</span> = .<span class="number integer">5</span>  <span class="comment">// solve for end of arrow</span>
         <span class="variable">a_ctrl_x</span> = ( <span class="variable">a_max_x</span> - (<span class="number integer">1</span>-<span class="variable">t</span>)*(<span class="number integer">1</span>-<span class="variable">t</span>)*<span class="variable">a_b_x</span> - <span class="variable">t</span>*<span class="variable">t</span>*<span class="variable">a_t_x</span> ) / ( <span class="number integer">2</span>*(<span class="number integer">1</span>-<span class="variable">t</span>)*<span class="variable">t</span> )
         <span class="variable">a_ctrl_y</span> = <span class="variable">y</span> + <span class="variable">height</span>/<span class="number integer">2</span>;
         
         <span class="comment">// arrow slope and intercept</span>
         <span class="variable">bs_slope</span> = <span class="variable">arrow</span>.<span class="variable">slope</span>;
         <span class="variable">bs_intercept</span> = (-<span class="variable">a_ctrl_y</span>) - <span class="variable">bs_slope</span> * <span class="variable">a_ctrl_x</span>;
         <span class="variable">ts_slope</span> = -<span class="variable">arrow</span>.<span class="variable">slope</span>;
         <span class="variable">ts_intercept</span> = (-<span class="variable">a_ctrl_y</span>) - <span class="variable">ts_slope</span> * <span class="variable">a_ctrl_x</span>;
         
         <span class="comment">// arrow y coords</span>
         <span class="variable">a_b_y</span> = -(<span class="variable">bs_slope</span> * <span class="variable">a_b_x</span> + <span class="variable">bs_intercept</span>);
         <span class="variable">a_t_y</span> = -(<span class="variable">ts_slope</span> * <span class="variable">a_t_x</span> + <span class="variable">ts_intercept</span>);
         
         <span class="comment">// draw lines</span>
         <span class="variable">ctx</span>.<span class="variable">beginPath</span>();
         
         
         <span class="comment">// bottom slope</span>
         <span class="variable">bs_ctrl_y</span> = <span class="variable">y</span> + <span class="variable">height</span>;
         <span class="variable">bs_ctrl_x</span> = ( (-<span class="variable">bs_ctrl_y</span> - <span class="variable">bs_intercept</span>)<span class="regexp">/arrow.slope ); 	/</span>/ <span class="variable">control</span> <span class="variable">point</span>
         <span class="variable">bs_slpe_x</span> = <span class="variable">bs_ctrl_x</span> + <span class="variable">roundness</span> + <span class="variable">roundness</span>;		<span class="comment">// slope point</span>
         <span class="variable">bs_slpe_y</span> = -(<span class="variable">bs_slope</span> * <span class="variable">bs_slpe_x</span> + <span class="variable">bs_intercept</span>);
         
         <span class="variable">ctx</span>.<span class="variable">moveTo</span>(<span class="variable">bs_slpe_x</span>, <span class="variable">bs_slpe_y</span>);		
         
         <span class="comment">// bottom outer-line</span>
          <span class="variable">ctx</span>.<span class="variable">lineTo</span>( <span class="variable">a_b_x</span>, <span class="variable">a_b_y</span> );
         
         <span class="comment">// front part of arrow</span>
          <span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">a_ctrl_x</span>, <span class="variable">a_ctrl_y</span>, <span class="variable">a_t_x</span>, <span class="variable">a_t_y</span>);
         
         <span class="comment">// top outer-line</span>
         <span class="comment">// top slope					</span>
         <span class="variable">ts_ctrl_y</span> = <span class="variable">y</span>;
         <span class="variable">ts_ctrl_x</span> = (<span class="variable">ts_ctrl_y</span> + <span class="variable">ts_intercept</span>)<span class="regexp">/arrow.slope ; 	/</span>/ <span class="variable">control</span> <span class="variable">point</span>      
         <span class="variable">ts_slpe_x</span> = <span class="variable">ts_ctrl_x</span> + <span class="variable">roundness</span> + <span class="variable">roundness</span>;		<span class="comment">// slope point</span>
         <span class="variable">ts_slpe_y</span> = -(<span class="variable">ts_slope</span> * <span class="variable">ts_slpe_x</span> + <span class="variable">ts_intercept</span>);
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">ts_slpe_x</span>, <span class="variable">ts_slpe_y</span>);
         
         
         <span class="comment">// top u-turn</span>
         <span class="comment">// angle needed to get the x, y position of a point on the inner line perpendicular to a point on the outer line</span>
         <span class="keyword">var</span> <span class="variable">theta</span> = ( <span class="class">Math</span>.<span class="class">PI</span> - <span class="class">Math</span>.<span class="variable">abs</span>(<span class="class">Math</span>.<span class="variable">atan</span>(<span class="variable">arrow</span>.<span class="variable">slope</span>)) ) - <span class="class">Math</span>.<span class="class">PI</span>/<span class="number integer">2</span>;
         <span class="keyword">var</span> <span class="variable">dX</span> = <span class="class">Math</span>.<span class="variable">sin</span>(<span class="variable">theta</span>) * <span class="variable">thickness</span>;
         <span class="keyword">var</span> <span class="variable">dY</span> = <span class="class">Math</span>.<span class="variable">cos</span>(<span class="variable">theta</span>) * <span class="variable">thickness</span>;
         <span class="keyword">var</span> <span class="variable">arcTX</span> = <span class="variable">ts_slpe_x</span> - <span class="variable">dX</span>;
         <span class="keyword">var</span> <span class="variable">arcTY</span> = <span class="variable">ts_slpe_y</span> + <span class="variable">dY</span>;
         <span class="variable">ctx</span>.<span class="variable">bezierCurveTo</span>(<span class="variable">ts_ctrl_x</span>, <span class="variable">ts_ctrl_y</span>, <span class="variable">ts_ctrl_x</span>-<span class="variable">dX</span>, <span class="variable">ts_ctrl_y</span>+<span class="variable">dY</span>,  <span class="variable">arcTX</span>, <span class="variable">arcTY</span>);
         
         <span class="comment">// inner top-line</span>
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">a_max_x</span>-<span class="variable">thickness</span>, <span class="variable">y</span> + <span class="variable">height</span>/<span class="number integer">2</span>);
         
         
         <span class="comment">// inner bottom-line</span>
         <span class="keyword">var</span> <span class="variable">arcBX</span> = <span class="variable">bs_slpe_x</span> - <span class="variable">dX</span>;
         <span class="keyword">var</span> <span class="variable">arcBY</span> = <span class="variable">bs_slpe_y</span> - <span class="variable">dY</span>;
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">arcBX</span>, <span class="variable">arcBY</span>);
         
         <span class="comment">// bottom uturn</span>
         <span class="variable">ctx</span>.<span class="variable">bezierCurveTo</span>(<span class="variable">bs_ctrl_x</span>-<span class="variable">dX</span>, <span class="variable">bs_ctrl_y</span>-<span class="variable">dY</span>, <span class="variable">bs_ctrl_x</span>, <span class="variable">bs_ctrl_y</span>,  <span class="variable">bs_slpe_x</span>, <span class="variable">bs_slpe_y</span>);
         <span class="comment">// ctx.fill();	</span>
      }

   });


</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="glyph/Scribl.complex.js"><a href="#">Scribl.complex</a></h2></td><td>glyph/Scribl.complex.js</td></tr><tr class="code">
<td class="docs">
<p><strong>Scribl::Glyph::Complex</strong></p>

<p><em>Complex is used to draw any feature that has splices
(e.g gene with subFeatures and introns, etc) Or
any feature that should be made up of other features</em></p>

<p>Chase Miller 2011
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Complex</span> = <span class="class">Glyph</span>.<span class="variable">extend</span>({</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>init</strong></p>

<p><em>Constructor, call this with <code>new Complex()</code></em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  type - a tag to associate this glyph with</p></li><li><p><strong>param</strong>: <em>Int</em>  position - start position of the glyph</p></li><li><p><strong>param</strong>: <em>Int</em>  length - length of the glyph</p></li><li><p><strong>param</strong>: <em>Array</em>  subFeatures - array of derived Glyph objects (e.g Rect, Arrow, etc...)</p></li><li><p><strong>param</strong>: <em>Hash</em>  [opts] - optional hash of attributes that can be applied to glyph</p></li><li><p><strong>api</strong>: <em>public</em></p><pre><code> </code></pre></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">init</span>: <span class="keyword">function</span>(<span class="variable">type</span>, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">subFeatures</span>, <span class="variable">opts</span>) {
         <span class="comment">// call super init method to initialize glyph</span>
         <span class="this">this</span>.<span class="variable">_super</span>(<span class="variable">type</span>, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>);
         
         <span class="comment">// instantiate and set defaults</span>
         <span class="this">this</span>.<span class="variable">slope</span> = <span class="number integer">1</span>;
         <span class="this">this</span>.<span class="variable">glyphType</span> = &quot;<span class="class">Complex</span>&quot;;
         <span class="this">this</span>.<span class="variable">subFeatures</span> = <span class="variable">subFeatures</span>;
         			
         <span class="comment">// instantiate connector line and set default attributes</span>
         <span class="this">this</span>.<span class="variable">line</span> =  <span class="keyword">new</span> <span class="class">Line</span>(<span class="variable">type</span>, <span class="number integer">0</span>, <span class="variable">length</span>);
         <span class="this">this</span>.<span class="variable">line</span>.<span class="variable">parent</span> = <span class="this">this</span>;
         <span class="this">this</span>.<span class="variable">line</span>.<span class="variable">color</span> = &quot;<span class="variable">black</span>&quot;;
         <span class="this">this</span>.<span class="variable">line</span>.<span class="variable">thickness</span> = <span class="number integer">2</span>;			
      },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>addSubFeature</strong></p>

<p><em>adds subFeature to complex glyph/feature</em></p>

<ul><li><strong>param</strong>: <em>subFeature</em></li><li>a derived Glyph object (e.g. Rect, Arrow, etc..) </li><li><p><strong>api</strong>: <em>public</em></p><p>   </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addSubFeature</span> : <span class="keyword">function</span>(<span class="variable">subFeature</span>) {
         <span class="this">this</span>.<span class="variable">subFeatures</span>.<span class="variable">push</span>(<span class="variable">subFeature</span>);
      },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>_draw</strong></p>

<p><em>private complex specific draw method that gets called by this.</em>super.draw()_</p>

<ul><li><strong>para</strong>: <em>m</em>
[context] - optional canvas.context </li><li><strong>para</strong>: <em>m</em>
[length] - optional length of glyph/feature</li><li><strong>para</strong>: <em>m</em>
[height] - optional height of lane</li><li><strong>para</strong>: <em>m</em>
[roundness] - optional roundness of glyph/feature      </li><li><p><strong>api</strong>: <em>internal</em></p><p>   </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">_draw</span> : <span class="keyword">function</span>(<span class="variable">ctx</span>, <span class="variable">length</span>, <span class="variable">height</span>, <span class="variable">roundness</span>) {

         <span class="comment">// Initialize</span>
         <span class="keyword">var</span> <span class="variable">complex</span> = <span class="this">this</span>;
         
         
         <span class="comment">// see if optional parameters are set and get chart specific info</span>
         <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">ctx</span> || <span class="variable">complex</span>.<span class="variable">ctx</span>;
         <span class="keyword">var</span> <span class="variable">length</span> = <span class="variable">length</span> || <span class="variable">complex</span>.<span class="variable">getPixelLength</span>();
         <span class="keyword">var</span> <span class="variable">height</span> = <span class="variable">height</span> || <span class="variable">complex</span>.<span class="variable">getHeight</span>();
         <span class="keyword">var</span> <span class="variable">roundness</span> = <span class="variable">roundness</span> + <span class="number integer">1</span> || <span class="variable">complex</span>.<span class="variable">calcRoundness</span>();
         <span class="keyword">if</span> (<span class="variable">roundness</span> != <span class="variable">undefined</span>) <span class="variable">roundness</span> -= <span class="number integer">1</span>;
         
         <span class="comment">// set start x and y draw locations to 0</span>
         <span class="variable">x</span> = <span class="variable">y</span> = <span class="number integer">0</span>;
         
         <span class="comment">// translate back the length of the complex glyph</span>
         <span class="comment">// so sub glyphs will be placed correctly</span>
         <span class="variable">ctx</span>.<span class="variable">translate</span>(-<span class="variable">complex</span>.<span class="variable">getPixelPositionX</span>(), <span class="number integer">0</span>);
         
         <span class="comment">// draw connector line</span>
         <span class="variable">complex</span>.<span class="variable">line</span>.<span class="variable">lane</span> = <span class="this">this</span>.<span class="variable">lane</span>;						
         <span class="variable">complex</span>.<span class="variable">line</span>.<span class="variable">draw</span>();
         
         <span class="comment">// draw subFeatures</span>
         <span class="keyword">var</span> <span class="variable">numsubFeatures</span> = <span class="variable">complex</span>.<span class="variable">subFeatures</span>.<span class="variable">length</span>
         <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span>&lt; <span class="variable">numsubFeatures</span>; <span class="variable">i</span>++) {				
            <span class="comment">// set subFeature to same lane and draw</span>
            <span class="variable">complex</span>.<span class="variable">subFeatures</span>[<span class="variable">i</span>].<span class="variable">parent</span> = <span class="variable">complex</span>;
            <span class="variable">complex</span>.<span class="variable">subFeatures</span>[<span class="variable">i</span>].<span class="variable">lane</span> = <span class="variable">complex</span>.<span class="variable">lane</span>;
            <span class="variable">complex</span>.<span class="variable">subFeatures</span>[<span class="variable">i</span>].<span class="variable">draw</span>();
         }
			
         <span class="comment">// redo translate so the next glyphs will be placed correctly</span>
         <span class="variable">ctx</span>.<span class="variable">translate</span>(<span class="variable">complex</span>.<span class="variable">getPixelPositionX</span>(), <span class="number integer">0</span>);
         
         <span class="comment">// end path so it doesn't get redrawn when parent tries to draw</span>
         <span class="variable">ctx</span>.<span class="variable">beginPath</span>();					
      }
			 
   });
	

</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="glyph/Scribl.line.js"><a href="#">Scribl.line</a></h2></td><td>glyph/Scribl.line.js</td></tr><tr class="code">
<td class="docs">
<p><strong>Scribl::Glyph::Line</strong></p>

<p><em>Glyph used to draw any line shape</em></p>

<p>Chase Miller 2011
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Line</span> = <span class="class">Glyph</span>.<span class="variable">extend</span>({</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>init</strong></p>

<p><em>Constructor, call this with <code>new Line()</code></em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  type - a tag to associate this glyph with</p></li><li><p><strong>param</strong>: <em>Int</em>  position - start position of the glyph</p></li><li><p><strong>param</strong>: <em>Int</em>  length - length of the glyph</p></li><li><p><strong>param</strong>: <em>Hash</em>  [opts] - optional hash of attributes that can be applied to glyph</p></li><li><p><strong>api</strong>: <em>public</em></p><p>   </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">init</span>: <span class="keyword">function</span>(<span class="variable">type</span>, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">opts</span>) {
         <span class="this">this</span>.<span class="variable">thickness</span> = <span class="number integer">2</span>;
         <span class="this">this</span>.<span class="variable">_super</span>(<span class="variable">type</span>, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">undefined</span>, <span class="variable">opts</span>);
         <span class="this">this</span>.<span class="variable">glyphType</span> = &quot;<span class="class">Line</span>&quot;;
      },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>_draw</strong></p>

<p><em>private line specific draw method that gets called by this.</em>super.draw()_</p>

<ul><li><strong>para</strong>: <em>m</em>
[context] - optional canvas.context </li><li><strong>para</strong>: <em>m</em>
[length] - optional length of glyph/feature</li><li><strong>para</strong>: <em>m</em>
[height] - optional height of lane</li><li><strong>para</strong>: <em>m</em>
[roundness] - optional roundness of glyph/feature      </li><li><p><strong>api</strong>: <em>internal</em></p><p>   </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">_draw</span>: <span class="keyword">function</span>(<span class="variable">ctx</span>, <span class="variable">length</span>, <span class="variable">height</span>, <span class="variable">roundness</span>) {
			
          <span class="comment">// initialize</span>
          <span class="keyword">var</span> <span class="variable">line</span> = <span class="this">this</span>;
          
          <span class="comment">// see if optional parameters</span>
          <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">ctx</span> || <span class="variable">line</span>.<span class="variable">ctx</span>;
          <span class="keyword">var</span> <span class="variable">length</span> = <span class="variable">length</span> || <span class="variable">line</span>.<span class="variable">getPixelLength</span>();
          <span class="keyword">var</span> <span class="variable">height</span> = <span class="variable">height</span> || <span class="variable">line</span>.<span class="variable">getHeight</span>();
          
          <span class="comment">// Set starting draw position</span>
          <span class="variable">x</span> = <span class="variable">y</span> = <span class="number integer">0</span>;
          
          <span class="variable">ctx</span>.<span class="variable">beginPath</span>();
          <span class="variable">ctx</span>.<span class="variable">moveTo</span>(<span class="variable">x</span>, <span class="regexp">/2 - line.thickness/</span><span class="number integer">2</span>);
          <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">x</span>, <span class="regexp">/2 + line.thickness/</span><span class="number integer">2</span>);
          <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">x</span>+<span class="variable">length</span>, <span class="regexp">/2 + line.thickness/</span><span class="number integer">2</span>);
          <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">x</span>+<span class="variable">length</span>, <span class="regexp">/2 - line.thickness/</span><span class="number integer">2</span>);
<span class="comment">//			ctx.fill();			</span>
<span class="comment">//			ctx.fillRect(x, height/2 - line.thickness/2, length, line.thickness);</span>
	}
});</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="glyph/Scribl.rect.js"><a href="#">Scribl.rect</a></h2></td><td>glyph/Scribl.rect.js</td></tr><tr class="code">
<td class="docs">
<p><strong>Scribl::Glyph::Rect</strong></p>

<p><em>Glyph used to draw any rectangle shape</em></p>

<p>Chase Miller 2011
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Rect</span> = <span class="class">Glyph</span>.<span class="variable">extend</span>({</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>init</strong></p>

<p><em>Constructor, call this with <code>new Rect()</code></em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  type - a tag to associate this glyph with</p></li><li><p><strong>param</strong>: <em>Int</em>  position - start position of the glyph</p></li><li><p><strong>param</strong>: <em>Int</em>  length - length of the glyph</p></li><li><p><strong>param</strong>: <em>Hash</em>  [opts] - optional hash of attributes that can be applied to glyph</p></li><li><p><strong>api</strong>: <em>public</em></p><pre><code> </code></pre></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">init</span>: <span class="keyword">function</span>(<span class="variable">type</span>, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">opts</span>) {
         <span class="this">this</span>.<span class="variable">_super</span>(<span class="variable">type</span>, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">undefined</span>, <span class="variable">opts</span>);
         <span class="comment">//this._super(type, position, length, '+', opts);</span>
         <span class="this">this</span>.<span class="variable">glyphType</span> = &quot;<span class="class">Rect</span>&quot;;
      },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>_draw</strong></p>

<p><em>private rect specific draw method that gets called by this.</em>super.draw()_</p>

<ul><li><strong>para</strong>: <em>m</em>
[context] - optional canvas.context </li><li><strong>para</strong>: <em>m</em>
[length] - optional length of glyph/feature</li><li><strong>para</strong>: <em>m</em>
[height] - optional height of lane</li><li><strong>para</strong>: <em>m</em>
[roundness] - optional roundness of glyph/feature      </li><li><p><strong>api</strong>: <em>internal</em></p><p>   </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">_draw</span>: <span class="keyword">function</span>(<span class="variable">ctx</span>, <span class="variable">length</span>, <span class="variable">height</span>, <span class="variable">roundness</span>) {
			
         <span class="comment">// initialize</span>
         <span class="keyword">var</span> <span class="variable">rect</span> = <span class="this">this</span>;
         
         <span class="comment">// see if optional parameters are set</span>
         <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">ctx</span> || <span class="variable">rect</span>.<span class="variable">ctx</span>;
         <span class="keyword">var</span> <span class="variable">length</span> = <span class="variable">length</span> || <span class="variable">rect</span>.<span class="variable">getPixelLength</span>();
         <span class="keyword">var</span> <span class="variable">height</span> = <span class="variable">height</span> || <span class="variable">rect</span>.<span class="variable">getHeight</span>();
         <span class="keyword">var</span> <span class="variable">roundness</span> = <span class="variable">roundness</span> + <span class="number integer">1</span> || <span class="variable">rect</span>.<span class="variable">calcRoundness</span>();
         <span class="keyword">if</span> (<span class="variable">roundness</span> != <span class="variable">undefined</span>) <span class="variable">roundness</span> -= <span class="number integer">1</span>

         <span class="comment">// Set starting draw position</span>
         <span class="variable">x</span> = <span class="variable">y</span> = <span class="number integer">0</span>;
         

         <span class="variable">ctx</span>.<span class="variable">beginPath</span>();
         
         <span class="comment">// calculate points</span>
         
         <span class="comment">// top left corner</span>
         <span class="variable">tlc_ctrl_x</span> = <span class="variable">x</span>; 				<span class="comment">// control point</span>
         <span class="variable">tlc_ctrl_y</span> = <span class="variable">y</span>;
         <span class="variable">tlc_lgth_x</span> = <span class="variable">x</span> + <span class="variable">roundness</span>; 	<span class="comment">// horizontal point</span>
         <span class="variable">tlc_lgth_y</span> = <span class="variable">y</span>;
         <span class="variable">tlc_wdth_x</span> = <span class="variable">x</span>;				<span class="comment">// vertical point</span>
         <span class="variable">tlc_wdth_y</span> = <span class="variable">y</span> + <span class="variable">roundness</span>;
         
         <span class="comment">// bottom left corner</span>
         <span class="variable">blc_ctrl_x</span> = <span class="variable">x</span>; 				<span class="comment">// control point</span>
         <span class="variable">blc_ctrl_y</span> = <span class="variable">y</span> + <span class="variable">height</span>;
         <span class="variable">blc_lgth_x</span> = <span class="variable">x</span> + <span class="variable">roundness</span>; 	<span class="comment">// horizontal point</span>
         <span class="variable">blc_lgth_y</span> = <span class="variable">y</span> + <span class="variable">height</span>;
         <span class="variable">blc_wdth_x</span> = <span class="variable">x</span>;				<span class="comment">// vertical point</span>
         <span class="variable">blc_wdth_y</span> = <span class="variable">y</span> + <span class="variable">height</span> - <span class="variable">roundness</span>;
         
         <span class="comment">// bottom right corner</span>
         <span class="variable">brc_ctrl_x</span> = <span class="variable">x</span> + <span class="variable">length</span>; 				<span class="comment">// control point</span>
         <span class="variable">brc_ctrl_y</span> = <span class="variable">y</span> + <span class="variable">height</span>;
         <span class="variable">brc_lgth_x</span> = <span class="variable">x</span> + <span class="variable">length</span> - <span class="variable">roundness</span>; 	<span class="comment">// horizontal point</span>
         <span class="variable">brc_lgth_y</span> = <span class="variable">y</span> + <span class="variable">height</span>;
         <span class="variable">brc_wdth_x</span> = <span class="variable">x</span> + <span class="variable">length</span>;				<span class="comment">// vertical point</span>
         <span class="variable">brc_wdth_y</span> = <span class="variable">y</span> + <span class="variable">height</span> - <span class="variable">roundness</span>;
         
         <span class="comment">// top right corner</span>
         <span class="variable">trc_ctrl_x</span> = <span class="variable">x</span> + <span class="variable">length</span>; 				<span class="comment">// control point</span>
         <span class="variable">trc_ctrl_y</span> = <span class="variable">y</span>;
         <span class="variable">trc_lgth_x</span> = <span class="variable">x</span> + <span class="variable">length</span> - <span class="variable">roundness</span>; 	<span class="comment">// horizontal point</span>
         <span class="variable">trc_lgth_y</span> = <span class="variable">y</span>;
         <span class="variable">trc_wdth_x</span> = <span class="variable">x</span> + <span class="variable">length</span>;				<span class="comment">// vertical point</span>
         <span class="variable">trc_wdth_y</span> = <span class="variable">y</span> + <span class="variable">roundness</span>;
         
         <span class="comment">// draw lines</span>
         
         <span class="comment">// top left corner</span>
         <span class="variable">ctx</span>.<span class="variable">moveTo</span>(<span class="variable">tlc_lgth_x</span>, <span class="variable">tlc_lgth_y</span>); 
         <span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">tlc_ctrl_x</span>, <span class="variable">tlc_ctrl_y</span>, <span class="variable">tlc_wdth_x</span>, <span class="variable">tlc_wdth_y</span>);
         
         <span class="comment">// bottom left corner</span>
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">blc_wdth_x</span>, <span class="variable">blc_wdth_y</span>);
         <span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">blc_ctrl_x</span>, <span class="variable">blc_ctrl_y</span>, <span class="variable">blc_lgth_x</span>, <span class="variable">blc_lgth_y</span>);
         
         <span class="comment">// bottom right corner</span>
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">brc_lgth_x</span>, <span class="variable">brc_lgth_y</span>);
         <span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">brc_ctrl_x</span>, <span class="variable">brc_ctrl_y</span>, <span class="variable">brc_wdth_x</span>, <span class="variable">brc_wdth_y</span>);
         
         <span class="comment">// top right corner</span>
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">trc_wdth_x</span>, <span class="variable">trc_wdth_y</span>);
         <span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">trc_ctrl_x</span>, <span class="variable">trc_ctrl_y</span>, <span class="variable">trc_lgth_x</span>, <span class="variable">trc_lgth_y</span>);
         
         <span class="comment">// top line</span>
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">tlc_lgth_x</span>, <span class="variable">tlc_lgth_y</span>);
	}
});</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="parsers/genbank.js"><a href="#">genbank</a></h2></td><td>parsers/genbank.js</td></tr><tr class="code">
<td class="docs">
<p>Genbank parser
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">genbank</span>(<span class="variable">file</span>, <span class="variable">bchart</span>) {
	
	<span class="keyword">var</span> <span class="variable">lines</span> = <span class="variable">file</span>.<span class="variable">split</span>(&quot;\<span class="variable">n</span>&quot;);
	<span class="keyword">var</span> <span class="variable">re</span> = <span class="keyword">new</span> <span class="class">RegExp</span>(<span class="regexp">/\s+gene\s+([a-z]*)\(?(\d+)\.\.(\d+)/</span>);
	<span class="keyword">var</span> <span class="variable">genes</span> = [];
	<span class="keyword">var</span> <span class="variable">max</span> = <span class="variable">undefined</span>;
	<span class="keyword">var</span> <span class="variable">min</span> = <span class="variable">undefined</span>;
	
	<span class="comment">// parse genes</span>
	<span class="keyword">for</span>( <span class="keyword">var</span> <span class="variable">j</span>=<span class="number integer">0</span>; <span class="variable">j</span> &lt; <span class="variable">lines</span>.<span class="variable">length</span>; <span class="variable">j</span>++ ) {

		<span class="keyword">var</span> <span class="variable">gene_info</span>;
		<span class="keyword">if</span> (<span class="variable">gene_info</span> = <span class="variable">lines</span>[<span class="variable">j</span>].<span class="variable">match</span>(<span class="variable">re</span>)) {
			<span class="variable">gene_info</span>.<span class="variable">shift</span>();
			<span class="variable">genes</span>.<span class="variable">push</span>(<span class="variable">gene_info</span>);
			
			<span class="comment">// determine scale dimensions</span>
			<span class="keyword">var</span> <span class="variable">end</span> = <span class="variable">gene_info</span>[<span class="number integer">2</span>];
			<span class="keyword">if</span> (<span class="variable">max</span> == <span class="variable">undefined</span> || <span class="variable">max</span> &gt; <span class="variable">end</span>)
				<span class="variable">max</span> = <span class="variable">end</span>;
			<span class="keyword">var</span> <span class="variable">position</span> = <span class="variable">gene_info</span>[<span class="number integer">1</span>];
			<span class="keyword">if</span> (<span class="variable">min</span> == <span class="variable">undefined</span> || <span class="variable">min</span> &lt; <span class="variable">position</span>)
				<span class="variable">min</span> = <span class="variable">position</span>;
		}
	}


	<span class="comment">// set scale dimensions</span>
	<span class="variable">bchart</span>.<span class="variable">scale</span>.<span class="variable">max</span> = <span class="variable">max</span>;
	<span class="variable">bchart</span>.<span class="variable">scale</span>.<span class="variable">min</span> = <span class="variable">min</span>;

	<span class="comment">// add genes to chart</span>
	<span class="keyword">for</span>(<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">genes</span>.<span class="variable">length</span>; <span class="variable">i</span>++ ) {
		
		<span class="comment">// get positional values</span>
		<span class="keyword">var</span> <span class="variable">strand</span> = <span class="string">'+'</span>;
		<span class="keyword">if</span> ( <span class="variable">genes</span>[<span class="variable">i</span>][<span class="number integer">0</span>] == &quot;<span class="variable">complement</span>&quot; )
			<span class="variable">strand</span> = <span class="string">'-'</span>;
			
		<span class="keyword">var</span> <span class="variable">position</span> = <span class="variable">genes</span>[<span class="variable">i</span>][<span class="number integer">1</span>];
		<span class="keyword">var</span> <span class="variable">end</span> = <span class="variable">genes</span>[<span class="variable">i</span>][<span class="number integer">2</span>];
		<span class="variable">position</span> = <span class="variable">position</span> - <span class="number integer">1</span> + <span class="number integer">1</span>;  <span class="comment">// force to be integer - TODO make bChart catch non-ints automatically and gracefully fail</span>
		<span class="keyword">var</span> <span class="variable">length</span> = <span class="variable">end</span> - <span class="variable">position</span>;
		
		<span class="variable">bchart</span>.<span class="variable">addGene</span>(<span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>);

	}

}</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="glyph/Scribl.blockarrow.js"><a href="#">Scribl.blockarrow</a></h2></td><td>glyph/Scribl.blockarrow.js</td></tr><tr class="code">
<td class="docs">
<p><strong>Scribl::Glyph::BlockArrow</strong></p>

<p><em>Glyph used to draw any blockarrow shape</em></p>

<p>Chase Miller 2011
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">BlockArrow</span> = <span class="class">Glyph</span>.<span class="variable">extend</span>({</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>init</strong></p>

<p><em>Constructor, call this with <code>new BlockArrow()</code></em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  type - a tag to associate this glyph with</p></li><li><p><strong>param</strong>: <em>Int</em>  position - start position of the glyph</p></li><li><p><strong>param</strong>: <em>Int</em>  length - length of the glyph</p></li><li><p><strong>param</strong>: <em>String</em>  strand - &#39;+&#39; or &#39;-&#39; strand</p></li><li><p><strong>param</strong>: <em>Hash</em>  [opts] - optional hash of attributes that can be applied to glyph</p></li><li><p><strong>api</strong>: <em>public</em></p><p>   </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">init</span>: <span class="keyword">function</span>(<span class="variable">type</span>, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>) {
         <span class="comment">// call super init method to initialize glyph</span>
         <span class="this">this</span>.<span class="variable">_super</span>(<span class="variable">type</span>, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">strand</span>, <span class="variable">opts</span>);
         <span class="this">this</span>.<span class="variable">slope</span> = <span class="number integer">1</span>;
         <span class="this">this</span>.<span class="variable">glyphType</span> = &quot;<span class="class">BlockArrow</span>&quot;;
      },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>_draw</strong></p>

<p><em>private blockarrow specific draw method that gets called by this.</em>super.draw()_</p>

<ul><li><strong>para</strong>: <em>m</em>
[context] - optional canvas.context </li><li><strong>para</strong>: <em>m</em>
[length] - optional length of glyph/feature</li><li><strong>para</strong>: <em>m</em>
[height] - optional height of lane</li><li><strong>para</strong>: <em>m</em>
[roundness] - optional roundness of glyph/feature      </li><li><p><strong>api</strong>: <em>internal</em></p><p>   </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">_draw</span> : <span class="keyword">function</span>(<span class="variable">ctx</span>, <span class="variable">length</span>, <span class="variable">height</span>, <span class="variable">roundness</span>) {

         <span class="comment">// Initialize</span>
         <span class="keyword">var</span> <span class="variable">blockarrow</span> = <span class="this">this</span>;
         
         <span class="comment">// see if optional parameters are set and get chart specific info</span>
         <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">ctx</span> || <span class="variable">blockarrow</span>.<span class="variable">ctx</span>;
         <span class="keyword">var</span> <span class="variable">length</span> = <span class="variable">length</span> || <span class="variable">blockarrow</span>.<span class="variable">getPixelLength</span>();
         <span class="keyword">var</span> <span class="variable">height</span> = <span class="variable">height</span> || <span class="variable">blockarrow</span>.<span class="variable">getHeight</span>();
         <span class="keyword">var</span> <span class="variable">roundness</span> = <span class="variable">roundness</span> + <span class="number integer">1</span> || <span class="variable">blockarrow</span>.<span class="variable">calcRoundness</span>();         
         <span class="keyword">if</span> (<span class="variable">roundness</span> != <span class="variable">undefined</span>) <span class="variable">roundness</span> -= <span class="number integer">1</span>;

         <span class="keyword">var</span> <span class="variable">side</span> = <span class="variable">length</span>*.<span class="number integer">75</span>;
         
         
         <span class="comment">// set start x and y draw locations to 0</span>
         <span class="variable">x</span> = <span class="variable">y</span> = <span class="number integer">0</span>;
         
         <span class="comment">// calculate points</span>
         
         <span class="comment">// top corner</span>
         <span class="variable">tc_ctrl_x</span> = <span class="variable">x</span>; 				<span class="comment">// control point</span>
         <span class="variable">tc_ctrl_y</span> = <span class="variable">y</span>;
         <span class="variable">tc_lgth_x</span> = <span class="variable">x</span> + <span class="variable">roundness</span>; 	<span class="comment">// horizontal point</span>
         <span class="variable">tc_lgth_y</span> = <span class="variable">y</span>;
         <span class="variable">tc_wdth_x</span> = <span class="variable">x</span>;				<span class="comment">// vertical point</span>
         <span class="variable">tc_wdth_y</span> = <span class="variable">y</span> + <span class="variable">roundness</span>;
         
         <span class="comment">// bottom corner</span>
         <span class="variable">bc_ctrl_x</span> = <span class="variable">x</span>; 				<span class="comment">// control point</span>
         <span class="variable">bc_ctrl_y</span> = <span class="variable">y</span> + <span class="variable">height</span>;
         <span class="variable">bc_lgth_x</span> = <span class="variable">x</span> + <span class="variable">roundness</span>; 	<span class="comment">// horizontal point</span>
         <span class="variable">bc_lgth_y</span> = <span class="variable">y</span> + <span class="variable">height</span>;
         <span class="variable">bc_wdth_x</span> = <span class="variable">x</span>;				<span class="comment">// vertical point</span>
         <span class="variable">bc_wdth_y</span> = <span class="variable">y</span> + <span class="variable">height</span> - <span class="variable">roundness</span>;
         
         <span class="comment">// arrow x and control coords</span>
         <span class="variable">a_b_x</span> = <span class="variable">x</span> + <span class="variable">length</span> - <span class="variable">roundness</span>;  <span class="comment">// bottom x coord					</span>
         <span class="variable">a_t_x</span> = <span class="variable">x</span> + <span class="variable">length</span> - <span class="variable">roundness</span>; <span class="comment">// top point x coord</span>
         <span class="variable">a_max_x</span> = <span class="variable">x</span> + <span class="variable">length</span>;  <span class="comment">// the furthest point of the arrow</span>
         <span class="comment">// use bezier quadratic equation to calculate control point x coord</span>
         <span class="variable">t</span> = .<span class="number integer">5</span>  <span class="comment">// solve for end of arrow</span>
         <span class="variable">a_ctrl_x</span> = <span class="class">Math</span>.<span class="variable">round</span>( (( <span class="variable">a_max_x</span> - (<span class="number integer">1</span>-<span class="variable">t</span>)*(<span class="number integer">1</span>-<span class="variable">t</span>)*<span class="variable">a_b_x</span> - <span class="variable">t</span>*<span class="variable">t</span>*<span class="variable">a_t_x</span> ) <span class="regexp">/ ( 2*(1-t)*t ))*10 )/</span><span class="number integer">10</span>;
         <span class="variable">a_ctrl_y</span> = <span class="variable">y</span> + <span class="variable">height</span>/<span class="number integer">2</span>;
         
         <span class="comment">// arrow slope and intercept</span>
         <span class="variable">bs_slope</span> = <span class="variable">blockarrow</span>.<span class="variable">slope</span>;
         <span class="variable">bs_intercept</span> = (-<span class="variable">a_ctrl_y</span>) - <span class="variable">bs_slope</span> * <span class="variable">a_ctrl_x</span>;
         <span class="variable">ts_slope</span> = -<span class="variable">blockarrow</span>.<span class="variable">slope</span>;
         <span class="variable">ts_intercept</span> = (-<span class="variable">a_ctrl_y</span>) - <span class="variable">ts_slope</span> * <span class="variable">a_ctrl_x</span>;
         
         <span class="comment">// arrow y coords</span>
         <span class="variable">a_b_y</span> = -(<span class="class">Math</span>.<span class="variable">round</span>( (<span class="variable">bs_slope</span> * <span class="variable">a_b_x</span> + <span class="variable">bs_intercept</span>)*<span class="number integer">10</span> )/<span class="number integer">10</span>);
         <span class="variable">a_t_y</span> = -(<span class="class">Math</span>.<span class="variable">round</span>( (<span class="variable">ts_slope</span> * <span class="variable">a_t_x</span> + <span class="variable">ts_intercept</span>)*<span class="number integer">10</span> )/<span class="number integer">10</span>);
         
         
         <span class="comment">// bottom slope</span>
         <span class="variable">bs_ctrl_y</span> = <span class="variable">y</span> + <span class="variable">height</span>;
         <span class="variable">bs_ctrl_x</span> = ( (-<span class="variable">bs_ctrl_y</span> - <span class="variable">bs_intercept</span>)<span class="regexp">/blockarrow.slope ); 	/</span>/ <span class="variable">control</span> <span class="variable">point</span>
         <span class="keyword">if</span> (<span class="variable">bs_ctrl_x</span> &lt; <span class="variable">x</span> ) {
            <span class="keyword">var</span> <span class="variable">r</span> = <span class="keyword">new</span> <span class="class">Rect</span>(<span class="variable">blockarrow</span>.<span class="variable">type</span>, <span class="number integer">0</span>, <span class="variable">length</span>);
            <span class="variable">r</span>.<span class="variable">_draw</span>(<span class="variable">ctx</span>, <span class="variable">length</span>, <span class="variable">height</span>, <span class="variable">roundness</span>);
            <span class="keyword">return</span>;
         }
         
         <span class="variable">bs_lgth_y</span> = <span class="variable">y</span> + <span class="variable">height</span>; 	<span class="comment">// horizontal point</span>
         <span class="variable">bs_lgth_x</span> = <span class="variable">bs_ctrl_x</span> - <span class="variable">roundness</span>;											
         <span class="variable">bs_slpe_x</span> = <span class="variable">bs_ctrl_x</span> + <span class="variable">roundness</span>;		<span class="comment">// slope point</span>
         <span class="variable">bs_slpe_y</span> = -(<span class="class">Math</span>.<span class="variable">round</span>( (<span class="variable">bs_slope</span> * <span class="variable">bs_slpe_x</span> + <span class="variable">bs_intercept</span>)*<span class="number integer">10</span> )/<span class="number integer">10</span>);	
         
         <span class="comment">// top slope					</span>
         <span class="variable">ts_ctrl_y</span> = <span class="variable">y</span>;
         <span class="variable">ts_ctrl_x</span> = (<span class="variable">ts_ctrl_y</span> + <span class="variable">ts_intercept</span>)<span class="regexp">/blockarrow.slope ; 	/</span>/ <span class="variable">control</span> <span class="variable">point</span>      
         <span class="variable">ts_lgth_y</span> = <span class="variable">y</span>; 	<span class="comment">// horizontal point</span>
         <span class="variable">ts_lgth_x</span> = <span class="variable">ts_ctrl_x</span> - <span class="variable">roundness</span>;	
         <span class="variable">ts_slpe_x</span> = <span class="variable">ts_ctrl_x</span> + <span class="variable">roundness</span>;		<span class="comment">// slope point</span>
         <span class="variable">ts_slpe_y</span> = -(<span class="class">Math</span>.<span class="variable">round</span>( (<span class="variable">ts_slope</span> * <span class="variable">ts_slpe_x</span> + <span class="variable">ts_intercept</span>)*<span class="number integer">10</span> )/<span class="number integer">10</span>);
         
         
         <span class="comment">// draw lines</span>
         <span class="variable">ctx</span>.<span class="variable">beginPath</span>();
         
         <span class="comment">// top left corner</span>
         <span class="variable">ctx</span>.<span class="variable">moveTo</span>(<span class="variable">tc_lgth_x</span>, <span class="variable">tc_lgth_y</span>); 
         <span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">tc_ctrl_x</span>, <span class="variable">tc_ctrl_y</span>, <span class="variable">tc_wdth_x</span>, <span class="variable">tc_wdth_y</span>);
         
         <span class="comment">// bottom left corner</span>
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">bc_wdth_x</span>, <span class="variable">bc_wdth_y</span>);
         <span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">bc_ctrl_x</span>, <span class="variable">bc_ctrl_y</span>, <span class="variable">bc_lgth_x</span>, <span class="variable">bc_lgth_y</span>);
         
         <span class="comment">// bottom right slope</span>
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">bs_lgth_x</span>, <span class="variable">bs_lgth_y</span>);
         <span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">bs_ctrl_x</span>, <span class="variable">bs_ctrl_y</span>, <span class="variable">bs_slpe_x</span>, <span class="variable">bs_slpe_y</span>);
         
         <span class="comment">// arrow</span>
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>( <span class="variable">a_b_x</span>, <span class="variable">a_b_y</span> );
         <span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">a_ctrl_x</span>, <span class="variable">a_ctrl_y</span>, <span class="variable">a_t_x</span>, <span class="variable">a_t_y</span>);
         
         <span class="comment">// top right slope</span>
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">ts_slpe_x</span>, <span class="variable">ts_slpe_y</span>);
         <span class="variable">ctx</span>.<span class="variable">quadraticCurveTo</span>(<span class="variable">ts_ctrl_x</span>, <span class="variable">ts_ctrl_y</span>, <span class="variable">ts_lgth_x</span>, <span class="variable">ts_lgth_y</span>);
         
         <span class="comment">// top line</span>
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">tc_lgth_x</span>, <span class="variable">tc_lgth_y</span>);						
      }
				 
   });
		

</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="glyph/Scribl.seq.js"><a href="#">Scribl.seq</a></h2></td><td>glyph/Scribl.seq.js</td></tr><tr class="code">
<td class="docs">
<p><strong>Scribl::Glyph::Seq</strong></p>

<p><em>Glyph used to letters e.g nucleotides or proteins</em></p>

<p>Chase Miller 2011
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Seq</span> = <span class="class">Glyph</span>.<span class="variable">extend</span>({</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>init</strong></p>

<p><em>Constructor, call this with <code>new seq()</code></em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  type - a tag to associate this glyph with</p></li><li><p><strong>param</strong>: <em>Int</em>  position - start position of the glyph</p></li><li><p><strong>param</strong>: <em>Int</em>  length - length of the glyph</p></li><li><p><strong>param</strong>: <em>Hash</em>  [opts] - optional hash of attributes that can be applied to glyph</p></li><li><p><strong>api</strong>: <em>public</em></p><p>   </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">init</span>: <span class="keyword">function</span>(<span class="variable">type</span>, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">seq</span>, <span class="variable">opts</span>) {
		   <span class="this">this</span>.<span class="variable">seq</span> = <span class="variable">seq</span>;         
		   <span class="this">this</span>.<span class="variable">insertions</span> = [];
		   <span class="comment">// used to show bar chart like information; range 0.0 - 1.0</span>
		   <span class="this">this</span>.<span class="variable">fraction</span> = <span class="number integer">1</span>;
		   <span class="this">this</span>.<span class="variable">fractionLevel</span> = <span class="number float">0.3</span>; <span class="comment">// level where seq shows as fraction (in pixels)           </span>
         <span class="this">this</span>.<span class="variable">glyphType</span> = &quot;<span class="class">Seq</span>&quot;;    
         
         <span class="this">this</span>.<span class="variable">font</span> = &quot;<span class="variable">px</span> <span class="variable">courier</span>&quot;;
         <span class="this">this</span>.<span class="variable">chars</span> = {};
         <span class="this">this</span>.<span class="variable">chars</span>.<span class="variable">width</span> = <span class="variable">undefined</span>;
         <span class="this">this</span>.<span class="variable">chars</span>.<span class="variable">height</span> = <span class="variable">undefined</span>;
         <span class="this">this</span>.<span class="variable">chars</span>.<span class="variable">list</span> = [<span class="string">'A'</span>, <span class="string">'G'</span>, <span class="string">'T'</span>, <span class="string">'C'</span>, <span class="string">'N'</span>, <span class="string">'-'</span>];
         
         <span class="this">this</span>.<span class="variable">_super</span>(<span class="variable">type</span>, <span class="variable">position</span>, <span class="variable">length</span>, <span class="variable">undefined</span>, <span class="variable">opts</span>);
      },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>_draw</strong></p>

<p><em>private letter specific draw method that gets called by this.</em>super.draw()_</p>

<ul><li><strong>para</strong>: <em>m</em>
[context] - optional canvas.context </li><li><strong>para</strong>: <em>m</em>
[length] - optional length of glyph/feature</li><li><strong>para</strong>: <em>m</em>
[height] - optional height of lane</li><li><p><strong>api</strong>: <em>internal</em></p><p>   </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">_draw</span>: <span class="keyword">function</span>(<span class="variable">ctx</span>, <span class="variable">length</span>, <span class="variable">height</span>) {
			
          <span class="comment">// initialize</span>
          <span class="keyword">var</span> <span class="variable">seq</span> = <span class="this">this</span>;
          <span class="keyword">var</span> <span class="variable">fraction</span> = <span class="number integer">1</span>;
          
          <span class="keyword">if</span> (<span class="variable">seq</span>.<span class="variable">lane</span>.<span class="variable">chart</span>.<span class="variable">ntsToPixels</span>() &lt;= <span class="variable">seq</span>.<span class="variable">fractionLevel</span>)
            <span class="variable">fraction</span> = <span class="this">this</span>.<span class="variable">fraction</span>
          
          <span class="comment">// see if optional parameters</span>
          <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">ctx</span> || <span class="variable">seq</span>.<span class="variable">ctx</span>;
          <span class="keyword">var</span> <span class="variable">length</span> = <span class="variable">length</span> || <span class="variable">seq</span>.<span class="variable">getPixelLength</span>();
          <span class="keyword">var</span> <span class="variable">height</span> = <span class="variable">height</span> || <span class="variable">seq</span>.<span class="variable">getHeight</span>();
          
          <span class="comment">// get coords</span>
          <span class="keyword">var</span> <span class="variable">left</span> = <span class="variable">seq</span>.<span class="variable">getPixelPositionX</span>();
          <span class="keyword">var</span> <span class="variable">top</span> = <span class="variable">seq</span>.<span class="variable">getPixelPositionY</span>();          
          
          <span class="comment">// check if nts images have been built</span>
          <span class="keyword">var</span> <span class="variable">chars</span> = <span class="class">SCRIBL</span>.<span class="variable">chars</span>;

          <span class="comment">// check if image chars need to be built for this height</span>
          <span class="keyword">if</span> ( !<span class="variable">chars</span>.<span class="variable">heights</span>[<span class="variable">height</span>] ) {
             <span class="comment">// build nt images</span>
             <span class="variable">chars</span>.<span class="variable">heights</span>[<span class="variable">height</span>] = [];
             <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="this">this</span>.<span class="variable">chars</span>.<span class="variable">list</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
                <span class="keyword">var</span> <span class="variable">nt</span> = <span class="this">this</span>.<span class="variable">chars</span>.<span class="variable">list</span>[<span class="variable">i</span>];
                <span class="keyword">var</span> <span class="variable">ntName</span> = <span class="variable">nt</span>;
                <span class="keyword">if</span> (<span class="variable">nt</span> == <span class="string">'-'</span>) { <span class="variable">ntName</span> = <span class="string">'dash'</span>; }
                <span class="keyword">var</span> <span class="variable">charName</span> = &quot;<span class="variable">nt_</span>&quot; + <span class="variable">ntName</span> + <span class="string">'_bg'</span>;                
                <span class="this">this</span>.<span class="variable">createChar</span>(<span class="variable">nt</span>, <span class="variable">chars</span>.<span class="variable">nt_color</span>, <span class="variable">chars</span>[<span class="variable">charName</span>], <span class="variable">height</span>);
             }
          }           
          
          <span class="comment">// Set starting draw position</span>
          <span class="variable">x</span> = <span class="variable">y</span> = <span class="number integer">0</span>;      
          
          
          <span class="keyword">if</span> (<span class="variable">seq</span>.<span class="variable">imgCanvas</span>) {
             <span class="variable">ctx</span>.<span class="variable">drawImage</span>(<span class="variable">seq</span>.<span class="variable">imgCanvas</span>, <span class="variable">left</span>, <span class="variable">top</span> - <span class="variable">height</span>*<span class="variable">fraction</span>, <span class="variable">length</span>, <span class="variable">height</span>*<span class="variable">fraction</span>);
          } <span class="keyword">else</span> {
             <span class="variable">ctx</span>.<span class="variable">save</span>();
             <span class="variable">ctx</span>.<span class="variable">beginPath</span>();
             <span class="variable">ctx</span>.<span class="variable">textBaseline</span> = &quot;<span class="variable">middle</span>&quot;;
             <span class="keyword">var</span> <span class="variable">origFont</span> = <span class="variable">ctx</span>.<span class="variable">font</span>;
             <span class="keyword">var</span> <span class="variable">size</span> = <span class="regexp">/[\d+px]/</span>.<span class="variable">exec</span>(<span class="variable">origFont</span>) + <span class="string">'px'</span>;
             <span class="variable">ctx</span>.<span class="variable">font</span> = <span class="variable">size</span> + &quot; <span class="variable">courier</span>&quot;;
             <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="string">'black'</span>;
             <span class="variable">ctx</span>.<span class="variable">textAlign</span> = <span class="string">'left'</span>;
             <span class="keyword">var</span> <span class="variable">seqPx</span> = <span class="this">this</span>.<span class="variable">seq</span>.<span class="variable">length</span> * <span class="variable">chars</span>.<span class="variable">heights</span>[<span class="variable">height</span>].<span class="variable">width</span>;
             
             <span class="comment">// draw text;</span>
             <span class="variable">seq</span>.<span class="variable">imgCanvas</span> = <span class="variable">document</span>.<span class="variable">createElement</span>(<span class="string">'canvas'</span>);
             <span class="variable">seq</span>.<span class="variable">imgCanvas</span>.<span class="variable">width</span> = <span class="variable">seqPx</span>;
             <span class="variable">seq</span>.<span class="variable">imgCanvas</span>.<span class="variable">height</span> = <span class="variable">height</span>;
             <span class="keyword">var</span> <span class="variable">tmpCtx</span> = <span class="variable">seq</span>.<span class="variable">imgCanvas</span>.<span class="variable">getContext</span>(<span class="string">'2d'</span>);

             <span class="keyword">var</span> <span class="variable">pos</span> = <span class="number integer">0</span>;
             <span class="keyword">var</span> <span class="variable">k</span> = <span class="number integer">0</span>;
             <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span>=<span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="this">this</span>.<span class="variable">seq</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
                <span class="keyword">if</span> (!<span class="variable">chars</span>.<span class="variable">heights</span>[<span class="variable">height</span>][ <span class="this">this</span>.<span class="variable">seq</span>[<span class="variable">i</span>] ]) {
                   <span class="this">this</span>.<span class="variable">createChar</span>(<span class="this">this</span>.<span class="variable">seq</span>[<span class="variable">i</span>], <span class="string">'black'</span>, <span class="string">'white'</span>, <span class="variable">height</span>);
                }
                <span class="keyword">var</span> <span class="variable">charGlyph</span> = <span class="this">this</span>.<span class="variable">seq</span>[<span class="variable">i</span>];
                <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">insertions</span>.<span class="variable">length</span> &gt; <span class="number integer">1</span>) {
                   <span class="keyword">var</span> <span class="variable">h</span> = <span class="number integer">2</span>;
                }
                <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">insertions</span>[<span class="variable">k</span>] &amp;&amp; <span class="this">this</span>.<span class="variable">insertions</span>[<span class="variable">k</span>][<span class="string">'pos'</span>] != <span class="variable">undefined</span>) {
                  <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">insertions</span>[<span class="variable">k</span>][<span class="string">'pos'</span>] -<span class="number integer">1</span> == <span class="variable">i</span> ){
                     <span class="variable">charGlyph</span> += <span class="string">'rightInsert'</span>;
                  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">insertions</span>[<span class="variable">k</span>] &amp;&amp; <span class="this">this</span>.<span class="variable">insertions</span>[<span class="variable">k</span>][<span class="string">'pos'</span>] == <span class="variable">i</span>){
                     <span class="variable">charGlyph</span> += <span class="string">'leftInsert'</span>;
                     <span class="variable">k</span>++;
                  }
                }                
                  
                <span class="variable">tmpCtx</span>.<span class="variable">drawImage</span>(<span class="variable">chars</span>.<span class="variable">heights</span>[<span class="variable">height</span>][ <span class="variable">charGlyph</span> ],<span class="variable">pos</span>,<span class="variable">y</span>);
                <span class="variable">pos</span> += <span class="variable">chars</span>.<span class="variable">heights</span>[<span class="variable">height</span>].<span class="variable">width</span>;
             }

             <span class="variable">ctx</span>.<span class="variable">drawImage</span>(<span class="variable">seq</span>.<span class="variable">imgCanvas</span>, <span class="variable">x</span>, <span class="variable">height</span> - <span class="variable">height</span>*<span class="variable">fraction</span>, <span class="variable">length</span>, <span class="variable">height</span>*<span class="variable">fraction</span>);
             <span class="comment">//ctx.drawImage(seq.imgCanvas, x, y, length, height);</span>
             <span class="variable">ctx</span>.<span class="variable">font</span> = <span class="variable">origFont</span>;

             <span class="variable">ctx</span>.<span class="variable">restore</span>();                       
         }   
         
         <span class="comment">// this is horrible</span>
         <span class="comment">// have to draw an outline around the nucleotides</span>
         <span class="comment">// so that the mousehover will work b\c mousehover</span>
         <span class="comment">// only works with drawn Paths and not drawn Images :(            </span>
         <span class="variable">ctx</span>.<span class="variable">beginPath</span>();
         <span class="variable">ctx</span>.<span class="variable">moveTo</span>(<span class="number integer">0</span>,<span class="number integer">0</span>);
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">length</span>, <span class="variable">y</span>);
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">length</span>, <span class="variable">y</span> + <span class="variable">height</span>);
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">x</span>, <span class="variable">y</span>+<span class="variable">height</span>);
         <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">x</span>, <span class="variable">y</span>);
         <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="string">'rgba(0,0,0,0)'</span>;
         <span class="keyword">if</span> (<span class="variable">seq</span>.<span class="variable">lane</span>.<span class="variable">chart</span>.<span class="variable">ntsToPixels</span>() &lt;= <span class="variable">seq</span>.<span class="variable">fractionLevel</span>)
            <span class="variable">ctx</span>.<span class="variable">strokeStyle</span> = <span class="string">'rgba(0,0,0,1)'</span>;
         <span class="keyword">else</span>
            <span class="variable">ctx</span>.<span class="variable">strokeStyle</span> = <span class="string">'rgba(0,0,0,0)'</span>;
         
         <span class="variable">ctx</span>.<span class="variable">stroke</span>();             
         <span class="variable">ctx</span>.<span class="variable">closePath</span>();
	},</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><strong>_createChar</strong></p>

<p><em>creates glyphs of a given character</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Char</em>  - the char to create glyph of</p></li><li><p><strong>param</strong>: <em>String</em>  - string of char color in rgb or hex</p></li><li><p><strong>param</strong>: <em>String</em>  - string of char background color in rgb or hex</p></li><li><p><strong>param</strong>: <em>Int</em>  - height of glyph</p></li><li><p><strong>api</strong>: <em>internal</em></p><p></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">createChar</span>: <span class="keyword">function</span>(<span class="variable">theChar</span>, <span class="variable">color</span>, <span class="variable">backgroundColor</span>, <span class="variable">height</span>) {                  
      <span class="keyword">var</span> <span class="variable">seq</span> = <span class="this">this</span>;
      <span class="keyword">var</span> <span class="variable">chart</span> = <span class="variable">seq</span>.<span class="variable">lane</span>.<span class="variable">track</span>.<span class="variable">chart</span>;
      <span class="keyword">var</span> <span class="variable">canvas</span> = <span class="variable">document</span>.<span class="variable">createElement</span>(<span class="string">'canvas'</span>);
      <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">canvas</span>.<span class="variable">getContext</span>(<span class="string">'2d'</span>);
      <span class="keyword">var</span> <span class="variable">buffer</span> = <span class="number integer">2</span>;
      <span class="keyword">var</span> <span class="variable">fontsize</span> = <span class="variable">height</span> - <span class="variable">buffer</span>;
      <span class="variable">ctx</span>.<span class="variable">font</span> = <span class="variable">fontsize</span> + <span class="string">'px courier'</span>;
      <span class="keyword">var</span> <span class="variable">width</span> = <span class="variable">ctx</span>.<span class="variable">measureText</span>(<span class="variable">theChar</span>).<span class="variable">width</span> + <span class="variable">buffer</span>;
      <span class="variable">canvas</span>.<span class="variable">height</span> = <span class="variable">height</span>;
      <span class="variable">canvas</span>.<span class="variable">width</span> = <span class="variable">width</span>;
      <span class="class">SCRIBL</span>.<span class="variable">chars</span>.<span class="variable">heights</span>[<span class="variable">height</span>].<span class="variable">width</span> = <span class="variable">width</span>;
      
      <span class="comment">// draw standard nt</span>
      <span class="keyword">var</span> <span class="variable">canvas</span> = <span class="variable">document</span>.<span class="variable">createElement</span>(<span class="string">'canvas'</span>);
      <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">canvas</span>.<span class="variable">getContext</span>(<span class="string">'2d'</span>);
      <span class="variable">ctx</span>.<span class="variable">font</span> = <span class="variable">fontsize</span> + <span class="string">'px courier'</span>;
      <span class="variable">canvas</span>.<span class="variable">height</span> = <span class="variable">height</span>;
      <span class="variable">canvas</span>.<span class="variable">width</span> = <span class="variable">width</span>;
      <span class="keyword">var</span> <span class="variable">fillStyle</span> = <span class="variable">ctx</span>.<span class="variable">fillStyle</span>;
      <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">backgroundColor</span>;
      <span class="variable">ctx</span>.<span class="variable">fillRect</span>(<span class="number integer">0</span>,<span class="number integer">0</span>, <span class="variable">width</span>, <span class="variable">height</span>);
      <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">color</span>;
      <span class="variable">ctx</span>.<span class="variable">textAlign</span> = <span class="string">'center'</span>;
      <span class="variable">ctx</span>.<span class="variable">textBaseline</span> = &quot;<span class="variable">middle</span>&quot;;
      <span class="variable">ctx</span>.<span class="variable">fillText</span>(<span class="variable">theChar</span>, <span class="regexp">/2, height/</span><span class="number integer">2</span>);
      <span class="comment">// store canvas with glyph in global variable</span>
      <span class="class">SCRIBL</span>.<span class="variable">chars</span>.<span class="variable">heights</span>[<span class="variable">height</span>][<span class="variable">theChar</span>] = <span class="variable">canvas</span>;
      <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">fillStyle</span>;
      
      <span class="comment">// draw nt with insert to the right</span>
      <span class="keyword">var</span> <span class="variable">canvas</span> = <span class="variable">document</span>.<span class="variable">createElement</span>(<span class="string">'canvas'</span>);
      <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">canvas</span>.<span class="variable">getContext</span>(<span class="string">'2d'</span>);
      <span class="variable">ctx</span>.<span class="variable">font</span> = <span class="variable">fontsize</span> + <span class="string">'px courier'</span>;
      <span class="variable">canvas</span>.<span class="variable">height</span> = <span class="variable">height</span>;
      <span class="variable">canvas</span>.<span class="variable">width</span> = <span class="variable">width</span>;
      <span class="keyword">var</span> <span class="variable">fillStyle</span> = <span class="variable">ctx</span>.<span class="variable">fillStyle</span>;
      <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">backgroundColor</span>;      
      <span class="variable">ctx</span>.<span class="variable">fillRect</span>(<span class="number integer">0</span>,<span class="number integer">0</span>, <span class="variable">width</span>, <span class="variable">height</span>);
      <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="string">'yellow'</span>;
      <span class="variable">ctx</span>.<span class="variable">beginPath</span>();
      <span class="variable">ctx</span>.<span class="variable">moveTo</span>(<span class="number integer">0</span>,<span class="variable">height</span>);
      <span class="variable">ctx</span>.<span class="variable">arcTo</span>(<span class="variable">width</span>,<span class="variable">height</span>, <span class="variable">width</span>,<span class="number integer">0</span>, <span class="variable">height</span>/<span class="number integer">2</span>);
      <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">width</span>,<span class="variable">height</span>);
      <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="number integer">0</span>, <span class="variable">height</span>)
      <span class="variable">ctx</span>.<span class="variable">closePath</span>();
      <span class="variable">ctx</span>.<span class="variable">fill</span>();
      <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">color</span>;
      <span class="variable">ctx</span>.<span class="variable">textAlign</span> = <span class="string">'center'</span>;
      <span class="variable">ctx</span>.<span class="variable">textBaseline</span> = &quot;<span class="variable">middle</span>&quot;;
      <span class="variable">ctx</span>.<span class="variable">fillText</span>(<span class="variable">theChar</span>, <span class="regexp">/2, height/</span><span class="number integer">2</span>);
      <span class="comment">// store canvas with glyph in global variable</span>
      <span class="class">SCRIBL</span>.<span class="variable">chars</span>.<span class="variable">heights</span>[<span class="variable">height</span>][<span class="variable">theChar</span> + <span class="string">'rightInsert'</span>] = <span class="variable">canvas</span>;
      <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">fillStyle</span>;
      
      <span class="comment">// draw nt with insertion to the left</span>
      <span class="keyword">var</span> <span class="variable">canvas</span> = <span class="variable">document</span>.<span class="variable">createElement</span>(<span class="string">'canvas'</span>);
      <span class="keyword">var</span> <span class="variable">ctx</span> = <span class="variable">canvas</span>.<span class="variable">getContext</span>(<span class="string">'2d'</span>);
      <span class="variable">ctx</span>.<span class="variable">font</span> = <span class="variable">fontsize</span> + <span class="string">'px courier'</span>;
      <span class="variable">canvas</span>.<span class="variable">height</span> = <span class="variable">height</span>;
      <span class="variable">canvas</span>.<span class="variable">width</span> = <span class="variable">width</span>;      
      <span class="keyword">var</span> <span class="variable">fillStyle</span> = <span class="variable">ctx</span>.<span class="variable">fillStyle</span>;
      <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">backgroundColor</span>;
      <span class="variable">ctx</span>.<span class="variable">fillRect</span>(<span class="number integer">0</span>,<span class="number integer">0</span>, <span class="variable">width</span>, <span class="variable">height</span>);
      <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="string">'yellow'</span>;
      <span class="variable">ctx</span>.<span class="variable">beginPath</span>();
      <span class="variable">ctx</span>.<span class="variable">moveTo</span>(<span class="variable">width</span>,<span class="variable">height</span>);
      <span class="variable">ctx</span>.<span class="variable">arcTo</span>(<span class="number integer">0</span>,<span class="variable">height</span>, <span class="number integer">0</span>,<span class="number integer">0</span>, <span class="variable">height</span>/<span class="number integer">2</span>);
      <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="number integer">0</span>,<span class="variable">height</span>);
      <span class="variable">ctx</span>.<span class="variable">lineTo</span>(<span class="variable">width</span>, <span class="variable">height</span>)
      <span class="variable">ctx</span>.<span class="variable">closePath</span>();
      <span class="variable">ctx</span>.<span class="variable">fill</span>();
      <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">color</span>;
      <span class="variable">ctx</span>.<span class="variable">textAlign</span> = <span class="string">'center'</span>;
      <span class="variable">ctx</span>.<span class="variable">textBaseline</span> = &quot;<span class="variable">middle</span>&quot;;
      <span class="variable">ctx</span>.<span class="variable">fillText</span>(<span class="variable">theChar</span>, <span class="regexp">/2, height/</span><span class="number integer">2</span>);
      <span class="comment">// store canvas with glyph in global variable</span>
      <span class="class">SCRIBL</span>.<span class="variable">chars</span>.<span class="variable">heights</span>[<span class="variable">height</span>][<span class="variable">theChar</span> + <span class="string">'leftInsert'</span>] = <span class="variable">canvas</span>;
      <span class="variable">ctx</span>.<span class="variable">fillStyle</span> = <span class="variable">fillStyle</span>;
      
   }
});</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="parsers/bed.js"><a href="#">bed</a></h2></td><td>parsers/bed.js</td></tr><tr class="code">
<td class="docs">
<p>Bed parser
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">bed</span>(<span class="variable">file</span>, <span class="variable">chart</span>) {
	<span class="keyword">var</span> <span class="variable">lines</span> = <span class="variable">file</span>.<span class="variable">split</span>(&quot;\<span class="variable">n</span>&quot;);
	<span class="keyword">var</span> <span class="variable">features</span> = [];
	<span class="keyword">var</span> <span class="variable">max</span> = <span class="variable">undefined</span>;
	<span class="keyword">var</span> <span class="variable">min</span> = <span class="variable">undefined</span>;
	
	<span class="comment">// 	track name=pairedReads description=&quot;Clone Paired Reads&quot; useScore=1</span>
	<span class="keyword">var</span> <span class="variable">trackInfo</span> = <span class="variable">lines</span>[<span class="number integer">0</span>];
	
	<span class="comment">// parse genes</span>
	<span class="variable">numFeatures</span> = <span class="variable">lines</span>.<span class="variable">length</span>
	<span class="keyword">for</span>( <span class="keyword">var</span> <span class="variable">j</span>=<span class="number integer">1</span>; <span class="variable">j</span> &lt; <span class="variable">numFeatures</span>; <span class="variable">j</span>++ ) {
		<span class="keyword">if</span>( <span class="variable">lines</span>[<span class="variable">j</span>] == &quot;&quot; ) <span class="keyword">break</span>;
		
		<span class="keyword">var</span> <span class="variable">fields</span> = <span class="variable">lines</span>[<span class="variable">j</span>].<span class="variable">split</span>(&quot; &quot;);
		
		<span class="comment">//chrom chromStart chromEnd name score strand thickStart thickEnd itemRgb blockCount blockSizes blockStarts</span>
		<span class="keyword">var</span> <span class="variable">chromStart</span> = <span class="variable">parseInt</span>(<span class="variable">fields</span>[<span class="number integer">1</span>]);
		<span class="keyword">var</span> <span class="variable">chromEnd</span> = <span class="variable">parseInt</span>(<span class="variable">fields</span>[<span class="number integer">2</span>]);
		<span class="keyword">var</span> <span class="variable">name</span> = <span class="variable">fields</span>[<span class="number integer">0</span>] + &quot;: &quot; + <span class="variable">fields</span>[<span class="number integer">3</span>];
		<span class="keyword">var</span> <span class="variable">orientation</span> = <span class="variable">fields</span>[<span class="number integer">5</span>];
		<span class="keyword">var</span> <span class="variable">itemRgb</span> = <span class="variable">fields</span>[<span class="number integer">8</span>];
		<span class="keyword">var</span> <span class="variable">blockLengths</span> = <span class="variable">fields</span>[<span class="number integer">10</span>].<span class="variable">split</span>(<span class="string">','</span>);
		<span class="keyword">var</span> <span class="variable">blockStarts</span> = <span class="variable">fields</span>[<span class="number integer">11</span>].<span class="variable">split</span>(<span class="string">','</span>);

		<span class="keyword">var</span> <span class="variable">complex</span> = <span class="variable">chart</span>.<span class="variable">addFeature</span>( <span class="keyword">new</span> <span class="class">Complex</span>(<span class="string">'complex'</span>, <span class="variable">chromStart</span>, <span class="variable">chromEnd</span>, <span class="variable">orientation</span>, [], {<span class="string">'color'</span>:<span class="variable">itemRgb</span>, <span class="string">'name'</span>:<span class="variable">name</span>}) );

		<span class="keyword">for</span>( <span class="keyword">var</span> <span class="variable">k</span>=<span class="number integer">0</span>; <span class="variable">k</span>&lt;<span class="variable">blockLengths</span>.<span class="variable">length</span>; <span class="variable">k</span>++) {
			<span class="keyword">if</span>( <span class="variable">blockLengths</span>[<span class="variable">k</span>] == &quot;&quot;) <span class="keyword">break</span>;
			<span class="variable">complex</span>.<span class="variable">addSubFeature</span>( <span class="keyword">new</span> <span class="class">BlockArrow</span>(<span class="string">'complex'</span>, <span class="variable">parseInt</span>(<span class="variable">blockStarts</span>[<span class="variable">k</span>]), <span class="variable">parseInt</span>(<span class="variable">blockLengths</span>[<span class="variable">k</span>]), <span class="variable">orientation</span>));
		}
	}
}</code></pre>
</td>
</tr>	</body>
</html></tbody></table>
